exports.id=73,exports.ids=[73],exports.modules={73:(a,b,c)=>{"use strict";let d,e,f,g;c(2645);let h=Object.assign(function(){},{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,L_SHOULDER_1:4,R_SHOULDER_1:5,L_SHOULDER_2:6,R_SHOULDER_2:7,SELECT:8,START:9,DPAD_UP:12,DPAD_DOWN:13,DPAD_LEFT:14,DPAD_RIGHT:15,VENDOR:16}),i=function(a,b,c){this.type=a,this.index=b,this.pressed=c.pressed,this.value=c.value},j={LEFT:"left",RIGHT:"right"},k={MOVEMENT:1,ROTATION:2};AFRAME.registerComponent("gamepad-controls",{GamepadButton:h,schema:{enabled:{default:!0},rotationSensitivity:{default:2}},init:function(){let a=this.el.sceneEl;this.system=a.systems["tracked-controls"]||a.systems["tracked-controls-webxr"]||{controllers:[]},this.prevTime=window.performance.now(),this.buttons={};let b=this.el.object3D.rotation;this.pitch=new THREE.Object3D,this.pitch.rotation.x=b.x,this.yaw=new THREE.Object3D,this.yaw.position.y=10,this.yaw.rotation.y=b.y,this.yaw.add(this.pitch),this._lookVector=new THREE.Vector2,this._moveVector=new THREE.Vector2,this._dpadVector=new THREE.Vector2,a.addBehavior(this)},update:function(){this.tick()},tick:function(a,b){this.updateButtonState(),this.updateRotation(b)},remove:function(){},isVelocityActive:function(){if(!this.data.enabled||!this.isConnected())return!1;let a=this._dpadVector,b=this._moveVector;this.getDpad(a),this.getJoystick(k.MOVEMENT,b);let c=a.x||b.x,d=a.y||b.y;return Math.abs(c)>.2||Math.abs(d)>.2},getVelocityDelta:function(){let a=this._dpadVector,b=this._moveVector;this.getDpad(a),this.getJoystick(k.MOVEMENT,b);let c=a.x||b.x,d=a.y||b.y,e=new THREE.Vector3;return Math.abs(c)>.2&&(e.x+=c),Math.abs(d)>.2&&(e.z+=d),e},isRotationActive:function(){if(!this.data.enabled||!this.isConnected())return!1;let a=this._lookVector;return this.getJoystick(k.ROTATION,a),Math.abs(a.x)>.2||Math.abs(a.y)>.2},updateRotation:function(a){if(!this.isRotationActive())return;let b=this.data,c=this.yaw,d=this.pitch;c.rotation.y=this.el.object3D.rotation.y,d.rotation.x=this.el.object3D.rotation.x;let e=this._lookVector;this.getJoystick(k.ROTATION,e),.2>=Math.abs(e.x)&&(e.x=0),.2>=Math.abs(e.y)&&(e.y=0),e.multiplyScalar(b.rotationSensitivity*a/1e3),c.rotation.y-=e.x,d.rotation.x-=e.y,d.rotation.x=Math.max(-Math.PI/2,Math.min(Math.PI/2,d.rotation.x)),this.el.object3D.rotation.set(d.rotation.x,c.rotation.y,0)},updateButtonState:function(){let a=this.getGamepad(j.RIGHT);if(this.data.enabled&&a)for(var b=0;b<a.buttons.length;b++)a.buttons[b].pressed&&!this.buttons[b]?this.emit(new i("gamepadbuttondown",b,a.buttons[b])):!a.buttons[b].pressed&&this.buttons[b]&&this.emit(new i("gamepadbuttonup",b,a.buttons[b])),this.buttons[b]=a.buttons[b].pressed;else for(let a in this.buttons)this.buttons[a]=!1},emit:function(a){this.el.emit(a.type,a),this.el.emit(a.type+":"+a.index,new i(a.type,a.index,a))},getGamepad:function(){let a=[],b=[];return function(c){let d=this.el.sceneEl.components["proxy-controls"],e=d&&d.isConnected()&&d.getGamepad(0);if(e)return e;a.length=0;for(let b=0;b<this.system.controllers.length;b++){let d=this.system.controllers[b],e=d?d.gamepad:null;if(a.push(e),e&&d.handedness===c)return e}let f=navigator.getGamepads?navigator.getGamepads():b;for(let a=0;a<f.length;a++){let b=f[a];if(b&&b.hand===c)return b}return a[0]||f[0]}}(),getButton:function(a){return this.getGamepad(j.RIGHT).buttons[a]},getAxis:function(a){return this.getGamepad(a>1?j.RIGHT:j.LEFT).axes[a]},getJoystick:function(a,b){let c=this.getGamepad(a===k.MOVEMENT?j.LEFT:j.RIGHT);if(!c)return b.set(0,0);if("xr-standard"===c.mapping)switch(a){case k.MOVEMENT:return b.set(c.axes[2],c.axes[3]);case k.ROTATION:return b.set(c.axes[2],0)}else switch(a){case k.MOVEMENT:return b.set(c.axes[0],c.axes[1]);case k.ROTATION:return b.set(c.axes[2],c.axes[3])}throw Error('Unexpected joystick index "%d".',a)},getDpad:function(a){let b=this.getGamepad(j.LEFT);return b&&b.buttons[h.DPAD_RIGHT]?a.set(+!!b.buttons[h.DPAD_RIGHT].pressed+(b.buttons[h.DPAD_LEFT].pressed?-1:0),(b.buttons[h.DPAD_UP].pressed?-1:0)+ +!!b.buttons[h.DPAD_DOWN].pressed):a.set(0,0)},isConnected:function(){let a=this.getGamepad(j.LEFT);return!!(a&&a.connected)},getID:function(){return this.getGamepad(j.LEFT).id}}),c(808);let l=window.KeyboardEvent;AFRAME.registerComponent("keyboard-controls",{schema:{enabled:{default:!0},debug:{default:!1}},init:function(){this.dVelocity=new THREE.Vector3,this.localKeys={},this.listeners={keydown:this.onKeyDown.bind(this),keyup:this.onKeyUp.bind(this),blur:this.onBlur.bind(this),onContextMenu:this.onContextMenu.bind(this)}},isVelocityActive:function(){return this.data.enabled&&!!Object.keys(this.getKeys()).length},getVelocityDelta:function(){let a=this.data,b=this.getKeys();return this.dVelocity.set(0,0,0),a.enabled&&((b.KeyW||b.ArrowUp)&&(this.dVelocity.z-=1),(b.KeyA||b.ArrowLeft)&&(this.dVelocity.x-=1),(b.KeyS||b.ArrowDown)&&(this.dVelocity.z+=1),(b.KeyD||b.ArrowRight)&&(this.dVelocity.x+=1),b.ShiftLeft&&(this.dVelocity=this.dVelocity.multiplyScalar(2))),this.dVelocity.clone()},play:function(){this.attachEventListeners()},pause:function(){this.removeEventListeners()},attachEventListeners:function(){window.addEventListener("contextmenu",this.listeners.onContextMenu,!1),window.addEventListener("keydown",this.listeners.keydown,!1),window.addEventListener("keyup",this.listeners.keyup,!1),window.addEventListener("blur",this.listeners.blur,!1)},onContextMenu:function(){for(let a in this.localKeys)this.localKeys.hasOwnProperty(a)&&delete this.localKeys[a]},removeEventListeners:function(){window.removeEventListener("keydown",this.listeners.keydown),window.removeEventListener("keyup",this.listeners.keyup),window.removeEventListener("blur",this.listeners.blur)},onKeyDown:function(a){AFRAME.utils.shouldCaptureKeyEvent(a)&&(this.localKeys[a.code]=!0,this.emit(a))},onKeyUp:function(a){AFRAME.utils.shouldCaptureKeyEvent(a)&&(delete this.localKeys[a.code],this.emit(a))},onBlur:function(){for(let a in this.localKeys)this.localKeys.hasOwnProperty(a)&&delete this.localKeys[a]},emit:function(a){"__keyboard-controls-proxy"in a&&this.el.emit(a.type,a),this.el.emit(a.type+":"+a.code,new l(a.type,a)),this.data.debug&&console.log(a.type+":"+a.code)},isPressed:function(a){return a in this.getKeys()},getKeys:function(){return this.isProxied()?this.el.sceneEl.components["proxy-controls"].getKeyboard():this.localKeys},isProxied:function(){let a=this.el.sceneEl.components["proxy-controls"];return a&&a.isConnected()}}),c(7232),c(7872),c(1139);let m=(a,b)=>{let c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)},n=a=>Math.PI/180*a,o=new Map,p=a=>{o.has(a)&&clearTimeout(o.get(a)),o.set(a,setTimeout(a,100))},q=(a,b,c)=>{let d,e=b.split(/[ ,]+/g);for(let b=0;b<e.length;b+=1)d=e[b],a.addEventListener?a.addEventListener(d,c,!1):a.attachEvent&&a.attachEvent(d,c)},r=(a,b,c)=>{let d,e=b.split(/[ ,]+/g);for(let b=0;b<e.length;b+=1)d=e[b],a.removeEventListener?a.removeEventListener(d,c):a.detachEvent&&a.detachEvent(d,c)},s=a=>(a.preventDefault(),a.type.match(/^touch/)?a.changedTouches:a),t=()=>({x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}),u=(a,b)=>{b.top||b.right||b.bottom||b.left?(a.style.top=b.top,a.style.right=b.right,a.style.bottom=b.bottom,a.style.left=b.left):(a.style.left=b.x+"px",a.style.top=b.y+"px")},v=(a,b,c)=>{let d=w(a);for(let a in d)if(d.hasOwnProperty(a))if("string"==typeof b)d[a]=b+" "+c;else{let e="";for(let a=0,d=b.length;a<d;a+=1)e+=b[a]+" "+c+", ";d[a]=e.slice(0,-2)}return d},w=a=>{let b={};return b[a]="",["webkit","Moz","o"].forEach(function(c){b[c+a.charAt(0).toUpperCase()+a.slice(1)]=""}),b},x=(a,b)=>{for(let c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},y=(a,b)=>{if(a.length)for(let c=0,d=a.length;c<d;c+=1)b(a[c]);else b(a)};var z,A="ontouchstart"in window,B=!!window.PointerEvent,C=!!window.MSPointerEvent,D={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},E={};function F(){}function G(a,b){return this.identifier=b.identifier,this.position=b.position,this.frontPosition=b.frontPosition,this.collection=a,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(b),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=G.id,G.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}function H(a,b){this.nipples=[],this.idles=[],this.actives=[],this.ids=[],this.pressureIntervals={},this.manager=a,this.id=H.id,H.id+=1,this.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},this.config(b),("static"===this.options.mode||"semi"===this.options.mode)&&(this.options.multitouch=!1),this.options.multitouch||(this.options.maxNumberOfNipples=1);let c=getComputedStyle(this.options.zone.parentElement);return c&&"flex"===c.display&&(this.parentIsFlex=!0),this.updateBox(),this.prepareNipples(),this.bindings(),this.begin(),this.nipples}function I(a){var b=this;b.ids={},b.index=0,b.collections=[],b.scroll=t(),b.config(a),b.prepareCollections();var c=function(){var a;b.collections.forEach(function(c){c.forEach(function(c){a=c.el.getBoundingClientRect(),c.position={x:b.scroll.x+a.left,y:b.scroll.y+a.top}})})};q(window,"resize",function(){p(c)});var d=function(){b.scroll=t()};return q(window,"scroll",function(){p(d)}),b.collections}B?z=D.pointer:C?z=D.MSPointer:A?(z=D.touch,E=D.mouse):z=D.mouse,F.prototype.on=function(a,b){var c,d=a.split(/[ ,]+/g);this._handlers_=this._handlers_||{};for(var e=0;e<d.length;e+=1)c=d[e],this._handlers_[c]=this._handlers_[c]||[],this._handlers_[c].push(b);return this},F.prototype.off=function(a,b){return this._handlers_=this._handlers_||{},void 0===a?this._handlers_={}:void 0===b?this._handlers_[a]=null:this._handlers_[a]&&this._handlers_[a].indexOf(b)>=0&&this._handlers_[a].splice(this._handlers_[a].indexOf(b),1),this},F.prototype.trigger=function(a,b){var c,d=this,e=a.split(/[ ,]+/g);d._handlers_=d._handlers_||{};for(var f=0;f<e.length;f+=1)c=e[f],d._handlers_[c]&&d._handlers_[c].length&&d._handlers_[c].forEach(function(a){a.call(d,{type:c,target:d},b)})},F.prototype.config=function(a){this.options=this.defaults||{},a&&(this.options=((a,b)=>{let c={};for(let d in a)a.hasOwnProperty(d)&&b.hasOwnProperty(d)?c[d]=b[d]:a.hasOwnProperty(d)&&(c[d]=a[d]);return c})(this.options,a))},F.prototype.bindEvt=function(a,b){var c=this;return c._domHandlers_=c._domHandlers_||{},c._domHandlers_[b]=function(){"function"==typeof c["on"+b]?c["on"+b].apply(c,arguments):console.warn('[WARNING] : Missing "on'+b+'" handler.')},q(a,z[b],c._domHandlers_[b]),E[b]&&q(a,E[b],c._domHandlers_[b]),c},F.prototype.unbindEvt=function(a,b){return this._domHandlers_=this._domHandlers_||{},r(a,z[b],this._domHandlers_[b]),E[b]&&r(a,E[b],this._domHandlers_[b]),delete this._domHandlers_[b],this},G.prototype=new F,G.constructor=G,G.id=0,G.prototype.buildEl=function(a){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},G.prototype.stylize=function(){if(this.options.dataOnly)return this;var a=this.options.fadeTime+"ms",b=((a,b)=>{let c=w(a);for(let a in c)c.hasOwnProperty(a)&&(c[a]=b);return c})("borderRadius","50%"),c=v("transition","opacity",a),d={};return d.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},d.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",left:0,marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},d.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",left:0,marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},x(d.el,c),"circle"===this.options.shape&&x(d.back,b),x(d.front,b),this.applyStyles(d),this},G.prototype.applyStyles=function(a){for(var b in this.ui)if(this.ui.hasOwnProperty(b))for(var c in a[b])this.ui[b].style[c]=a[b][c];return this},G.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},G.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},G.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},G.prototype.show=function(a){var b=this;return b.options.dataOnly||(clearTimeout(b.removeTimeout),clearTimeout(b.showTimeout),clearTimeout(b.restTimeout),b.addToDom(),b.restCallback(),setTimeout(function(){b.ui.el.style.opacity=1},0),b.showTimeout=setTimeout(function(){b.trigger("shown",b.instance),"function"==typeof a&&a.call(this)},b.options.fadeTime)),b},G.prototype.hide=function(a){var b=this;if(b.options.dataOnly)return b;if(b.ui.el.style.opacity=b.options.restOpacity,clearTimeout(b.removeTimeout),clearTimeout(b.showTimeout),clearTimeout(b.restTimeout),b.removeTimeout=setTimeout(function(){var c="dynamic"===b.options.mode?"none":"block";b.ui.el.style.display=c,"function"==typeof a&&a.call(b),b.trigger("hidden",b.instance)},b.options.fadeTime),b.options.restJoystick){let c=b.options.restJoystick,d={};d.x=!0===c||!1!==c.x?0:b.instance.frontPosition.x,d.y=!0===c||!1!==c.y?0:b.instance.frontPosition.y,b.setPosition(a,d)}return b},G.prototype.setPosition=function(a,b){var c=this;c.frontPosition={x:b.x,y:b.y};var d=c.options.fadeTime+"ms",e={};e.front=v("transition",["transform"],d);var f={front:{}};f.front={transform:"translate("+c.frontPosition.x+"px,"+c.frontPosition.y+"px)"},c.applyStyles(e),c.applyStyles(f),c.restTimeout=setTimeout(function(){"function"==typeof a&&a.call(c),c.restCallback()},c.options.fadeTime)},G.prototype.restCallback=function(){var a={};a.front=v("transition","none",""),this.applyStyles(a),this.trigger("rested",this.instance)},G.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},G.prototype.computeDirection=function(a){var b=a.angle.radian,c=Math.PI/4,d=Math.PI/2;if(b>c&&b<3*c&&!a.lockX?e="up":b>-c&&b<=c&&!a.lockY?e="left":b>-(3*c)&&b<=-c&&!a.lockX?e="down":a.lockY||(e="right"),a.lockY||(f=b>-d&&b<d?"left":"right"),a.lockX||(g=b>0?"up":"down"),a.force>this.options.threshold){var e,f,g,h,i={};for(h in this.direction)this.direction.hasOwnProperty(h)&&(i[h]=this.direction[h]);var j={};for(h in this.direction={x:f,y:g,angle:e},a.direction=this.direction,i)i[h]===this.direction[h]&&(j[h]=!0);if(j.x&&j.y&&j.angle)return a;j.x&&j.y||this.trigger("plain",a),j.x||this.trigger("plain:"+f,a),j.y||this.trigger("plain:"+g,a),j.angle||this.trigger("dir dir:"+e,a)}else this.resetDirection();return a},H.prototype=new F,H.constructor=H,H.id=0,H.prototype.prepareNipples=function(){var a=this.nipples;a.on=this.on.bind(this),a.off=this.off.bind(this),a.options=this.options,a.destroy=this.destroy.bind(this),a.ids=this.ids,a.id=this.id,a.processOnMove=this.processOnMove.bind(this),a.processOnEnd=this.processOnEnd.bind(this),a.get=function(b){if(void 0===b)return a[0];for(var c=0,d=a.length;c<d;c+=1)if(a[c].identifier===b)return a[c];return!1}},H.prototype.bindings=function(){this.bindEvt(this.options.zone,"start"),this.options.zone.style.touchAction="none",this.options.zone.style.msTouchAction="none"},H.prototype.begin=function(){var a=this.options;if("static"===a.mode){var b=this.createNipple(a.position,this.manager.getIdentifier());b.add(),this.idles.push(b)}},H.prototype.createNipple=function(a,b){var c=this.manager.scroll,d={},e=this.options,f={x:this.parentIsFlex?c.x:c.x+this.box.left,y:this.parentIsFlex?c.y:c.y+this.box.top};if(a.x&&a.y)d={x:a.x-f.x,y:a.y-f.y};else if(a.top||a.right||a.bottom||a.left){var g=document.createElement("DIV");g.style.display="hidden",g.style.top=a.top,g.style.right=a.right,g.style.bottom=a.bottom,g.style.left=a.left,g.style.position="absolute",e.zone.appendChild(g);var h=g.getBoundingClientRect();e.zone.removeChild(g),d=a,a={x:h.left+c.x,y:h.top+c.y}}var i=new G(this,{color:e.color,size:e.size,threshold:e.threshold,fadeTime:e.fadeTime,dataOnly:e.dataOnly,restJoystick:e.restJoystick,restOpacity:e.restOpacity,mode:e.mode,identifier:b,position:a,zone:e.zone,frontPosition:{x:0,y:0},shape:e.shape});return e.dataOnly||(u(i.ui.el,d),u(i.ui.front,i.frontPosition)),this.nipples.push(i),this.trigger("added "+i.identifier+":added",i),this.manager.trigger("added "+i.identifier+":added",i),this.bindNipple(i),i},H.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},H.prototype.bindNipple=function(a){var b,c=this,d=function(a,d){b=a.type+" "+d.id+":"+a.type,c.trigger(b,d)};a.on("destroyed",c.onDestroyed.bind(c)),a.on("shown hidden rested dir plain",d),a.on("dir:up dir:right dir:down dir:left",d),a.on("plain:up plain:right plain:down plain:left",d)},H.prototype.pressureFn=function(a,b,c){var d=this,e=0;clearInterval(d.pressureIntervals[c]),d.pressureIntervals[c]=setInterval((function(){var c=a.force||a.pressure||a.webkitForce||0;c!==e&&(b.trigger("pressure",c),d.trigger("pressure "+b.identifier+":pressure",c),e=c)}).bind(d),100)},H.prototype.onstart=function(a){var b=this,c=b.options,d=a;return a=s(a),b.updateBox(),y(a,function(e){b.actives.length<c.maxNumberOfNipples?b.processOnStart(e):d.type.match(/^touch/)&&(Object.keys(b.manager.ids).forEach(function(c){if(0>Object.values(d.touches).findIndex(function(a){return a.identifier===c})){var e=[a[0]];e.identifier=c,b.processOnEnd(e)}}),b.actives.length<c.maxNumberOfNipples&&b.processOnStart(e))}),b.manager.bindDocument(),!1},H.prototype.processOnStart=function(a){var b,c=this,d=c.options,e=c.manager.getIdentifier(a),f=a.force||a.pressure||a.webkitForce||0,g={x:a.pageX,y:a.pageY},h=c.getOrCreate(e,g);h.identifier!==e&&c.manager.removeIdentifier(h.identifier),h.identifier=e;var i=function(b){b.trigger("start",b),c.trigger("start "+b.id+":start",b),b.show(),f>0&&c.pressureFn(a,b,b.identifier),c.processOnMove(a)};if((b=c.idles.indexOf(h))>=0&&c.idles.splice(b,1),c.actives.push(h),c.ids.push(h.identifier),"semi"!==d.mode)i(h);else if(m(g,h.position)<=d.catchDistance)i(h);else{h.destroy(),c.processOnStart(a);return}return h},H.prototype.getOrCreate=function(a,b){var c,d=this.options;return/(semi|static)/.test(d.mode)?(c=this.idles[0])?(this.idles.splice(0,1),c):"semi"===d.mode?this.createNipple(b,a):(console.warn("Coudln't find the needed nipple."),!1):this.createNipple(b,a)},H.prototype.processOnMove=function(a){var b,c,d=this.options,e=this.manager.getIdentifier(a),f=this.nipples.get(e),g=this.manager.scroll;if(!(isNaN(a.buttons)?0!==a.pressure:0!==a.buttons))return void this.processOnEnd(a);if(!f){console.error("Found zombie joystick with ID "+e),this.manager.removeIdentifier(e);return}if(d.dynamicPage){var h=f.el.getBoundingClientRect();f.position={x:g.x+h.left,y:g.y+h.top}}f.identifier=e;var i=f.options.size/2,j={x:a.pageX,y:a.pageY};d.lockX&&(j.y=f.position.y),d.lockY&&(j.x=f.position.x);var k=m(j,f.position),l=((a,b)=>{let c=b.x-a.x;return 180/Math.PI*Math.atan2(b.y-a.y,c)})(j,f.position),o=n(l),p=k/i,q={distance:k,position:j};if("circle"===f.options.shape)b=Math.min(k,i),c=((a,b,c)=>{let d={x:0,y:0};return c=n(c),d.x=a.x-b*Math.cos(c),d.y=a.y-b*Math.sin(c),d})(f.position,b,l);else{let a,d;a=j,d=f.position,b=m(c={x:Math.min(Math.max(a.x,d.x-i),d.x+i),y:Math.min(Math.max(a.y,d.y-i),d.y+i)},f.position)}if(d.follow){if(k>i){let a=j.x-c.x,b=j.y-c.y;f.position.x+=a,f.position.y+=b,f.el.style.top=f.position.y-(this.box.top+g.y)+"px",f.el.style.left=f.position.x-(this.box.left+g.x)+"px",k=m(j,f.position)}}else j=c,k=b;var r=j.x-f.position.x,s=j.y-f.position.y;f.frontPosition={x:r,y:s},d.dataOnly||(f.ui.front.style.transform="translate("+r+"px,"+s+"px)");var t={identifier:f.identifier,position:j,force:p,pressure:a.force||a.pressure||a.webkitForce||0,distance:k,angle:{radian:o,degree:l},vector:{x:r/i,y:-s/i},raw:q,instance:f,lockX:d.lockX,lockY:d.lockY};(t=f.computeDirection(t)).angle={radian:n(180-l),degree:180-l},f.trigger("move",t),this.trigger("move "+f.id+":move",t)},H.prototype.processOnEnd=function(a){var b=this,c=b.options,d=b.manager.getIdentifier(a),e=b.nipples.get(d),f=b.manager.removeIdentifier(e.identifier);e&&(c.dataOnly||e.hide(function(){"dynamic"===c.mode&&(e.trigger("removed",e),b.trigger("removed "+e.id+":removed",e),b.manager.trigger("removed "+e.id+":removed",e),e.destroy())}),clearInterval(b.pressureIntervals[e.identifier]),e.resetDirection(),e.trigger("end",e),b.trigger("end "+e.id+":end",e),b.ids.indexOf(e.identifier)>=0&&b.ids.splice(b.ids.indexOf(e.identifier),1),b.actives.indexOf(e)>=0&&b.actives.splice(b.actives.indexOf(e),1),/(semi|static)/.test(c.mode)?b.idles.push(e):b.nipples.indexOf(e)>=0&&b.nipples.splice(b.nipples.indexOf(e),1),b.manager.unbindDocument(),/(semi|static)/.test(c.mode)&&(b.manager.ids[f.id]=f.identifier))},H.prototype.onDestroyed=function(a,b){this.nipples.indexOf(b)>=0&&this.nipples.splice(this.nipples.indexOf(b),1),this.actives.indexOf(b)>=0&&this.actives.splice(this.actives.indexOf(b),1),this.idles.indexOf(b)>=0&&this.idles.splice(this.idles.indexOf(b),1),this.ids.indexOf(b.identifier)>=0&&this.ids.splice(this.ids.indexOf(b.identifier),1),this.manager.removeIdentifier(b.identifier),this.manager.unbindDocument()},H.prototype.destroy=function(){for(var a in this.unbindEvt(this.options.zone,"start"),this.nipples.forEach(function(a){a.destroy()}),this.pressureIntervals)this.pressureIntervals.hasOwnProperty(a)&&clearInterval(this.pressureIntervals[a]);this.trigger("destroyed",this.nipples),this.manager.unbindDocument(),this.off()},I.prototype=new F,I.constructor=I,I.prototype.prepareCollections=function(){var a=this;a.collections.create=a.create.bind(a),a.collections.on=a.on.bind(a),a.collections.off=a.off.bind(a),a.collections.destroy=a.destroy.bind(a),a.collections.get=function(b){var c;return a.collections.every(function(a){return!(c=a.get(b))}),c}},I.prototype.create=function(a){return this.createCollection(a)},I.prototype.createCollection=function(a){var b=new H(this,a);return this.bindCollection(b),this.collections.push(b),b},I.prototype.bindCollection=function(a){var b,c=this,d=function(a,d){b=a.type+" "+d.id+":"+a.type,c.trigger(b,d)};a.on("destroyed",c.onDestroyed.bind(c)),a.on("shown hidden rested dir plain",d),a.on("dir:up dir:right dir:down dir:left",d),a.on("plain:up plain:right plain:down plain:left",d)},I.prototype.bindDocument=function(){this.binded||(this.bindEvt(document,"move").bindEvt(document,"end"),this.binded=!0)},I.prototype.unbindDocument=function(a){Object.keys(this.ids).length&&!0!==a||(this.unbindEvt(document,"move").unbindEvt(document,"end"),this.binded=!1)},I.prototype.getIdentifier=function(a){var b;return a?void 0===(b=void 0===a.identifier?a.pointerId:a.identifier)&&(b=this.latest||0):b=this.index,void 0===this.ids[b]&&(this.ids[b]=this.index,this.index+=1),this.latest=b,this.ids[b]},I.prototype.removeIdentifier=function(a){var b={};for(var c in this.ids)if(this.ids[c]===a){b.id=c,b.identifier=this.ids[c],delete this.ids[c];break}return b},I.prototype.onmove=function(a){return this.onAny("move",a),!1},I.prototype.onend=function(a){return this.onAny("end",a),!1},I.prototype.oncancel=function(a){return this.onAny("end",a),!1},I.prototype.onAny=function(a,b){var c,d=this,e="processOn"+a.charAt(0).toUpperCase()+a.slice(1);b=s(b);var f=function(a,b,c){c.ids.indexOf(b)>=0&&(c[e](a),a._found_=!0)};return y(b,function(a){c=d.getIdentifier(a),y(d.collections,f.bind(null,a,c)),a._found_||d.removeIdentifier(c)}),!1},I.prototype.destroy=function(){this.unbindDocument(!0),this.ids={},this.index=0,this.collections.forEach(function(a){a.destroy()}),this.off()},I.prototype.onDestroyed=function(a,b){if(0>this.collections.indexOf(b))return!1;this.collections.splice(this.collections.indexOf(b),1)};let J=new I,K={create:function(a){return J.create(a)}};AFRAME.registerComponent("nipple-controls",{schema:{enabled:{default:!0},mode:{default:"dynamic",oneOf:["static","semi","dynamic"]},rotationSensitivity:{default:1},moveJoystickEnabled:{default:!0},lookJoystickEnabled:{default:!0},sideMargin:{default:"30px"},bottomMargin:{default:"70px"},moveJoystickPosition:{default:"left",oneOf:["left","right"]},lookJoystickPosition:{default:"right",oneOf:["left","right"]}},init(){this.dVelocity=new THREE.Vector3,this.lookVector=new THREE.Vector2;let a=this.el.querySelector("[look-controls]").components["look-controls"];this.pitchObject=a.pitchObject,this.yawObject=a.yawObject,this.rigRotation=this.el.object3D.rotation,this.moveData=void 0,this.lookData=void 0,this.moving=!1,this.rotating=!1},update(a){(this.data.moveJoystickPosition!==a.moveJoystickPosition||this.data.sideMargin!==a.sideMargin||this.data.bottomMargin!==a.bottomMargin||this.data.mode!==a.mode)&&this.removeMoveJoystick(),(this.data.lookJoystickPosition!==a.lookJoystickPosition||this.data.sideMargin!==a.sideMargin||this.data.bottomMargin!==a.bottomMargin||this.data.mode!==a.mode)&&this.removeLookJoystick(),this.data.enabled&&this.data.moveJoystickEnabled?this.createMoveJoystick():this.removeMoveJoystick(),this.data.enabled&&this.data.lookJoystickEnabled?this.createLookJoystick():this.removeLookJoystick()},pause(){this.moving=!1,this.rotating=!1},remove(){this.removeMoveJoystick(),this.removeLookJoystick()},isVelocityActive(){return this.data.enabled&&this.moving},getVelocityDelta(){if(this.dVelocity.set(0,0,0),this.isVelocityActive()){let a=this.moveData.force<1?this.moveData.force:1,b=this.moveData.angle.radian,c=Math.cos(b)*a,d=-Math.sin(b)*a;this.dVelocity.set(c,0,d)}return this.dVelocity},isRotationActive(){return this.data.enabled&&this.rotating},updateRotation(a){if(!this.isRotationActive())return;let b=this.lookData.force<1?this.lookData.force:1,c=this.lookData.angle.radian,d=this.lookVector;d.x=Math.cos(c)*b,d.y=Math.sin(c)*b,d.multiplyScalar(this.data.rotationSensitivity*a/1e3),this.yawObject.rotation.y-=d.x;let e=this.pitchObject.rotation.x+d.y;e=Math.max(-Math.PI/2,Math.min(Math.PI/2,e)),this.pitchObject.rotation.x=e},tick:function(a,b){this.updateRotation(b)},initLeftZone(){let a=document.createElement("div");a.setAttribute("id","joystickLeftZone"),a.setAttribute("style",`position:absolute;${this.data.moveJoystickPosition}:${this.data.sideMargin};bottom:${this.data.bottomMargin};z-index:1`),document.body.appendChild(a),this.leftZone=a},initRightZone(){let a=document.createElement("div");a.setAttribute("id","joystickRightZone"),a.setAttribute("style",`position:absolute;${this.data.lookJoystickPosition}:${this.data.sideMargin};bottom:${this.data.bottomMargin};z-index:1`),document.body.appendChild(a),this.rightZone=a},createMoveJoystick(){if(this.moveJoystick)return;this.initLeftZone();let a={mode:this.data.mode,zone:this.leftZone,color:"white",fadeTime:0};this.leftZone.style.width="100px","static"===this.data.mode?(this.leftZone.style.height="100px",a.position={left:"50%",bottom:"50%"}):this.leftZone.style.height="400px",this.moveJoystick=K.create(a),this.moveJoystick.on("move",(a,b)=>{this.moveData=b,this.moving=!0}),this.moveJoystick.on("end",(a,b)=>{this.moving=!1})},createLookJoystick(){if(this.lookJoystick)return;this.initRightZone();let a={mode:this.data.mode,zone:this.rightZone,color:"white",fadeTime:0};this.rightZone.style.width="100px","static"===this.data.mode?(this.rightZone.style.height="100px",a.position={left:"50%",bottom:"50%"}):this.rightZone.style.height="400px",this.lookJoystick=K.create(a),this.lookJoystick.on("move",(a,b)=>{this.lookData=b,this.rotating=!0}),this.lookJoystick.on("end",(a,b)=>{this.rotating=!1})},removeMoveJoystick(){this.moveJoystick&&(this.moveJoystick.destroy(),this.moveJoystick=void 0),this.moveData=void 0,this.leftZone&&this.leftZone.parentNode&&(this.leftZone.remove(),this.leftZone=void 0)},removeLookJoystick(){this.lookJoystick&&(this.lookJoystick.destroy(),this.lookJoystick=void 0),this.lookData=void 0,this.rightZone&&this.rightZone.parentNode&&(this.rightZone.remove(),this.rightZone=void 0)}}),c(750);let L="attached",M="srgb",N="srgb-linear",O="display-p3-linear",P="linear",Q="srgb",R="rec709";class S{addEventListener(a,b){void 0===this._listeners&&(this._listeners={});let c=this._listeners;void 0===c[a]&&(c[a]=[]),-1===c[a].indexOf(b)&&c[a].push(b)}hasEventListener(a,b){if(void 0===this._listeners)return!1;let c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)}removeEventListener(a,b){if(void 0===this._listeners)return;let c=this._listeners[a];if(void 0!==c){let a=c.indexOf(b);-1!==a&&c.splice(a,1)}}dispatchEvent(a){if(void 0===this._listeners)return;let b=this._listeners[a.type];if(void 0!==b){a.target=this;let c=b.slice(0);for(let b=0,d=c.length;b<d;b++)c[b].call(this,a);a.target=null}}}let T=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],U=Math.PI/180,V=180/Math.PI;function W(){let a=0xffffffff*Math.random()|0,b=0xffffffff*Math.random()|0,c=0xffffffff*Math.random()|0,d=0xffffffff*Math.random()|0;return(T[255&a]+T[a>>8&255]+T[a>>16&255]+T[a>>24&255]+"-"+T[255&b]+T[b>>8&255]+"-"+T[b>>16&15|64]+T[b>>24&255]+"-"+T[63&c|128]+T[c>>8&255]+"-"+T[c>>16&255]+T[c>>24&255]+T[255&d]+T[d>>8&255]+T[d>>16&255]+T[d>>24&255]).toLowerCase()}function X(a,b,c){return Math.max(b,Math.min(c,a))}function Y(a,b){switch(b.constructor){case Float32Array:return a;case Uint32Array:return a/0xffffffff;case Uint16Array:return a/65535;case Uint8Array:return a/255;case Int32Array:return Math.max(a/0x7fffffff,-1);case Int16Array:return Math.max(a/32767,-1);case Int8Array:return Math.max(a/127,-1);default:throw Error("Invalid component type.")}}function Z(a,b){switch(b.constructor){case Float32Array:return a;case Uint32Array:return Math.round(0xffffffff*a);case Uint16Array:return Math.round(65535*a);case Uint8Array:return Math.round(255*a);case Int32Array:return Math.round(0x7fffffff*a);case Int16Array:return Math.round(32767*a);case Int8Array:return Math.round(127*a);default:throw Error("Invalid component type.")}}let $={generateUUID:W,degToRad:function(a){return a*U}};class _{constructor(a=0,b=0){_.prototype.isVector2=!0,this.x=a,this.y=b}get width(){return this.x}set width(a){this.x=a}get height(){return this.y}set height(a){this.y=a}set(a,b){return this.x=a,this.y=b,this}setScalar(a){return this.x=a,this.y=a,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setComponent(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw Error("index is out of range: "+a)}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+a)}}clone(){return new this.constructor(this.x,this.y)}copy(a){return this.x=a.x,this.y=a.y,this}add(a){return this.x+=a.x,this.y+=a.y,this}addScalar(a){return this.x+=a,this.y+=a,this}addVectors(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this}addScaledVector(a,b){return this.x+=a.x*b,this.y+=a.y*b,this}sub(a){return this.x-=a.x,this.y-=a.y,this}subScalar(a){return this.x-=a,this.y-=a,this}subVectors(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this}multiply(a){return this.x*=a.x,this.y*=a.y,this}multiplyScalar(a){return this.x*=a,this.y*=a,this}divide(a){return this.x/=a.x,this.y/=a.y,this}divideScalar(a){return this.multiplyScalar(1/a)}applyMatrix3(a){let b=this.x,c=this.y,d=a.elements;return this.x=d[0]*b+d[3]*c+d[6],this.y=d[1]*b+d[4]*c+d[7],this}min(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this}max(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this}clamp(a,b){return this.x=Math.max(a.x,Math.min(b.x,this.x)),this.y=Math.max(a.y,Math.min(b.y,this.y)),this}clampScalar(a,b){return this.x=Math.max(a,Math.min(b,this.x)),this.y=Math.max(a,Math.min(b,this.y)),this}clampLength(a,b){let c=this.length();return this.divideScalar(c||1).multiplyScalar(Math.max(a,Math.min(b,c)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(a){return this.x*a.x+this.y*a.y}cross(a){return this.x*a.y-this.y*a.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(a){let b=Math.sqrt(this.lengthSq()*a.lengthSq());return 0===b?Math.PI/2:Math.acos(X(this.dot(a)/b,-1,1))}distanceTo(a){return Math.sqrt(this.distanceToSquared(a))}distanceToSquared(a){let b=this.x-a.x,c=this.y-a.y;return b*b+c*c}manhattanDistanceTo(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this}lerpVectors(a,b,c){return this.x=a.x+(b.x-a.x)*c,this.y=a.y+(b.y-a.y)*c,this}equals(a){return a.x===this.x&&a.y===this.y}fromArray(a,b=0){return this.x=a[b],this.y=a[b+1],this}toArray(a=[],b=0){return a[b]=this.x,a[b+1]=this.y,a}fromBufferAttribute(a,b){return this.x=a.getX(b),this.y=a.getY(b),this}rotateAround(a,b){let c=Math.cos(b),d=Math.sin(b),e=this.x-a.x,f=this.y-a.y;return this.x=e*c-f*d+a.x,this.y=e*d+f*c+a.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class aa{constructor(a,b,c,d,e,f,g,h,i){aa.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==a&&this.set(a,b,c,d,e,f,g,h,i)}set(a,b,c,d,e,f,g,h,i){let j=this.elements;return j[0]=a,j[1]=d,j[2]=g,j[3]=b,j[4]=e,j[5]=h,j[6]=c,j[7]=f,j[8]=i,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(a){let b=this.elements,c=a.elements;return b[0]=c[0],b[1]=c[1],b[2]=c[2],b[3]=c[3],b[4]=c[4],b[5]=c[5],b[6]=c[6],b[7]=c[7],b[8]=c[8],this}extractBasis(a,b,c){return a.setFromMatrix3Column(this,0),b.setFromMatrix3Column(this,1),c.setFromMatrix3Column(this,2),this}setFromMatrix4(a){let b=a.elements;return this.set(b[0],b[4],b[8],b[1],b[5],b[9],b[2],b[6],b[10]),this}multiply(a){return this.multiplyMatrices(this,a)}premultiply(a){return this.multiplyMatrices(a,this)}multiplyMatrices(a,b){let c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[3],h=c[6],i=c[1],j=c[4],k=c[7],l=c[2],m=c[5],n=c[8],o=d[0],p=d[3],q=d[6],r=d[1],s=d[4],t=d[7],u=d[2],v=d[5],w=d[8];return e[0]=f*o+g*r+h*u,e[3]=f*p+g*s+h*v,e[6]=f*q+g*t+h*w,e[1]=i*o+j*r+k*u,e[4]=i*p+j*s+k*v,e[7]=i*q+j*t+k*w,e[2]=l*o+m*r+n*u,e[5]=l*p+m*s+n*v,e[8]=l*q+m*t+n*w,this}multiplyScalar(a){let b=this.elements;return b[0]*=a,b[3]*=a,b[6]*=a,b[1]*=a,b[4]*=a,b[7]*=a,b[2]*=a,b[5]*=a,b[8]*=a,this}determinant(){let a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*f*j-b*g*i-c*e*j+c*g*h+d*e*i-d*f*h}invert(){let a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=j*f-g*i,l=g*h-j*e,m=i*e-f*h,n=b*k+c*l+d*m;if(0===n)return this.set(0,0,0,0,0,0,0,0,0);let o=1/n;return a[0]=k*o,a[1]=(d*i-j*c)*o,a[2]=(g*c-d*f)*o,a[3]=l*o,a[4]=(j*b-d*h)*o,a[5]=(d*e-g*b)*o,a[6]=m*o,a[7]=(c*h-i*b)*o,a[8]=(f*b-c*e)*o,this}transpose(){let a,b=this.elements;return a=b[1],b[1]=b[3],b[3]=a,a=b[2],b[2]=b[6],b[6]=a,a=b[5],b[5]=b[7],b[7]=a,this}getNormalMatrix(a){return this.setFromMatrix4(a).invert().transpose()}transposeIntoArray(a){let b=this.elements;return a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8],this}setUvTransform(a,b,c,d,e,f,g){let h=Math.cos(e),i=Math.sin(e);return this.set(c*h,c*i,-c*(h*f+i*g)+f+a,-d*i,d*h,-d*(-i*f+h*g)+g+b,0,0,1),this}scale(a,b){return this.premultiply(ab.makeScale(a,b)),this}rotate(a){return this.premultiply(ab.makeRotation(-a)),this}translate(a,b){return this.premultiply(ab.makeTranslation(a,b)),this}makeTranslation(a,b){return a.isVector2?this.set(1,0,a.x,0,1,a.y,0,0,1):this.set(1,0,a,0,1,b,0,0,1),this}makeRotation(a){let b=Math.cos(a),c=Math.sin(a);return this.set(b,-c,0,c,b,0,0,0,1),this}makeScale(a,b){return this.set(a,0,0,0,b,0,0,0,1),this}equals(a){let b=this.elements,c=a.elements;for(let a=0;a<9;a++)if(b[a]!==c[a])return!1;return!0}fromArray(a,b=0){for(let c=0;c<9;c++)this.elements[c]=a[c+b];return this}toArray(a=[],b=0){let c=this.elements;return a[b]=c[0],a[b+1]=c[1],a[b+2]=c[2],a[b+3]=c[3],a[b+4]=c[4],a[b+5]=c[5],a[b+6]=c[6],a[b+7]=c[7],a[b+8]=c[8],a}clone(){return new this.constructor().fromArray(this.elements)}}let ab=new aa;function ac(a){return document.createElementNS("http://www.w3.org/1999/xhtml",a)}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;let ad={},ae=new aa().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),af=new aa().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),ag={[N]:{transfer:P,primaries:R,toReference:a=>a,fromReference:a=>a},[M]:{transfer:Q,primaries:R,toReference:a=>a.convertSRGBToLinear(),fromReference:a=>a.convertLinearToSRGB()},[O]:{transfer:P,primaries:"p3",toReference:a=>a.applyMatrix3(af),fromReference:a=>a.applyMatrix3(ae)},"display-p3":{transfer:Q,primaries:"p3",toReference:a=>a.convertSRGBToLinear().applyMatrix3(af),fromReference:a=>a.applyMatrix3(ae).convertLinearToSRGB()}},ah=new Set([N,O]),ai={enabled:!0,_workingColorSpace:N,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(colorSpace){if(!ah.has(colorSpace))throw Error(`Unsupported working color space, "${colorSpace}".`);this._workingColorSpace=colorSpace},convert:function(a,b,c){if(!1===this.enabled||b===c||!b||!c)return a;let d=ag[b].toReference;return(0,ag[c].fromReference)(d(a))},fromWorkingColorSpace:function(a,b){return this.convert(a,this._workingColorSpace,b)},toWorkingColorSpace:function(a,b){return this.convert(a,b,this._workingColorSpace)},getPrimaries:function(a){return ag[a].primaries},getTransfer:function(a){return""===a?P:ag[a].transfer}};function aj(a){return a<.04045?.0773993808*a:Math.pow(.9478672986*a+.0521327014,2.4)}function ak(a){return a<.0031308?12.92*a:1.055*Math.pow(a,.41666)-.055}class al{static getDataURL(a){let b;if(/^data:/i.test(a.src)||"undefined"==typeof HTMLCanvasElement)return a.src;if(a instanceof HTMLCanvasElement)b=a;else{void 0===d&&(d=ac("canvas")),d.width=a.width,d.height=a.height;let c=d.getContext("2d");a instanceof ImageData?c.putImageData(a,0,0):c.drawImage(a,0,0,a.width,a.height),b=d}return b.width>2048||b.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",a),b.toDataURL("image/jpeg",.6)):b.toDataURL("image/png")}static sRGBToLinear(a){if("undefined"!=typeof HTMLImageElement&&a instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&a instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&a instanceof ImageBitmap){let b=ac("canvas");b.width=a.width,b.height=a.height;let c=b.getContext("2d");c.drawImage(a,0,0,a.width,a.height);let d=c.getImageData(0,0,a.width,a.height),e=d.data;for(let a=0;a<e.length;a++)e[a]=255*aj(e[a]/255);return c.putImageData(d,0,0),b}if(!a.data)return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),a;{let b=a.data.slice(0);for(let a=0;a<b.length;a++)b instanceof Uint8Array||b instanceof Uint8ClampedArray?b[a]=Math.floor(255*aj(b[a]/255)):b[a]=aj(b[a]);return{data:b,width:a.width,height:a.height}}}}let am=0;class an{constructor(a=null){this.isSource=!0,Object.defineProperty(this,"id",{value:am++}),this.uuid=W(),this.data=a,this.dataReady=!0,this.version=0}set needsUpdate(a){!0===a&&this.version++}toJSON(a){let b=void 0===a||"string"==typeof a;if(!b&&void 0!==a.images[this.uuid])return a.images[this.uuid];let c={uuid:this.uuid,url:""},d=this.data;if(null!==d){let a;if(Array.isArray(d)){a=[];for(let b=0,c=d.length;b<c;b++)d[b].isDataTexture?a.push(ao(d[b].image)):a.push(ao(d[b]))}else a=ao(d);c.url=a}return b||(a.images[this.uuid]=c),c}}function ao(a){return"undefined"!=typeof HTMLImageElement&&a instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&a instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&a instanceof ImageBitmap?al.getDataURL(a):a.data?{data:Array.from(a.data),width:a.width,height:a.height,type:a.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let ap=0;class aq extends S{constructor(a=aq.DEFAULT_IMAGE,b=aq.DEFAULT_MAPPING,c=1001,d=1001,e=1006,f=1008,g=1023,h=1009,i=aq.DEFAULT_ANISOTROPY,j=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:ap++}),this.uuid=W(),this.name="",this.source=new an(a),this.mipmaps=[],this.mapping=b,this.channel=0,this.wrapS=c,this.wrapT=d,this.magFilter=e,this.minFilter=f,this.anisotropy=i,this.format=g,this.internalFormat=null,this.type=h,this.offset=new _(0,0),this.repeat=new _(1,1),this.center=new _(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new aa,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=j,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(a=null){this.source.data=a}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(a){return this.name=a.name,this.source=a.source,this.mipmaps=a.mipmaps.slice(0),this.mapping=a.mapping,this.channel=a.channel,this.wrapS=a.wrapS,this.wrapT=a.wrapT,this.magFilter=a.magFilter,this.minFilter=a.minFilter,this.anisotropy=a.anisotropy,this.format=a.format,this.internalFormat=a.internalFormat,this.type=a.type,this.offset.copy(a.offset),this.repeat.copy(a.repeat),this.center.copy(a.center),this.rotation=a.rotation,this.matrixAutoUpdate=a.matrixAutoUpdate,this.matrix.copy(a.matrix),this.generateMipmaps=a.generateMipmaps,this.premultiplyAlpha=a.premultiplyAlpha,this.flipY=a.flipY,this.unpackAlignment=a.unpackAlignment,this.colorSpace=a.colorSpace,this.userData=JSON.parse(JSON.stringify(a.userData)),this.needsUpdate=!0,this}toJSON(a){let b=void 0===a||"string"==typeof a;if(!b&&void 0!==a.textures[this.uuid])return a.textures[this.uuid];let c={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(a).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(c.userData=this.userData),b||(a.textures[this.uuid]=c),c}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(a){if(300!==this.mapping)return a;if(a.applyMatrix3(this.matrix),a.x<0||a.x>1)switch(this.wrapS){case 1e3:a.x=a.x-Math.floor(a.x);break;case 1001:a.x=a.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(a.x)%2)?a.x=Math.ceil(a.x)-a.x:a.x=a.x-Math.floor(a.x)}if(a.y<0||a.y>1)switch(this.wrapT){case 1e3:a.y=a.y-Math.floor(a.y);break;case 1001:a.y=a.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(a.y)%2)?a.y=Math.ceil(a.y)-a.y:a.y=a.y-Math.floor(a.y)}return this.flipY&&(a.y=1-a.y),a}set needsUpdate(a){!0===a&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(a){!0===a&&this.pmremVersion++}}aq.DEFAULT_IMAGE=null,aq.DEFAULT_MAPPING=300,aq.DEFAULT_ANISOTROPY=1;class ar{constructor(a=0,b=0,c=0,d=1){ar.prototype.isVector4=!0,this.x=a,this.y=b,this.z=c,this.w=d}get width(){return this.z}set width(a){this.z=a}get height(){return this.w}set height(a){this.w=a}set(a,b,c,d){return this.x=a,this.y=b,this.z=c,this.w=d,this}setScalar(a){return this.x=a,this.y=a,this.z=a,this.w=a,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setZ(a){return this.z=a,this}setW(a){return this.w=a,this}setComponent(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw Error("index is out of range: "+a)}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+a)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=void 0!==a.w?a.w:1,this}add(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this.w+=a.w,this}addScalar(a){return this.x+=a,this.y+=a,this.z+=a,this.w+=a,this}addVectors(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this.w=a.w+b.w,this}addScaledVector(a,b){return this.x+=a.x*b,this.y+=a.y*b,this.z+=a.z*b,this.w+=a.w*b,this}sub(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this.w-=a.w,this}subScalar(a){return this.x-=a,this.y-=a,this.z-=a,this.w-=a,this}subVectors(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this.w=a.w-b.w,this}multiply(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this.w*=a.w,this}multiplyScalar(a){return this.x*=a,this.y*=a,this.z*=a,this.w*=a,this}applyMatrix4(a){let b=this.x,c=this.y,d=this.z,e=this.w,f=a.elements;return this.x=f[0]*b+f[4]*c+f[8]*d+f[12]*e,this.y=f[1]*b+f[5]*c+f[9]*d+f[13]*e,this.z=f[2]*b+f[6]*c+f[10]*d+f[14]*e,this.w=f[3]*b+f[7]*c+f[11]*d+f[15]*e,this}divideScalar(a){return this.multiplyScalar(1/a)}setAxisAngleFromQuaternion(a){this.w=2*Math.acos(a.w);let b=Math.sqrt(1-a.w*a.w);return b<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b),this}setAxisAngleFromRotationMatrix(a){let b,c,d,e,f=a.elements,g=f[0],h=f[4],i=f[8],j=f[1],k=f[5],l=f[9],m=f[2],n=f[6],o=f[10];if(.01>Math.abs(h-j)&&.01>Math.abs(i-m)&&.01>Math.abs(l-n)){if(.1>Math.abs(h+j)&&.1>Math.abs(i+m)&&.1>Math.abs(l+n)&&.1>Math.abs(g+k+o-3))return this.set(1,0,0,0),this;b=Math.PI;let a=(g+1)/2,f=(k+1)/2,p=(o+1)/2,q=(h+j)/4,r=(i+m)/4,s=(l+n)/4;return a>f&&a>p?a<.01?(c=0,d=.707106781,e=.707106781):(d=q/(c=Math.sqrt(a)),e=r/c):f>p?f<.01?(c=.707106781,d=0,e=.707106781):(c=q/(d=Math.sqrt(f)),e=s/d):p<.01?(c=.707106781,d=.707106781,e=0):(c=r/(e=Math.sqrt(p)),d=s/e),this.set(c,d,e,b),this}let p=Math.sqrt((n-l)*(n-l)+(i-m)*(i-m)+(j-h)*(j-h));return .001>Math.abs(p)&&(p=1),this.x=(n-l)/p,this.y=(i-m)/p,this.z=(j-h)/p,this.w=Math.acos((g+k+o-1)/2),this}min(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this.z=Math.min(this.z,a.z),this.w=Math.min(this.w,a.w),this}max(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this.z=Math.max(this.z,a.z),this.w=Math.max(this.w,a.w),this}clamp(a,b){return this.x=Math.max(a.x,Math.min(b.x,this.x)),this.y=Math.max(a.y,Math.min(b.y,this.y)),this.z=Math.max(a.z,Math.min(b.z,this.z)),this.w=Math.max(a.w,Math.min(b.w,this.w)),this}clampScalar(a,b){return this.x=Math.max(a,Math.min(b,this.x)),this.y=Math.max(a,Math.min(b,this.y)),this.z=Math.max(a,Math.min(b,this.z)),this.w=Math.max(a,Math.min(b,this.w)),this}clampLength(a,b){let c=this.length();return this.divideScalar(c||1).multiplyScalar(Math.max(a,Math.min(b,c)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this.w+=(a.w-this.w)*b,this}lerpVectors(a,b,c){return this.x=a.x+(b.x-a.x)*c,this.y=a.y+(b.y-a.y)*c,this.z=a.z+(b.z-a.z)*c,this.w=a.w+(b.w-a.w)*c,this}equals(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w}fromArray(a,b=0){return this.x=a[b],this.y=a[b+1],this.z=a[b+2],this.w=a[b+3],this}toArray(a=[],b=0){return a[b]=this.x,a[b+1]=this.y,a[b+2]=this.z,a[b+3]=this.w,a}fromBufferAttribute(a,b){return this.x=a.getX(b),this.y=a.getY(b),this.z=a.getZ(b),this.w=a.getW(b),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class as{constructor(a=0,b=0,c=0,d=1){this.isQuaternion=!0,this._x=a,this._y=b,this._z=c,this._w=d}static slerpFlat(a,b,c,d,e,f,g){let h=c[d+0],i=c[d+1],j=c[d+2],k=c[d+3],l=e[f+0],m=e[f+1],n=e[f+2],o=e[f+3];if(0===g){a[b+0]=h,a[b+1]=i,a[b+2]=j,a[b+3]=k;return}if(1===g){a[b+0]=l,a[b+1]=m,a[b+2]=n,a[b+3]=o;return}if(k!==o||h!==l||i!==m||j!==n){let a=1-g,b=h*l+i*m+j*n+k*o,c=b>=0?1:-1,d=1-b*b;if(d>Number.EPSILON){let e=Math.sqrt(d),f=Math.atan2(e,b*c);a=Math.sin(a*f)/e,g=Math.sin(g*f)/e}let e=g*c;if(h=h*a+l*e,i=i*a+m*e,j=j*a+n*e,k=k*a+o*e,a===1-g){let a=1/Math.sqrt(h*h+i*i+j*j+k*k);h*=a,i*=a,j*=a,k*=a}}a[b]=h,a[b+1]=i,a[b+2]=j,a[b+3]=k}static multiplyQuaternionsFlat(a,b,c,d,e,f){let g=c[d],h=c[d+1],i=c[d+2],j=c[d+3],k=e[f],l=e[f+1],m=e[f+2],n=e[f+3];return a[b]=g*n+j*k+h*m-i*l,a[b+1]=h*n+j*l+i*k-g*m,a[b+2]=i*n+j*m+g*l-h*k,a[b+3]=j*n-g*k-h*l-i*m,a}get x(){return this._x}set x(a){this._x=a,this._onChangeCallback()}get y(){return this._y}set y(a){this._y=a,this._onChangeCallback()}get z(){return this._z}set z(a){this._z=a,this._onChangeCallback()}get w(){return this._w}set w(a){this._w=a,this._onChangeCallback()}set(a,b,c,d){return this._x=a,this._y=b,this._z=c,this._w=d,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(a){return this._x=a.x,this._y=a.y,this._z=a.z,this._w=a.w,this._onChangeCallback(),this}setFromEuler(a,b=!0){let c=a._x,d=a._y,e=a._z,f=a._order,g=Math.cos,h=Math.sin,i=g(c/2),j=g(d/2),k=g(e/2),l=h(c/2),m=h(d/2),n=h(e/2);switch(f){case"XYZ":this._x=l*j*k+i*m*n,this._y=i*m*k-l*j*n,this._z=i*j*n+l*m*k,this._w=i*j*k-l*m*n;break;case"YXZ":this._x=l*j*k+i*m*n,this._y=i*m*k-l*j*n,this._z=i*j*n-l*m*k,this._w=i*j*k+l*m*n;break;case"ZXY":this._x=l*j*k-i*m*n,this._y=i*m*k+l*j*n,this._z=i*j*n+l*m*k,this._w=i*j*k-l*m*n;break;case"ZYX":this._x=l*j*k-i*m*n,this._y=i*m*k+l*j*n,this._z=i*j*n-l*m*k,this._w=i*j*k+l*m*n;break;case"YZX":this._x=l*j*k+i*m*n,this._y=i*m*k+l*j*n,this._z=i*j*n-l*m*k,this._w=i*j*k-l*m*n;break;case"XZY":this._x=l*j*k-i*m*n,this._y=i*m*k-l*j*n,this._z=i*j*n+l*m*k,this._w=i*j*k+l*m*n;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+f)}return!0===b&&this._onChangeCallback(),this}setFromAxisAngle(a,b){let c=b/2,d=Math.sin(c);return this._x=a.x*d,this._y=a.y*d,this._z=a.z*d,this._w=Math.cos(c),this._onChangeCallback(),this}setFromRotationMatrix(a){let b=a.elements,c=b[0],d=b[4],e=b[8],f=b[1],g=b[5],h=b[9],i=b[2],j=b[6],k=b[10],l=c+g+k;if(l>0){let a=.5/Math.sqrt(l+1);this._w=.25/a,this._x=(j-h)*a,this._y=(e-i)*a,this._z=(f-d)*a}else if(c>g&&c>k){let a=2*Math.sqrt(1+c-g-k);this._w=(j-h)/a,this._x=.25*a,this._y=(d+f)/a,this._z=(e+i)/a}else if(g>k){let a=2*Math.sqrt(1+g-c-k);this._w=(e-i)/a,this._x=(d+f)/a,this._y=.25*a,this._z=(h+j)/a}else{let a=2*Math.sqrt(1+k-c-g);this._w=(f-d)/a,this._x=(e+i)/a,this._y=(h+j)/a,this._z=.25*a}return this._onChangeCallback(),this}setFromUnitVectors(a,b){let c=a.dot(b)+1;return c<Number.EPSILON?(c=0,Math.abs(a.x)>Math.abs(a.z)?(this._x=-a.y,this._y=a.x,this._z=0):(this._x=0,this._y=-a.z,this._z=a.y)):(this._x=a.y*b.z-a.z*b.y,this._y=a.z*b.x-a.x*b.z,this._z=a.x*b.y-a.y*b.x),this._w=c,this.normalize()}angleTo(a){return 2*Math.acos(Math.abs(X(this.dot(a),-1,1)))}rotateTowards(a,b){let c=this.angleTo(a);if(0===c)return this;let d=Math.min(1,b/c);return this.slerp(a,d),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let a=this.length();return 0===a?(this._x=0,this._y=0,this._z=0,this._w=1):(a=1/a,this._x=this._x*a,this._y=this._y*a,this._z=this._z*a,this._w=this._w*a),this._onChangeCallback(),this}multiply(a){return this.multiplyQuaternions(this,a)}premultiply(a){return this.multiplyQuaternions(a,this)}multiplyQuaternions(a,b){let c=a._x,d=a._y,e=a._z,f=a._w,g=b._x,h=b._y,i=b._z,j=b._w;return this._x=c*j+f*g+d*i-e*h,this._y=d*j+f*h+e*g-c*i,this._z=e*j+f*i+c*h-d*g,this._w=f*j-c*g-d*h-e*i,this._onChangeCallback(),this}slerp(a,b){if(0===b)return this;if(1===b)return this.copy(a);let c=this._x,d=this._y,e=this._z,f=this._w,g=f*a._w+c*a._x+d*a._y+e*a._z;if(g<0?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,g=-g):this.copy(a),g>=1)return this._w=f,this._x=c,this._y=d,this._z=e,this;let h=1-g*g;if(h<=Number.EPSILON){let a=1-b;return this._w=a*f+b*this._w,this._x=a*c+b*this._x,this._y=a*d+b*this._y,this._z=a*e+b*this._z,this.normalize(),this}let i=Math.sqrt(h),j=Math.atan2(i,g),k=Math.sin((1-b)*j)/i,l=Math.sin(b*j)/i;return this._w=f*k+this._w*l,this._x=c*k+this._x*l,this._y=d*k+this._y*l,this._z=e*k+this._z*l,this._onChangeCallback(),this}slerpQuaternions(a,b,c){return this.copy(a).slerp(b,c)}random(){let a=2*Math.PI*Math.random(),b=2*Math.PI*Math.random(),c=Math.random(),d=Math.sqrt(1-c),e=Math.sqrt(c);return this.set(d*Math.sin(a),d*Math.cos(a),e*Math.sin(b),e*Math.cos(b))}equals(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w}fromArray(a,b=0){return this._x=a[b],this._y=a[b+1],this._z=a[b+2],this._w=a[b+3],this._onChangeCallback(),this}toArray(a=[],b=0){return a[b]=this._x,a[b+1]=this._y,a[b+2]=this._z,a[b+3]=this._w,a}fromBufferAttribute(a,b){return this._x=a.getX(b),this._y=a.getY(b),this._z=a.getZ(b),this._w=a.getW(b),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(a){return this._onChangeCallback=a,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class at{constructor(a=0,b=0,c=0){at.prototype.isVector3=!0,this.x=a,this.y=b,this.z=c}set(a,b,c){return void 0===c&&(c=this.z),this.x=a,this.y=b,this.z=c,this}setScalar(a){return this.x=a,this.y=a,this.z=a,this}setX(a){return this.x=a,this}setY(a){return this.y=a,this}setZ(a){return this.z=a,this}setComponent(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error("index is out of range: "+a)}return this}getComponent(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+a)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(a){return this.x=a.x,this.y=a.y,this.z=a.z,this}add(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this}addScalar(a){return this.x+=a,this.y+=a,this.z+=a,this}addVectors(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this}addScaledVector(a,b){return this.x+=a.x*b,this.y+=a.y*b,this.z+=a.z*b,this}sub(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this}subScalar(a){return this.x-=a,this.y-=a,this.z-=a,this}subVectors(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this}multiply(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this}multiplyScalar(a){return this.x*=a,this.y*=a,this.z*=a,this}multiplyVectors(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this}applyEuler(a){return this.applyQuaternion(av.setFromEuler(a))}applyAxisAngle(a,b){return this.applyQuaternion(av.setFromAxisAngle(a,b))}applyMatrix3(a){let b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[3]*c+e[6]*d,this.y=e[1]*b+e[4]*c+e[7]*d,this.z=e[2]*b+e[5]*c+e[8]*d,this}applyNormalMatrix(a){return this.applyMatrix3(a).normalize()}applyMatrix4(a){let b=this.x,c=this.y,d=this.z,e=a.elements,f=1/(e[3]*b+e[7]*c+e[11]*d+e[15]);return this.x=(e[0]*b+e[4]*c+e[8]*d+e[12])*f,this.y=(e[1]*b+e[5]*c+e[9]*d+e[13])*f,this.z=(e[2]*b+e[6]*c+e[10]*d+e[14])*f,this}applyQuaternion(a){let b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z,h=a.w,i=2*(f*d-g*c),j=2*(g*b-e*d),k=2*(e*c-f*b);return this.x=b+h*i+f*k-g*j,this.y=c+h*j+g*i-e*k,this.z=d+h*k+e*j-f*i,this}project(a){return this.applyMatrix4(a.matrixWorldInverse).applyMatrix4(a.projectionMatrix)}unproject(a){return this.applyMatrix4(a.projectionMatrixInverse).applyMatrix4(a.matrixWorld)}transformDirection(a){let b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[4]*c+e[8]*d,this.y=e[1]*b+e[5]*c+e[9]*d,this.z=e[2]*b+e[6]*c+e[10]*d,this.normalize()}divide(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this}divideScalar(a){return this.multiplyScalar(1/a)}min(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this.z=Math.min(this.z,a.z),this}max(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this.z=Math.max(this.z,a.z),this}clamp(a,b){return this.x=Math.max(a.x,Math.min(b.x,this.x)),this.y=Math.max(a.y,Math.min(b.y,this.y)),this.z=Math.max(a.z,Math.min(b.z,this.z)),this}clampScalar(a,b){return this.x=Math.max(a,Math.min(b,this.x)),this.y=Math.max(a,Math.min(b,this.y)),this.z=Math.max(a,Math.min(b,this.z)),this}clampLength(a,b){let c=this.length();return this.divideScalar(c||1).multiplyScalar(Math.max(a,Math.min(b,c)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(a){return this.x*a.x+this.y*a.y+this.z*a.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(a){return this.normalize().multiplyScalar(a)}lerp(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this}lerpVectors(a,b,c){return this.x=a.x+(b.x-a.x)*c,this.y=a.y+(b.y-a.y)*c,this.z=a.z+(b.z-a.z)*c,this}cross(a){return this.crossVectors(this,a)}crossVectors(a,b){let c=a.x,d=a.y,e=a.z,f=b.x,g=b.y,h=b.z;return this.x=d*h-e*g,this.y=e*f-c*h,this.z=c*g-d*f,this}projectOnVector(a){let b=a.lengthSq();if(0===b)return this.set(0,0,0);let c=a.dot(this)/b;return this.copy(a).multiplyScalar(c)}projectOnPlane(a){return au.copy(this).projectOnVector(a),this.sub(au)}reflect(a){return this.sub(au.copy(a).multiplyScalar(2*this.dot(a)))}angleTo(a){let b=Math.sqrt(this.lengthSq()*a.lengthSq());return 0===b?Math.PI/2:Math.acos(X(this.dot(a)/b,-1,1))}distanceTo(a){return Math.sqrt(this.distanceToSquared(a))}distanceToSquared(a){let b=this.x-a.x,c=this.y-a.y,d=this.z-a.z;return b*b+c*c+d*d}manhattanDistanceTo(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-a.z)}setFromSpherical(a){return this.setFromSphericalCoords(a.radius,a.phi,a.theta)}setFromSphericalCoords(a,b,c){let d=Math.sin(b)*a;return this.x=d*Math.sin(c),this.y=Math.cos(b)*a,this.z=d*Math.cos(c),this}setFromCylindrical(a){return this.setFromCylindricalCoords(a.radius,a.theta,a.y)}setFromCylindricalCoords(a,b,c){return this.x=a*Math.sin(b),this.y=c,this.z=a*Math.cos(b),this}setFromMatrixPosition(a){let b=a.elements;return this.x=b[12],this.y=b[13],this.z=b[14],this}setFromMatrixScale(a){let b=this.setFromMatrixColumn(a,0).length(),c=this.setFromMatrixColumn(a,1).length(),d=this.setFromMatrixColumn(a,2).length();return this.x=b,this.y=c,this.z=d,this}setFromMatrixColumn(a,b){return this.fromArray(a.elements,4*b)}setFromMatrix3Column(a,b){return this.fromArray(a.elements,3*b)}setFromEuler(a){return this.x=a._x,this.y=a._y,this.z=a._z,this}setFromColor(a){return this.x=a.r,this.y=a.g,this.z=a.b,this}equals(a){return a.x===this.x&&a.y===this.y&&a.z===this.z}fromArray(a,b=0){return this.x=a[b],this.y=a[b+1],this.z=a[b+2],this}toArray(a=[],b=0){return a[b]=this.x,a[b+1]=this.y,a[b+2]=this.z,a}fromBufferAttribute(a,b){return this.x=a.getX(b),this.y=a.getY(b),this.z=a.getZ(b),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let a=Math.random()*Math.PI*2,b=2*Math.random()-1,c=Math.sqrt(1-b*b);return this.x=c*Math.cos(a),this.y=b,this.z=c*Math.sin(a),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}let au=new at,av=new as;class aw{constructor(a=new at(Infinity,Infinity,Infinity),b=new at(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=a,this.max=b}set(a,b){return this.min.copy(a),this.max.copy(b),this}setFromArray(a){this.makeEmpty();for(let b=0,c=a.length;b<c;b+=3)this.expandByPoint(ay.fromArray(a,b));return this}setFromBufferAttribute(a){this.makeEmpty();for(let b=0,c=a.count;b<c;b++)this.expandByPoint(ay.fromBufferAttribute(a,b));return this}setFromPoints(a){this.makeEmpty();for(let b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this}setFromCenterAndSize(a,b){let c=ay.copy(b).multiplyScalar(.5);return this.min.copy(a).sub(c),this.max.copy(a).add(c),this}setFromObject(a,b=!1){return this.makeEmpty(),this.expandByObject(a,b)}clone(){return new this.constructor().copy(this)}copy(a){return this.min.copy(a.min),this.max.copy(a.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=Infinity,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(a){return this.isEmpty()?a.set(0,0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(a){return this.isEmpty()?a.set(0,0,0):a.subVectors(this.max,this.min)}expandByPoint(a){return this.min.min(a),this.max.max(a),this}expandByVector(a){return this.min.sub(a),this.max.add(a),this}expandByScalar(a){return this.min.addScalar(-a),this.max.addScalar(a),this}expandByObject(a,b=!1){a.updateWorldMatrix(!1,!1);let c=a.geometry;if(void 0!==c){let d=c.getAttribute("position");if(!0===b&&void 0!==d&&!0!==a.isInstancedMesh)for(let b=0,c=d.count;b<c;b++)!0===a.isMesh?a.getVertexPosition(b,ay):ay.fromBufferAttribute(d,b),ay.applyMatrix4(a.matrixWorld),this.expandByPoint(ay);else void 0!==a.boundingBox?(null===a.boundingBox&&a.computeBoundingBox(),az.copy(a.boundingBox)):(null===c.boundingBox&&c.computeBoundingBox(),az.copy(c.boundingBox)),az.applyMatrix4(a.matrixWorld),this.union(az)}let d=a.children;for(let a=0,c=d.length;a<c;a++)this.expandByObject(d[a],b);return this}containsPoint(a){return!(a.x<this.min.x)&&!(a.x>this.max.x)&&!(a.y<this.min.y)&&!(a.y>this.max.y)&&!(a.z<this.min.z)&&!(a.z>this.max.z)}containsBox(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z}getParameter(a,b){return b.set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(a){return!(a.max.x<this.min.x)&&!(a.min.x>this.max.x)&&!(a.max.y<this.min.y)&&!(a.min.y>this.max.y)&&!(a.max.z<this.min.z)&&!(a.min.z>this.max.z)}intersectsSphere(a){return this.clampPoint(a.center,ay),ay.distanceToSquared(a.center)<=a.radius*a.radius}intersectsPlane(a){let b,c;return a.normal.x>0?(b=a.normal.x*this.min.x,c=a.normal.x*this.max.x):(b=a.normal.x*this.max.x,c=a.normal.x*this.min.x),a.normal.y>0?(b+=a.normal.y*this.min.y,c+=a.normal.y*this.max.y):(b+=a.normal.y*this.max.y,c+=a.normal.y*this.min.y),a.normal.z>0?(b+=a.normal.z*this.min.z,c+=a.normal.z*this.max.z):(b+=a.normal.z*this.max.z,c+=a.normal.z*this.min.z),b<=-a.constant&&c>=-a.constant}intersectsTriangle(a){if(this.isEmpty())return!1;this.getCenter(aG),aH.subVectors(this.max,aG),aA.subVectors(a.a,aG),aB.subVectors(a.b,aG),aC.subVectors(a.c,aG),aD.subVectors(aB,aA),aE.subVectors(aC,aB),aF.subVectors(aA,aC);let b=[0,-aD.z,aD.y,0,-aE.z,aE.y,0,-aF.z,aF.y,aD.z,0,-aD.x,aE.z,0,-aE.x,aF.z,0,-aF.x,-aD.y,aD.x,0,-aE.y,aE.x,0,-aF.y,aF.x,0];return!!aK(b,aA,aB,aC,aH)&&!!aK(b=[1,0,0,0,1,0,0,0,1],aA,aB,aC,aH)&&(aI.crossVectors(aD,aE),aK(b=[aI.x,aI.y,aI.z],aA,aB,aC,aH))}clampPoint(a,b){return b.copy(a).clamp(this.min,this.max)}distanceToPoint(a){return this.clampPoint(a,ay).distanceTo(a)}getBoundingSphere(a){return this.isEmpty()?a.makeEmpty():(this.getCenter(a.center),a.radius=.5*this.getSize(ay).length()),a}intersect(a){return this.min.max(a.min),this.max.min(a.max),this.isEmpty()&&this.makeEmpty(),this}union(a){return this.min.min(a.min),this.max.max(a.max),this}applyMatrix4(a){return this.isEmpty()||(ax[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(a),ax[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(a),ax[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(a),ax[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(a),ax[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(a),ax[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(a),ax[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(a),ax[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(a),this.setFromPoints(ax)),this}translate(a){return this.min.add(a),this.max.add(a),this}equals(a){return a.min.equals(this.min)&&a.max.equals(this.max)}}let ax=[new at,new at,new at,new at,new at,new at,new at,new at],ay=new at,az=new aw,aA=new at,aB=new at,aC=new at,aD=new at,aE=new at,aF=new at,aG=new at,aH=new at,aI=new at,aJ=new at;function aK(a,b,c,d,e){for(let f=0,g=a.length-3;f<=g;f+=3){aJ.fromArray(a,f);let g=e.x*Math.abs(aJ.x)+e.y*Math.abs(aJ.y)+e.z*Math.abs(aJ.z),h=b.dot(aJ),i=c.dot(aJ),j=d.dot(aJ);if(Math.max(-Math.max(h,i,j),Math.min(h,i,j))>g)return!1}return!0}let aL=new aw,aM=new at,aN=new at;class aO{constructor(a=new at,b=-1){this.isSphere=!0,this.center=a,this.radius=b}set(a,b){return this.center.copy(a),this.radius=b,this}setFromPoints(a,b){let c=this.center;void 0!==b?c.copy(b):aL.setFromPoints(a).getCenter(c);let d=0;for(let b=0,e=a.length;b<e;b++)d=Math.max(d,c.distanceToSquared(a[b]));return this.radius=Math.sqrt(d),this}copy(a){return this.center.copy(a.center),this.radius=a.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(a){return a.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(a){return a.distanceTo(this.center)-this.radius}intersectsSphere(a){let b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b}intersectsBox(a){return a.intersectsSphere(this)}intersectsPlane(a){return Math.abs(a.distanceToPoint(this.center))<=this.radius}clampPoint(a,b){let c=this.center.distanceToSquared(a);return b.copy(a),c>this.radius*this.radius&&(b.sub(this.center).normalize(),b.multiplyScalar(this.radius).add(this.center)),b}getBoundingBox(a){return this.isEmpty()?a.makeEmpty():(a.set(this.center,this.center),a.expandByScalar(this.radius)),a}applyMatrix4(a){return this.center.applyMatrix4(a),this.radius=this.radius*a.getMaxScaleOnAxis(),this}translate(a){return this.center.add(a),this}expandByPoint(a){if(this.isEmpty())return this.center.copy(a),this.radius=0,this;aM.subVectors(a,this.center);let b=aM.lengthSq();if(b>this.radius*this.radius){let a=Math.sqrt(b),c=(a-this.radius)*.5;this.center.addScaledVector(aM,c/a),this.radius+=c}return this}union(a){return a.isEmpty()||(this.isEmpty()?this.copy(a):!0===this.center.equals(a.center)?this.radius=Math.max(this.radius,a.radius):(aN.subVectors(a.center,this.center).setLength(a.radius),this.expandByPoint(aM.copy(a.center).add(aN)),this.expandByPoint(aM.copy(a.center).sub(aN)))),this}equals(a){return a.center.equals(this.center)&&a.radius===this.radius}clone(){return new this.constructor().copy(this)}}let aP=new at,aQ=new at,aR=new at,aS=new at,aT=new at,aU=new at,aV=new at;class aW{constructor(a=new at,b=new at(0,0,-1)){this.origin=a,this.direction=b}set(a,b){return this.origin.copy(a),this.direction.copy(b),this}copy(a){return this.origin.copy(a.origin),this.direction.copy(a.direction),this}at(a,b){return b.copy(this.origin).addScaledVector(this.direction,a)}lookAt(a){return this.direction.copy(a).sub(this.origin).normalize(),this}recast(a){return this.origin.copy(this.at(a,aP)),this}closestPointToPoint(a,b){b.subVectors(a,this.origin);let c=b.dot(this.direction);return c<0?b.copy(this.origin):b.copy(this.origin).addScaledVector(this.direction,c)}distanceToPoint(a){return Math.sqrt(this.distanceSqToPoint(a))}distanceSqToPoint(a){let b=aP.subVectors(a,this.origin).dot(this.direction);return b<0?this.origin.distanceToSquared(a):(aP.copy(this.origin).addScaledVector(this.direction,b),aP.distanceToSquared(a))}distanceSqToSegment(a,b,c,d){let e,f,g,h;aQ.copy(a).add(b).multiplyScalar(.5),aR.copy(b).sub(a).normalize(),aS.copy(this.origin).sub(aQ);let i=.5*a.distanceTo(b),j=-this.direction.dot(aR),k=aS.dot(this.direction),l=-aS.dot(aR),m=aS.lengthSq(),n=Math.abs(1-j*j);if(n>0)if(e=j*l-k,f=j*k-l,h=i*n,e>=0)if(f>=-h)if(f<=h){let a=1/n;e*=a,f*=a,g=e*(e+j*f+2*k)+f*(j*e+f+2*l)+m}else g=-(e=Math.max(0,-(j*(f=i)+k)))*e+f*(f+2*l)+m;else g=-(e=Math.max(0,-(j*(f=-i)+k)))*e+f*(f+2*l)+m;else f<=-h?(f=(e=Math.max(0,-(-j*i+k)))>0?-i:Math.min(Math.max(-i,-l),i),g=-e*e+f*(f+2*l)+m):f<=h?(e=0,g=(f=Math.min(Math.max(-i,-l),i))*(f+2*l)+m):(f=(e=Math.max(0,-(j*i+k)))>0?i:Math.min(Math.max(-i,-l),i),g=-e*e+f*(f+2*l)+m);else f=j>0?-i:i,g=-(e=Math.max(0,-(j*f+k)))*e+f*(f+2*l)+m;return c&&c.copy(this.origin).addScaledVector(this.direction,e),d&&d.copy(aQ).addScaledVector(aR,f),g}intersectSphere(a,b){aP.subVectors(a.center,this.origin);let c=aP.dot(this.direction),d=aP.dot(aP)-c*c,e=a.radius*a.radius;if(d>e)return null;let f=Math.sqrt(e-d),g=c-f,h=c+f;return h<0?null:g<0?this.at(h,b):this.at(g,b)}intersectsSphere(a){return this.distanceSqToPoint(a.center)<=a.radius*a.radius}distanceToPlane(a){let b=a.normal.dot(this.direction);if(0===b)return 0===a.distanceToPoint(this.origin)?0:null;let c=-(this.origin.dot(a.normal)+a.constant)/b;return c>=0?c:null}intersectPlane(a,b){let c=this.distanceToPlane(a);return null===c?null:this.at(c,b)}intersectsPlane(a){let b=a.distanceToPoint(this.origin);return!!(0===b||a.normal.dot(this.direction)*b<0)}intersectBox(a,b){let c,d,e,f,g,h,i=1/this.direction.x,j=1/this.direction.y,k=1/this.direction.z,l=this.origin;return(i>=0?(c=(a.min.x-l.x)*i,d=(a.max.x-l.x)*i):(c=(a.max.x-l.x)*i,d=(a.min.x-l.x)*i),j>=0?(e=(a.min.y-l.y)*j,f=(a.max.y-l.y)*j):(e=(a.max.y-l.y)*j,f=(a.min.y-l.y)*j),c>f||e>d||((e>c||isNaN(c))&&(c=e),(f<d||isNaN(d))&&(d=f),k>=0?(g=(a.min.z-l.z)*k,h=(a.max.z-l.z)*k):(g=(a.max.z-l.z)*k,h=(a.min.z-l.z)*k),c>h||g>d||((g>c||c!=c)&&(c=g),(h<d||d!=d)&&(d=h),d<0)))?null:this.at(c>=0?c:d,b)}intersectsBox(a){return null!==this.intersectBox(a,aP)}intersectTriangle(a,b,c,d,e){let f;aT.subVectors(b,a),aU.subVectors(c,a),aV.crossVectors(aT,aU);let g=this.direction.dot(aV);if(g>0){if(d)return null;f=1}else{if(!(g<0))return null;f=-1,g=-g}aS.subVectors(this.origin,a);let h=f*this.direction.dot(aU.crossVectors(aS,aU));if(h<0)return null;let i=f*this.direction.dot(aT.cross(aS));if(i<0||h+i>g)return null;let j=-f*aS.dot(aV);return j<0?null:this.at(j/g,e)}applyMatrix4(a){return this.origin.applyMatrix4(a),this.direction.transformDirection(a),this}equals(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class aX{constructor(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){aX.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==a&&this.set(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p)}set(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){let q=this.elements;return q[0]=a,q[4]=b,q[8]=c,q[12]=d,q[1]=e,q[5]=f,q[9]=g,q[13]=h,q[2]=i,q[6]=j,q[10]=k,q[14]=l,q[3]=m,q[7]=n,q[11]=o,q[15]=p,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new aX().fromArray(this.elements)}copy(a){let b=this.elements,c=a.elements;return b[0]=c[0],b[1]=c[1],b[2]=c[2],b[3]=c[3],b[4]=c[4],b[5]=c[5],b[6]=c[6],b[7]=c[7],b[8]=c[8],b[9]=c[9],b[10]=c[10],b[11]=c[11],b[12]=c[12],b[13]=c[13],b[14]=c[14],b[15]=c[15],this}copyPosition(a){let b=this.elements,c=a.elements;return b[12]=c[12],b[13]=c[13],b[14]=c[14],this}setFromMatrix3(a){let b=a.elements;return this.set(b[0],b[3],b[6],0,b[1],b[4],b[7],0,b[2],b[5],b[8],0,0,0,0,1),this}extractBasis(a,b,c){return a.setFromMatrixColumn(this,0),b.setFromMatrixColumn(this,1),c.setFromMatrixColumn(this,2),this}makeBasis(a,b,c){return this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1),this}extractRotation(a){let b=this.elements,c=a.elements,d=1/aY.setFromMatrixColumn(a,0).length(),e=1/aY.setFromMatrixColumn(a,1).length(),f=1/aY.setFromMatrixColumn(a,2).length();return b[0]=c[0]*d,b[1]=c[1]*d,b[2]=c[2]*d,b[3]=0,b[4]=c[4]*e,b[5]=c[5]*e,b[6]=c[6]*e,b[7]=0,b[8]=c[8]*f,b[9]=c[9]*f,b[10]=c[10]*f,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this}makeRotationFromEuler(a){let b=this.elements,c=a.x,d=a.y,e=a.z,f=Math.cos(c),g=Math.sin(c),h=Math.cos(d),i=Math.sin(d),j=Math.cos(e),k=Math.sin(e);if("XYZ"===a.order){let a=f*j,c=f*k,d=g*j,e=g*k;b[0]=h*j,b[4]=-h*k,b[8]=i,b[1]=c+d*i,b[5]=a-e*i,b[9]=-g*h,b[2]=e-a*i,b[6]=d+c*i,b[10]=f*h}else if("YXZ"===a.order){let a=h*j,c=h*k,d=i*j,e=i*k;b[0]=a+e*g,b[4]=d*g-c,b[8]=f*i,b[1]=f*k,b[5]=f*j,b[9]=-g,b[2]=c*g-d,b[6]=e+a*g,b[10]=f*h}else if("ZXY"===a.order){let a=h*j,c=h*k,d=i*j,e=i*k;b[0]=a-e*g,b[4]=-f*k,b[8]=d+c*g,b[1]=c+d*g,b[5]=f*j,b[9]=e-a*g,b[2]=-f*i,b[6]=g,b[10]=f*h}else if("ZYX"===a.order){let a=f*j,c=f*k,d=g*j,e=g*k;b[0]=h*j,b[4]=d*i-c,b[8]=a*i+e,b[1]=h*k,b[5]=e*i+a,b[9]=c*i-d,b[2]=-i,b[6]=g*h,b[10]=f*h}else if("YZX"===a.order){let a=f*h,c=f*i,d=g*h,e=g*i;b[0]=h*j,b[4]=e-a*k,b[8]=d*k+c,b[1]=k,b[5]=f*j,b[9]=-g*j,b[2]=-i*j,b[6]=c*k+d,b[10]=a-e*k}else if("XZY"===a.order){let a=f*h,c=f*i,d=g*h,e=g*i;b[0]=h*j,b[4]=-k,b[8]=i*j,b[1]=a*k+e,b[5]=f*j,b[9]=c*k-d,b[2]=d*k-c,b[6]=g*j,b[10]=e*k+a}return b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this}makeRotationFromQuaternion(a){return this.compose(a$,a,a_)}lookAt(a,b,c){let d=this.elements;return a2.subVectors(a,b),0===a2.lengthSq()&&(a2.z=1),a2.normalize(),a0.crossVectors(c,a2),0===a0.lengthSq()&&(1===Math.abs(c.z)?a2.x+=1e-4:a2.z+=1e-4,a2.normalize(),a0.crossVectors(c,a2)),a0.normalize(),a1.crossVectors(a2,a0),d[0]=a0.x,d[4]=a1.x,d[8]=a2.x,d[1]=a0.y,d[5]=a1.y,d[9]=a2.y,d[2]=a0.z,d[6]=a1.z,d[10]=a2.z,this}multiply(a){return this.multiplyMatrices(this,a)}premultiply(a){return this.multiplyMatrices(a,this)}multiplyMatrices(a,b){let c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[4],h=c[8],i=c[12],j=c[1],k=c[5],l=c[9],m=c[13],n=c[2],o=c[6],p=c[10],q=c[14],r=c[3],s=c[7],t=c[11],u=c[15],v=d[0],w=d[4],x=d[8],y=d[12],z=d[1],A=d[5],B=d[9],C=d[13],D=d[2],E=d[6],F=d[10],G=d[14],H=d[3],I=d[7],J=d[11],K=d[15];return e[0]=f*v+g*z+h*D+i*H,e[4]=f*w+g*A+h*E+i*I,e[8]=f*x+g*B+h*F+i*J,e[12]=f*y+g*C+h*G+i*K,e[1]=j*v+k*z+l*D+m*H,e[5]=j*w+k*A+l*E+m*I,e[9]=j*x+k*B+l*F+m*J,e[13]=j*y+k*C+l*G+m*K,e[2]=n*v+o*z+p*D+q*H,e[6]=n*w+o*A+p*E+q*I,e[10]=n*x+o*B+p*F+q*J,e[14]=n*y+o*C+p*G+q*K,e[3]=r*v+s*z+t*D+u*H,e[7]=r*w+s*A+t*E+u*I,e[11]=r*x+s*B+t*F+u*J,e[15]=r*y+s*C+t*G+u*K,this}multiplyScalar(a){let b=this.elements;return b[0]*=a,b[4]*=a,b[8]*=a,b[12]*=a,b[1]*=a,b[5]*=a,b[9]*=a,b[13]*=a,b[2]*=a,b[6]*=a,b[10]*=a,b[14]*=a,b[3]*=a,b[7]*=a,b[11]*=a,b[15]*=a,this}determinant(){let a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],h=a[9],i=a[13],j=a[2],k=a[6],l=a[10],m=a[14],n=a[3],o=a[7];return n*(e*h*k-d*i*k-e*g*l+c*i*l+d*g*m-c*h*m)+o*(b*h*m-b*i*l+e*f*l-d*f*m+d*i*j-e*h*j)+a[11]*(b*i*k-b*g*m-e*f*k+c*f*m+e*g*j-c*i*j)+a[15]*(-d*g*j-b*h*k+b*g*l+d*f*k-c*f*l+c*h*j)}transpose(){let a,b=this.elements;return a=b[1],b[1]=b[4],b[4]=a,a=b[2],b[2]=b[8],b[8]=a,a=b[6],b[6]=b[9],b[9]=a,a=b[3],b[3]=b[12],b[12]=a,a=b[7],b[7]=b[13],b[13]=a,a=b[11],b[11]=b[14],b[14]=a,this}setPosition(a,b,c){let d=this.elements;return a.isVector3?(d[12]=a.x,d[13]=a.y,d[14]=a.z):(d[12]=a,d[13]=b,d[14]=c),this}invert(){let a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15],r=k*p*i-o*l*i+o*h*m-g*p*m-k*h*q+g*l*q,s=n*l*i-j*p*i-n*h*m+f*p*m+j*h*q-f*l*q,t=j*o*i-n*k*i+n*g*m-f*o*m-j*g*q+f*k*q,u=n*k*h-j*o*h-n*g*l+f*o*l+j*g*p-f*k*p,v=b*r+c*s+d*t+e*u;if(0===v)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let w=1/v;return a[0]=r*w,a[1]=(o*l*e-k*p*e-o*d*m+c*p*m+k*d*q-c*l*q)*w,a[2]=(g*p*e-o*h*e+o*d*i-c*p*i-g*d*q+c*h*q)*w,a[3]=(k*h*e-g*l*e-k*d*i+c*l*i+g*d*m-c*h*m)*w,a[4]=s*w,a[5]=(j*p*e-n*l*e+n*d*m-b*p*m-j*d*q+b*l*q)*w,a[6]=(n*h*e-f*p*e-n*d*i+b*p*i+f*d*q-b*h*q)*w,a[7]=(f*l*e-j*h*e+j*d*i-b*l*i-f*d*m+b*h*m)*w,a[8]=t*w,a[9]=(n*k*e-j*o*e-n*c*m+b*o*m+j*c*q-b*k*q)*w,a[10]=(f*o*e-n*g*e+n*c*i-b*o*i-f*c*q+b*g*q)*w,a[11]=(j*g*e-f*k*e-j*c*i+b*k*i+f*c*m-b*g*m)*w,a[12]=u*w,a[13]=(j*o*d-n*k*d+n*c*l-b*o*l-j*c*p+b*k*p)*w,a[14]=(n*g*d-f*o*d-n*c*h+b*o*h+f*c*p-b*g*p)*w,a[15]=(f*k*d-j*g*d+j*c*h-b*k*h-f*c*l+b*g*l)*w,this}scale(a){let b=this.elements,c=a.x,d=a.y,e=a.z;return b[0]*=c,b[4]*=d,b[8]*=e,b[1]*=c,b[5]*=d,b[9]*=e,b[2]*=c,b[6]*=d,b[10]*=e,b[3]*=c,b[7]*=d,b[11]*=e,this}getMaxScaleOnAxis(){let a=this.elements,b=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];return Math.sqrt(Math.max(b,a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10]))}makeTranslation(a,b,c){return a.isVector3?this.set(1,0,0,a.x,0,1,0,a.y,0,0,1,a.z,0,0,0,1):this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1),this}makeRotationX(a){let b=Math.cos(a),c=Math.sin(a);return this.set(1,0,0,0,0,b,-c,0,0,c,b,0,0,0,0,1),this}makeRotationY(a){let b=Math.cos(a),c=Math.sin(a);return this.set(b,0,c,0,0,1,0,0,-c,0,b,0,0,0,0,1),this}makeRotationZ(a){let b=Math.cos(a),c=Math.sin(a);return this.set(b,-c,0,0,c,b,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(a,b){let c=Math.cos(b),d=Math.sin(b),e=1-c,f=a.x,g=a.y,h=a.z,i=e*f,j=e*g;return this.set(i*f+c,i*g-d*h,i*h+d*g,0,i*g+d*h,j*g+c,j*h-d*f,0,i*h-d*g,j*h+d*f,e*h*h+c,0,0,0,0,1),this}makeScale(a,b,c){return this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1),this}makeShear(a,b,c,d,e,f){return this.set(1,c,e,0,a,1,f,0,b,d,1,0,0,0,0,1),this}compose(a,b,c){let d=this.elements,e=b._x,f=b._y,g=b._z,h=b._w,i=e+e,j=f+f,k=g+g,l=e*i,m=e*j,n=e*k,o=f*j,p=f*k,q=g*k,r=h*i,s=h*j,t=h*k,u=c.x,v=c.y,w=c.z;return d[0]=(1-(o+q))*u,d[1]=(m+t)*u,d[2]=(n-s)*u,d[3]=0,d[4]=(m-t)*v,d[5]=(1-(l+q))*v,d[6]=(p+r)*v,d[7]=0,d[8]=(n+s)*w,d[9]=(p-r)*w,d[10]=(1-(l+o))*w,d[11]=0,d[12]=a.x,d[13]=a.y,d[14]=a.z,d[15]=1,this}decompose(a,b,c){let d=this.elements,e=aY.set(d[0],d[1],d[2]).length(),f=aY.set(d[4],d[5],d[6]).length(),g=aY.set(d[8],d[9],d[10]).length();0>this.determinant()&&(e=-e),a.x=d[12],a.y=d[13],a.z=d[14],aZ.copy(this);let h=1/e,i=1/f,j=1/g;return aZ.elements[0]*=h,aZ.elements[1]*=h,aZ.elements[2]*=h,aZ.elements[4]*=i,aZ.elements[5]*=i,aZ.elements[6]*=i,aZ.elements[8]*=j,aZ.elements[9]*=j,aZ.elements[10]*=j,b.setFromRotationMatrix(aZ),c.x=e,c.y=f,c.z=g,this}makePerspective(a,b,c,d,e,f,g=2e3){let h,i,j=this.elements;if(2e3===g)h=-(f+e)/(f-e),i=-2*f*e/(f-e);else if(2001===g)h=-f/(f-e),i=-f*e/(f-e);else throw Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+g);return j[0]=2*e/(b-a),j[4]=0,j[8]=(b+a)/(b-a),j[12]=0,j[1]=0,j[5]=2*e/(c-d),j[9]=(c+d)/(c-d),j[13]=0,j[2]=0,j[6]=0,j[10]=h,j[14]=i,j[3]=0,j[7]=0,j[11]=-1,j[15]=0,this}makeOrthographic(a,b,c,d,e,f,g=2e3){let h,i,j=this.elements,k=1/(b-a),l=1/(c-d),m=1/(f-e);if(2e3===g)h=(f+e)*m,i=-2*m;else if(2001===g)h=e*m,i=-1*m;else throw Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+g);return j[0]=2*k,j[4]=0,j[8]=0,j[12]=-((b+a)*k),j[1]=0,j[5]=2*l,j[9]=0,j[13]=-((c+d)*l),j[2]=0,j[6]=0,j[10]=i,j[14]=-h,j[3]=0,j[7]=0,j[11]=0,j[15]=1,this}equals(a){let b=this.elements,c=a.elements;for(let a=0;a<16;a++)if(b[a]!==c[a])return!1;return!0}fromArray(a,b=0){for(let c=0;c<16;c++)this.elements[c]=a[c+b];return this}toArray(a=[],b=0){let c=this.elements;return a[b]=c[0],a[b+1]=c[1],a[b+2]=c[2],a[b+3]=c[3],a[b+4]=c[4],a[b+5]=c[5],a[b+6]=c[6],a[b+7]=c[7],a[b+8]=c[8],a[b+9]=c[9],a[b+10]=c[10],a[b+11]=c[11],a[b+12]=c[12],a[b+13]=c[13],a[b+14]=c[14],a[b+15]=c[15],a}}let aY=new at,aZ=new aX,a$=new at(0,0,0),a_=new at(1,1,1),a0=new at,a1=new at,a2=new at,a3=new aX,a4=new as;class a5{constructor(a=0,b=0,c=0,d=a5.DEFAULT_ORDER){this.isEuler=!0,this._x=a,this._y=b,this._z=c,this._order=d}get x(){return this._x}set x(a){this._x=a,this._onChangeCallback()}get y(){return this._y}set y(a){this._y=a,this._onChangeCallback()}get z(){return this._z}set z(a){this._z=a,this._onChangeCallback()}get order(){return this._order}set order(a){this._order=a,this._onChangeCallback()}set(a,b,c,d=this._order){return this._x=a,this._y=b,this._z=c,this._order=d,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(a){return this._x=a._x,this._y=a._y,this._z=a._z,this._order=a._order,this._onChangeCallback(),this}setFromRotationMatrix(a,b=this._order,c=!0){let d=a.elements,e=d[0],f=d[4],g=d[8],h=d[1],i=d[5],j=d[9],k=d[2],l=d[6],m=d[10];switch(b){case"XYZ":this._y=Math.asin(X(g,-1,1)),.9999999>Math.abs(g)?(this._x=Math.atan2(-j,m),this._z=Math.atan2(-f,e)):(this._x=Math.atan2(l,i),this._z=0);break;case"YXZ":this._x=Math.asin(-X(j,-1,1)),.9999999>Math.abs(j)?(this._y=Math.atan2(g,m),this._z=Math.atan2(h,i)):(this._y=Math.atan2(-k,e),this._z=0);break;case"ZXY":this._x=Math.asin(X(l,-1,1)),.9999999>Math.abs(l)?(this._y=Math.atan2(-k,m),this._z=Math.atan2(-f,i)):(this._y=0,this._z=Math.atan2(h,e));break;case"ZYX":this._y=Math.asin(-X(k,-1,1)),.9999999>Math.abs(k)?(this._x=Math.atan2(l,m),this._z=Math.atan2(h,e)):(this._x=0,this._z=Math.atan2(-f,i));break;case"YZX":this._z=Math.asin(X(h,-1,1)),.9999999>Math.abs(h)?(this._x=Math.atan2(-j,i),this._y=Math.atan2(-k,e)):(this._x=0,this._y=Math.atan2(g,m));break;case"XZY":this._z=Math.asin(-X(f,-1,1)),.9999999>Math.abs(f)?(this._x=Math.atan2(l,i),this._y=Math.atan2(g,e)):(this._x=Math.atan2(-j,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+b)}return this._order=b,!0===c&&this._onChangeCallback(),this}setFromQuaternion(a,b,c){return a3.makeRotationFromQuaternion(a),this.setFromRotationMatrix(a3,b,c)}setFromVector3(a,b=this._order){return this.set(a.x,a.y,a.z,b)}reorder(a){return a4.setFromEuler(this),this.setFromQuaternion(a4,a)}equals(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order}fromArray(a){return this._x=a[0],this._y=a[1],this._z=a[2],void 0!==a[3]&&(this._order=a[3]),this._onChangeCallback(),this}toArray(a=[],b=0){return a[b]=this._x,a[b+1]=this._y,a[b+2]=this._z,a[b+3]=this._order,a}_onChange(a){return this._onChangeCallback=a,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}a5.DEFAULT_ORDER="XYZ";class a6{constructor(){this.mask=1}set(a){this.mask=1<<a>>>0}enable(a){this.mask|=1<<a}enableAll(){this.mask=-1}toggle(a){this.mask^=1<<a}disable(a){this.mask&=~(1<<a)}disableAll(){this.mask=0}test(a){return(this.mask&a.mask)!=0}isEnabled(a){return(this.mask&1<<a)!=0}}let a7=0,a8=new at,a9=new as,ba=new aX,bb=new at,bc=new at,bd=new at,be=new as,bf=new at(1,0,0),bg=new at(0,1,0),bh=new at(0,0,1),bi={type:"added"},bj={type:"removed"},bk={type:"childadded",child:null},bl={type:"childremoved",child:null};class bm extends S{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:a7++}),this.uuid=W(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=bm.DEFAULT_UP.clone();let a=new at,b=new a5,c=new as,d=new at(1,1,1);b._onChange(function(){c.setFromEuler(b,!1)}),c._onChange(function(){b.setFromQuaternion(c,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:a},rotation:{configurable:!0,enumerable:!0,value:b},quaternion:{configurable:!0,enumerable:!0,value:c},scale:{configurable:!0,enumerable:!0,value:d},modelViewMatrix:{value:new aX},normalMatrix:{value:new aa}}),this.matrix=new aX,this.matrixWorld=new aX,this.matrixAutoUpdate=bm.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=bm.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new a6,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(a){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(a),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(a){return this.quaternion.premultiply(a),this}setRotationFromAxisAngle(a,b){this.quaternion.setFromAxisAngle(a,b)}setRotationFromEuler(a){this.quaternion.setFromEuler(a,!0)}setRotationFromMatrix(a){this.quaternion.setFromRotationMatrix(a)}setRotationFromQuaternion(a){this.quaternion.copy(a)}rotateOnAxis(a,b){return a9.setFromAxisAngle(a,b),this.quaternion.multiply(a9),this}rotateOnWorldAxis(a,b){return a9.setFromAxisAngle(a,b),this.quaternion.premultiply(a9),this}rotateX(a){return this.rotateOnAxis(bf,a)}rotateY(a){return this.rotateOnAxis(bg,a)}rotateZ(a){return this.rotateOnAxis(bh,a)}translateOnAxis(a,b){return a8.copy(a).applyQuaternion(this.quaternion),this.position.add(a8.multiplyScalar(b)),this}translateX(a){return this.translateOnAxis(bf,a)}translateY(a){return this.translateOnAxis(bg,a)}translateZ(a){return this.translateOnAxis(bh,a)}localToWorld(a){return this.updateWorldMatrix(!0,!1),a.applyMatrix4(this.matrixWorld)}worldToLocal(a){return this.updateWorldMatrix(!0,!1),a.applyMatrix4(ba.copy(this.matrixWorld).invert())}lookAt(a,b,c){a.isVector3?bb.copy(a):bb.set(a,b,c);let d=this.parent;this.updateWorldMatrix(!0,!1),bc.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ba.lookAt(bc,bb,this.up):ba.lookAt(bb,bc,this.up),this.quaternion.setFromRotationMatrix(ba),d&&(ba.extractRotation(d.matrixWorld),a9.setFromRotationMatrix(ba),this.quaternion.premultiply(a9.invert()))}add(a){if(arguments.length>1){for(let a=0;a<arguments.length;a++)this.add(arguments[a]);return this}return a===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",a):a&&a.isObject3D?(a.removeFromParent(),a.parent=this,this.children.push(a),a.dispatchEvent(bi),bk.child=a,this.dispatchEvent(bk),bk.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",a),this}remove(a){if(arguments.length>1){for(let a=0;a<arguments.length;a++)this.remove(arguments[a]);return this}let b=this.children.indexOf(a);return -1!==b&&(a.parent=null,this.children.splice(b,1),a.dispatchEvent(bj),bl.child=a,this.dispatchEvent(bl),bl.child=null),this}removeFromParent(){let a=this.parent;return null!==a&&a.remove(this),this}clear(){return this.remove(...this.children)}attach(a){return this.updateWorldMatrix(!0,!1),ba.copy(this.matrixWorld).invert(),null!==a.parent&&(a.parent.updateWorldMatrix(!0,!1),ba.multiply(a.parent.matrixWorld)),a.applyMatrix4(ba),a.removeFromParent(),a.parent=this,this.children.push(a),a.updateWorldMatrix(!1,!0),a.dispatchEvent(bi),bk.child=a,this.dispatchEvent(bk),bk.child=null,this}getObjectById(a){return this.getObjectByProperty("id",a)}getObjectByName(a){return this.getObjectByProperty("name",a)}getObjectByProperty(a,b){if(this[a]===b)return this;for(let c=0,d=this.children.length;c<d;c++){let d=this.children[c].getObjectByProperty(a,b);if(void 0!==d)return d}}getObjectsByProperty(a,b,c=[]){this[a]===b&&c.push(this);let d=this.children;for(let e=0,f=d.length;e<f;e++)d[e].getObjectsByProperty(a,b,c);return c}getWorldPosition(a){return this.updateWorldMatrix(!0,!1),a.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(a){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(bc,a,bd),a}getWorldScale(a){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(bc,be,a),a}getWorldDirection(a){this.updateWorldMatrix(!0,!1);let b=this.matrixWorld.elements;return a.set(b[8],b[9],b[10]).normalize()}raycast(){}traverse(a){a(this);let b=this.children;for(let c=0,d=b.length;c<d;c++)b[c].traverse(a)}traverseVisible(a){if(!1===this.visible)return;a(this);let b=this.children;for(let c=0,d=b.length;c<d;c++)b[c].traverseVisible(a)}traverseAncestors(a){let b=this.parent;null!==b&&(a(b),b.traverseAncestors(a))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(a){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||a)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0);let b=this.children;for(let c=0,d=b.length;c<d;c++){let d=b[c];(!0===d.matrixWorldAutoUpdate||!0===a)&&d.updateMatrixWorld(a)}}updateWorldMatrix(a,b){let c=this.parent;if(!0===a&&null!==c&&!0===c.matrixWorldAutoUpdate&&c.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===b){let a=this.children;for(let b=0,c=a.length;b<c;b++){let c=a[b];!0===c.matrixWorldAutoUpdate&&c.updateWorldMatrix(!1,!0)}}}toJSON(a){let b=void 0===a||"string"==typeof a,c={};b&&(a={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},c.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});let d={};function e(b,c){return void 0===b[c.uuid]&&(b[c.uuid]=c.toJSON(a)),c.uuid}if(d.uuid=this.uuid,d.type=this.type,""!==this.name&&(d.name=this.name),!0===this.castShadow&&(d.castShadow=!0),!0===this.receiveShadow&&(d.receiveShadow=!0),!1===this.visible&&(d.visible=!1),!1===this.frustumCulled&&(d.frustumCulled=!1),0!==this.renderOrder&&(d.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(d.userData=this.userData),d.layers=this.layers.mask,d.matrix=this.matrix.toArray(),d.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(d.matrixAutoUpdate=!1),this.isInstancedMesh&&(d.type="InstancedMesh",d.count=this.count,d.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(d.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(d.type="BatchedMesh",d.perObjectFrustumCulled=this.perObjectFrustumCulled,d.sortObjects=this.sortObjects,d.drawRanges=this._drawRanges,d.reservedRanges=this._reservedRanges,d.visibility=this._visibility,d.active=this._active,d.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),d.maxGeometryCount=this._maxGeometryCount,d.maxVertexCount=this._maxVertexCount,d.maxIndexCount=this._maxIndexCount,d.geometryInitialized=this._geometryInitialized,d.geometryCount=this._geometryCount,d.matricesTexture=this._matricesTexture.toJSON(a),null!==this.boundingSphere&&(d.boundingSphere={center:d.boundingSphere.center.toArray(),radius:d.boundingSphere.radius}),null!==this.boundingBox&&(d.boundingBox={min:d.boundingBox.min.toArray(),max:d.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?d.background=this.background.toJSON():this.background.isTexture&&(d.background=this.background.toJSON(a).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(d.environment=this.environment.toJSON(a).uuid);else if(this.isMesh||this.isLine||this.isPoints){d.geometry=e(a.geometries,this.geometry);let b=this.geometry.parameters;if(void 0!==b&&void 0!==b.shapes){let c=b.shapes;if(Array.isArray(c))for(let b=0,d=c.length;b<d;b++){let d=c[b];e(a.shapes,d)}else e(a.shapes,c)}}if(this.isSkinnedMesh&&(d.bindMode=this.bindMode,d.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(e(a.skeletons,this.skeleton),d.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){let b=[];for(let c=0,d=this.material.length;c<d;c++)b.push(e(a.materials,this.material[c]));d.material=b}else d.material=e(a.materials,this.material);if(this.children.length>0){d.children=[];for(let b=0;b<this.children.length;b++)d.children.push(this.children[b].toJSON(a).object)}if(this.animations.length>0){d.animations=[];for(let b=0;b<this.animations.length;b++){let c=this.animations[b];d.animations.push(e(a.animations,c))}}if(b){let b=f(a.geometries),d=f(a.materials),e=f(a.textures),g=f(a.images),h=f(a.shapes),i=f(a.skeletons),j=f(a.animations),k=f(a.nodes);b.length>0&&(c.geometries=b),d.length>0&&(c.materials=d),e.length>0&&(c.textures=e),g.length>0&&(c.images=g),h.length>0&&(c.shapes=h),i.length>0&&(c.skeletons=i),j.length>0&&(c.animations=j),k.length>0&&(c.nodes=k)}return c.object=d,c;function f(a){let b=[];for(let c in a){let d=a[c];delete d.metadata,b.push(d)}return b}}clone(a){return new this.constructor().copy(this,a)}copy(a,b=!0){if(this.name=a.name,this.up.copy(a.up),this.position.copy(a.position),this.rotation.order=a.rotation.order,this.quaternion.copy(a.quaternion),this.scale.copy(a.scale),this.matrix.copy(a.matrix),this.matrixWorld.copy(a.matrixWorld),this.matrixAutoUpdate=a.matrixAutoUpdate,this.matrixWorldAutoUpdate=a.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate,this.layers.mask=a.layers.mask,this.visible=a.visible,this.castShadow=a.castShadow,this.receiveShadow=a.receiveShadow,this.frustumCulled=a.frustumCulled,this.renderOrder=a.renderOrder,this.animations=a.animations.slice(),this.userData=JSON.parse(JSON.stringify(a.userData)),!0===b)for(let b=0;b<a.children.length;b++){let c=a.children[b];this.add(c.clone())}return this}}bm.DEFAULT_UP=new at(0,1,0),bm.DEFAULT_MATRIX_AUTO_UPDATE=!0,bm.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;let bn=new at,bo=new at,bp=new at,bq=new at,br=new at,bs=new at,bt=new at,bu=new at,bv=new at,bw=new at;class bx{constructor(a=new at,b=new at,c=new at){this.a=a,this.b=b,this.c=c}static getNormal(a,b,c,d){d.subVectors(c,b),bn.subVectors(a,b),d.cross(bn);let e=d.lengthSq();return e>0?d.multiplyScalar(1/Math.sqrt(e)):d.set(0,0,0)}static getBarycoord(a,b,c,d,e){bn.subVectors(d,b),bo.subVectors(c,b),bp.subVectors(a,b);let f=bn.dot(bn),g=bn.dot(bo),h=bn.dot(bp),i=bo.dot(bo),j=bo.dot(bp),k=f*i-g*g;if(0===k)return e.set(0,0,0),null;let l=1/k,m=(i*h-g*j)*l,n=(f*j-g*h)*l;return e.set(1-m-n,n,m)}static containsPoint(a,b,c,d){return null!==this.getBarycoord(a,b,c,d,bq)&&bq.x>=0&&bq.y>=0&&bq.x+bq.y<=1}static getInterpolation(a,b,c,d,e,f,g,h){return null===this.getBarycoord(a,b,c,d,bq)?(h.x=0,h.y=0,"z"in h&&(h.z=0),"w"in h&&(h.w=0),null):(h.setScalar(0),h.addScaledVector(e,bq.x),h.addScaledVector(f,bq.y),h.addScaledVector(g,bq.z),h)}static isFrontFacing(a,b,c,d){return bn.subVectors(c,b),bo.subVectors(a,b),0>bn.cross(bo).dot(d)}set(a,b,c){return this.a.copy(a),this.b.copy(b),this.c.copy(c),this}setFromPointsAndIndices(a,b,c,d){return this.a.copy(a[b]),this.b.copy(a[c]),this.c.copy(a[d]),this}setFromAttributeAndIndices(a,b,c,d){return this.a.fromBufferAttribute(a,b),this.b.fromBufferAttribute(a,c),this.c.fromBufferAttribute(a,d),this}clone(){return new this.constructor().copy(this)}copy(a){return this.a.copy(a.a),this.b.copy(a.b),this.c.copy(a.c),this}getArea(){return bn.subVectors(this.c,this.b),bo.subVectors(this.a,this.b),.5*bn.cross(bo).length()}getMidpoint(a){return a.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(a){return bx.getNormal(this.a,this.b,this.c,a)}getPlane(a){return a.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(a,b){return bx.getBarycoord(a,this.a,this.b,this.c,b)}getInterpolation(a,b,c,d,e){return bx.getInterpolation(a,this.a,this.b,this.c,b,c,d,e)}containsPoint(a){return bx.containsPoint(a,this.a,this.b,this.c)}isFrontFacing(a){return bx.isFrontFacing(this.a,this.b,this.c,a)}intersectsBox(a){return a.intersectsTriangle(this)}closestPointToPoint(a,b){let c,d,e=this.a,f=this.b,g=this.c;br.subVectors(f,e),bs.subVectors(g,e),bu.subVectors(a,e);let h=br.dot(bu),i=bs.dot(bu);if(h<=0&&i<=0)return b.copy(e);bv.subVectors(a,f);let j=br.dot(bv),k=bs.dot(bv);if(j>=0&&k<=j)return b.copy(f);let l=h*k-j*i;if(l<=0&&h>=0&&j<=0)return c=h/(h-j),b.copy(e).addScaledVector(br,c);bw.subVectors(a,g);let m=br.dot(bw),n=bs.dot(bw);if(n>=0&&m<=n)return b.copy(g);let o=m*i-h*n;if(o<=0&&i>=0&&n<=0)return d=i/(i-n),b.copy(e).addScaledVector(bs,d);let p=j*n-m*k;if(p<=0&&k-j>=0&&m-n>=0)return bt.subVectors(g,f),d=(k-j)/(k-j+(m-n)),b.copy(f).addScaledVector(bt,d);let q=1/(p+o+l);return c=o*q,d=l*q,b.copy(e).addScaledVector(br,c).addScaledVector(bs,d)}equals(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)}}let by={aliceblue:0xf0f8ff,antiquewhite:0xfaebd7,aqua:65535,aquamarine:8388564,azure:0xf0ffff,beige:0xf5f5dc,bisque:0xffe4c4,black:0,blanchedalmond:0xffebcd,blue:255,blueviolet:9055202,brown:0xa52a2a,burlywood:0xdeb887,cadetblue:6266528,chartreuse:8388352,chocolate:0xd2691e,coral:0xff7f50,cornflowerblue:6591981,cornsilk:0xfff8dc,crimson:0xdc143c,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:0xb8860b,darkgray:0xa9a9a9,darkgreen:25600,darkgrey:0xa9a9a9,darkkhaki:0xbdb76b,darkmagenta:9109643,darkolivegreen:5597999,darkorange:0xff8c00,darkorchid:0x9932cc,darkred:9109504,darksalmon:0xe9967a,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:0xff1493,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:0xb22222,floralwhite:0xfffaf0,forestgreen:2263842,fuchsia:0xff00ff,gainsboro:0xdcdcdc,ghostwhite:0xf8f8ff,gold:0xffd700,goldenrod:0xdaa520,gray:8421504,green:32768,greenyellow:0xadff2f,grey:8421504,honeydew:0xf0fff0,hotpink:0xff69b4,indianred:0xcd5c5c,indigo:4915330,ivory:0xfffff0,khaki:0xf0e68c,lavender:0xe6e6fa,lavenderblush:0xfff0f5,lawngreen:8190976,lemonchiffon:0xfffacd,lightblue:0xadd8e6,lightcoral:0xf08080,lightcyan:0xe0ffff,lightgoldenrodyellow:0xfafad2,lightgray:0xd3d3d3,lightgreen:9498256,lightgrey:0xd3d3d3,lightpink:0xffb6c1,lightsalmon:0xffa07a,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:0xb0c4de,lightyellow:0xffffe0,lime:65280,limegreen:3329330,linen:0xfaf0e6,magenta:0xff00ff,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:0xba55d3,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:0xc71585,midnightblue:1644912,mintcream:0xf5fffa,mistyrose:0xffe4e1,moccasin:0xffe4b5,navajowhite:0xffdead,navy:128,oldlace:0xfdf5e6,olive:8421376,olivedrab:7048739,orange:0xffa500,orangered:0xff4500,orchid:0xda70d6,palegoldenrod:0xeee8aa,palegreen:0x98fb98,paleturquoise:0xafeeee,palevioletred:0xdb7093,papayawhip:0xffefd5,peachpuff:0xffdab9,peru:0xcd853f,pink:0xffc0cb,plum:0xdda0dd,powderblue:0xb0e0e6,purple:8388736,rebeccapurple:6697881,red:0xff0000,rosybrown:0xbc8f8f,royalblue:4286945,saddlebrown:9127187,salmon:0xfa8072,sandybrown:0xf4a460,seagreen:3050327,seashell:0xfff5ee,sienna:0xa0522d,silver:0xc0c0c0,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:0xfffafa,springgreen:65407,steelblue:4620980,tan:0xd2b48c,teal:32896,thistle:0xd8bfd8,tomato:0xff6347,turquoise:4251856,violet:0xee82ee,wheat:0xf5deb3,white:0xffffff,whitesmoke:0xf5f5f5,yellow:0xffff00,yellowgreen:0x9acd32},bz={h:0,s:0,l:0},bA={h:0,s:0,l:0};function bB(a,b,c){return(c<0&&(c+=1),c>1&&(c-=1),c<1/6)?a+(b-a)*6*c:c<.5?b:c<2/3?a+(b-a)*6*(2/3-c):a}class bC{constructor(a,b,c){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(a,b,c)}set(a,b,c){return void 0===b&&void 0===c?a&&a.isColor?this.copy(a):"number"==typeof a?this.setHex(a):"string"==typeof a&&this.setStyle(a):this.setRGB(a,b,c),this}setScalar(a){return this.r=a,this.g=a,this.b=a,this}setHex(a,b=M){return a=Math.floor(a),this.r=(a>>16&255)/255,this.g=(a>>8&255)/255,this.b=(255&a)/255,ai.toWorkingColorSpace(this,b),this}setRGB(a,b,c,d=ai.workingColorSpace){return this.r=a,this.g=b,this.b=c,ai.toWorkingColorSpace(this,d),this}setHSL(a,b,c,d=ai.workingColorSpace){var e;if(a=(a%1+(e=1))%e,b=X(b,0,1),c=X(c,0,1),0===b)this.r=this.g=this.b=c;else{let d=c<=.5?c*(1+b):c+b-c*b,e=2*c-d;this.r=bB(e,d,a+1/3),this.g=bB(e,d,a),this.b=bB(e,d,a-1/3)}return ai.toWorkingColorSpace(this,d),this}setStyle(a,b=M){let c;function d(b){void 0!==b&&1>parseFloat(b)&&console.warn("THREE.Color: Alpha component of "+a+" will be ignored.")}if(c=/^(\w+)\(([^\)]*)\)/.exec(a)){let e,f=c[1],g=c[2];switch(f){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(g))return d(e[4]),this.setRGB(Math.min(255,parseInt(e[1],10))/255,Math.min(255,parseInt(e[2],10))/255,Math.min(255,parseInt(e[3],10))/255,b);if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(g))return d(e[4]),this.setRGB(Math.min(100,parseInt(e[1],10))/100,Math.min(100,parseInt(e[2],10))/100,Math.min(100,parseInt(e[3],10))/100,b);break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(g))return d(e[4]),this.setHSL(parseFloat(e[1])/360,parseFloat(e[2])/100,parseFloat(e[3])/100,b);break;default:console.warn("THREE.Color: Unknown color model "+a)}}else if(c=/^\#([A-Fa-f\d]+)$/.exec(a)){let d=c[1],e=d.length;if(3===e)return this.setRGB(parseInt(d.charAt(0),16)/15,parseInt(d.charAt(1),16)/15,parseInt(d.charAt(2),16)/15,b);if(6===e)return this.setHex(parseInt(d,16),b);console.warn("THREE.Color: Invalid hex color "+a)}else if(a&&a.length>0)return this.setColorName(a,b);return this}setColorName(a,b=M){let c=by[a.toLowerCase()];return void 0!==c?this.setHex(c,b):console.warn("THREE.Color: Unknown color "+a),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(a){return this.r=a.r,this.g=a.g,this.b=a.b,this}copySRGBToLinear(a){return this.r=aj(a.r),this.g=aj(a.g),this.b=aj(a.b),this}copyLinearToSRGB(a){return this.r=ak(a.r),this.g=ak(a.g),this.b=ak(a.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(a=M){return ai.fromWorkingColorSpace(bD.copy(this),a),65536*Math.round(X(255*bD.r,0,255))+256*Math.round(X(255*bD.g,0,255))+Math.round(X(255*bD.b,0,255))}getHexString(a=M){return("000000"+this.getHex(a).toString(16)).slice(-6)}getHSL(a,b=ai.workingColorSpace){let c,d;ai.fromWorkingColorSpace(bD.copy(this),b);let e=bD.r,f=bD.g,g=bD.b,h=Math.max(e,f,g),i=Math.min(e,f,g),j=(i+h)/2;if(i===h)c=0,d=0;else{let a=h-i;switch(d=j<=.5?a/(h+i):a/(2-h-i),h){case e:c=(f-g)/a+6*(f<g);break;case f:c=(g-e)/a+2;break;case g:c=(e-f)/a+4}c/=6}return a.h=c,a.s=d,a.l=j,a}getRGB(a,b=ai.workingColorSpace){return ai.fromWorkingColorSpace(bD.copy(this),b),a.r=bD.r,a.g=bD.g,a.b=bD.b,a}getStyle(a=M){ai.fromWorkingColorSpace(bD.copy(this),a);let b=bD.r,c=bD.g,d=bD.b;return a!==M?`color(${a} ${b.toFixed(3)} ${c.toFixed(3)} ${d.toFixed(3)})`:`rgb(${Math.round(255*b)},${Math.round(255*c)},${Math.round(255*d)})`}offsetHSL(a,b,c){return this.getHSL(bz),this.setHSL(bz.h+a,bz.s+b,bz.l+c)}add(a){return this.r+=a.r,this.g+=a.g,this.b+=a.b,this}addColors(a,b){return this.r=a.r+b.r,this.g=a.g+b.g,this.b=a.b+b.b,this}addScalar(a){return this.r+=a,this.g+=a,this.b+=a,this}sub(a){return this.r=Math.max(0,this.r-a.r),this.g=Math.max(0,this.g-a.g),this.b=Math.max(0,this.b-a.b),this}multiply(a){return this.r*=a.r,this.g*=a.g,this.b*=a.b,this}multiplyScalar(a){return this.r*=a,this.g*=a,this.b*=a,this}lerp(a,b){return this.r+=(a.r-this.r)*b,this.g+=(a.g-this.g)*b,this.b+=(a.b-this.b)*b,this}lerpColors(a,b,c){return this.r=a.r+(b.r-a.r)*c,this.g=a.g+(b.g-a.g)*c,this.b=a.b+(b.b-a.b)*c,this}lerpHSL(a,b){var c,d,e,f,g,h,i,j,k;this.getHSL(bz),a.getHSL(bA);let l=(c=bz.h,d=bA.h,(1-(e=b))*c+e*d),m=(f=bz.s,g=bA.s,(1-(h=b))*f+h*g),n=(i=bz.l,j=bA.l,(1-(k=b))*i+k*j);return this.setHSL(l,m,n),this}setFromVector3(a){return this.r=a.x,this.g=a.y,this.b=a.z,this}applyMatrix3(a){let b=this.r,c=this.g,d=this.b,e=a.elements;return this.r=e[0]*b+e[3]*c+e[6]*d,this.g=e[1]*b+e[4]*c+e[7]*d,this.b=e[2]*b+e[5]*c+e[8]*d,this}equals(a){return a.r===this.r&&a.g===this.g&&a.b===this.b}fromArray(a,b=0){return this.r=a[b],this.g=a[b+1],this.b=a[b+2],this}toArray(a=[],b=0){return a[b]=this.r,a[b+1]=this.g,a[b+2]=this.b,a}fromBufferAttribute(a,b){return this.r=a.getX(b),this.g=a.getY(b),this.b=a.getZ(b),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let bD=new bC;bC.NAMES=by;let bE=0;class bF extends S{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:bE++}),this.uuid=W(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new bC(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(a){this._alphaTest>0!=a>0&&this.version++,this._alphaTest=a}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(a){if(void 0!==a)for(let b in a){let c=a[b];if(void 0===c){console.warn(`THREE.Material: parameter '${b}' has value of undefined.`);continue}let d=this[b];if(void 0===d){console.warn(`THREE.Material: '${b}' is not a property of THREE.${this.type}.`);continue}d&&d.isColor?d.set(c):d&&d.isVector3&&c&&c.isVector3?d.copy(c):this[b]=c}}toJSON(a){let b=void 0===a||"string"==typeof a;b&&(a={textures:{},images:{}});let c={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function d(a){let b=[];for(let c in a){let d=a[c];delete d.metadata,b.push(d)}return b}if(c.uuid=this.uuid,c.type=this.type,""!==this.name&&(c.name=this.name),this.color&&this.color.isColor&&(c.color=this.color.getHex()),void 0!==this.roughness&&(c.roughness=this.roughness),void 0!==this.metalness&&(c.metalness=this.metalness),void 0!==this.sheen&&(c.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(c.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(c.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(c.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(c.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(c.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(c.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(c.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(c.shininess=this.shininess),void 0!==this.clearcoat&&(c.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(c.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(c.clearcoatMap=this.clearcoatMap.toJSON(a).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(c.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(a).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(c.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(a).uuid,c.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(c.dispersion=this.dispersion),void 0!==this.iridescence&&(c.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(c.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(c.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(c.iridescenceMap=this.iridescenceMap.toJSON(a).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(c.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(a).uuid),void 0!==this.anisotropy&&(c.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(c.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(c.anisotropyMap=this.anisotropyMap.toJSON(a).uuid),this.map&&this.map.isTexture&&(c.map=this.map.toJSON(a).uuid),this.matcap&&this.matcap.isTexture&&(c.matcap=this.matcap.toJSON(a).uuid),this.alphaMap&&this.alphaMap.isTexture&&(c.alphaMap=this.alphaMap.toJSON(a).uuid),this.lightMap&&this.lightMap.isTexture&&(c.lightMap=this.lightMap.toJSON(a).uuid,c.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(c.aoMap=this.aoMap.toJSON(a).uuid,c.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(c.bumpMap=this.bumpMap.toJSON(a).uuid,c.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(c.normalMap=this.normalMap.toJSON(a).uuid,c.normalMapType=this.normalMapType,c.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(c.displacementMap=this.displacementMap.toJSON(a).uuid,c.displacementScale=this.displacementScale,c.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(c.roughnessMap=this.roughnessMap.toJSON(a).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(c.metalnessMap=this.metalnessMap.toJSON(a).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(c.emissiveMap=this.emissiveMap.toJSON(a).uuid),this.specularMap&&this.specularMap.isTexture&&(c.specularMap=this.specularMap.toJSON(a).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(c.specularIntensityMap=this.specularIntensityMap.toJSON(a).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(c.specularColorMap=this.specularColorMap.toJSON(a).uuid),this.envMap&&this.envMap.isTexture&&(c.envMap=this.envMap.toJSON(a).uuid,void 0!==this.combine&&(c.combine=this.combine)),void 0!==this.envMapRotation&&(c.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(c.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(c.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(c.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(c.gradientMap=this.gradientMap.toJSON(a).uuid),void 0!==this.transmission&&(c.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(c.transmissionMap=this.transmissionMap.toJSON(a).uuid),void 0!==this.thickness&&(c.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(c.thicknessMap=this.thicknessMap.toJSON(a).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(c.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(c.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(c.size=this.size),null!==this.shadowSide&&(c.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(c.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(c.blending=this.blending),0!==this.side&&(c.side=this.side),!0===this.vertexColors&&(c.vertexColors=!0),this.opacity<1&&(c.opacity=this.opacity),!0===this.transparent&&(c.transparent=!0),204!==this.blendSrc&&(c.blendSrc=this.blendSrc),205!==this.blendDst&&(c.blendDst=this.blendDst),100!==this.blendEquation&&(c.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(c.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(c.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(c.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(c.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(c.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(c.depthFunc=this.depthFunc),!1===this.depthTest&&(c.depthTest=this.depthTest),!1===this.depthWrite&&(c.depthWrite=this.depthWrite),!1===this.colorWrite&&(c.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(c.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(c.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(c.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(c.stencilFuncMask=this.stencilFuncMask),7680!==this.stencilFail&&(c.stencilFail=this.stencilFail),7680!==this.stencilZFail&&(c.stencilZFail=this.stencilZFail),7680!==this.stencilZPass&&(c.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(c.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(c.rotation=this.rotation),!0===this.polygonOffset&&(c.polygonOffset=!0),0!==this.polygonOffsetFactor&&(c.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(c.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(c.linewidth=this.linewidth),void 0!==this.dashSize&&(c.dashSize=this.dashSize),void 0!==this.gapSize&&(c.gapSize=this.gapSize),void 0!==this.scale&&(c.scale=this.scale),!0===this.dithering&&(c.dithering=!0),this.alphaTest>0&&(c.alphaTest=this.alphaTest),!0===this.alphaHash&&(c.alphaHash=!0),!0===this.alphaToCoverage&&(c.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(c.premultipliedAlpha=!0),!0===this.forceSinglePass&&(c.forceSinglePass=!0),!0===this.wireframe&&(c.wireframe=!0),this.wireframeLinewidth>1&&(c.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(c.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(c.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(c.flatShading=!0),!1===this.visible&&(c.visible=!1),!1===this.toneMapped&&(c.toneMapped=!1),!1===this.fog&&(c.fog=!1),Object.keys(this.userData).length>0&&(c.userData=this.userData),b){let b=d(a.textures),e=d(a.images);b.length>0&&(c.textures=b),e.length>0&&(c.images=e)}return c}clone(){return new this.constructor().copy(this)}copy(a){this.name=a.name,this.blending=a.blending,this.side=a.side,this.vertexColors=a.vertexColors,this.opacity=a.opacity,this.transparent=a.transparent,this.blendSrc=a.blendSrc,this.blendDst=a.blendDst,this.blendEquation=a.blendEquation,this.blendSrcAlpha=a.blendSrcAlpha,this.blendDstAlpha=a.blendDstAlpha,this.blendEquationAlpha=a.blendEquationAlpha,this.blendColor.copy(a.blendColor),this.blendAlpha=a.blendAlpha,this.depthFunc=a.depthFunc,this.depthTest=a.depthTest,this.depthWrite=a.depthWrite,this.stencilWriteMask=a.stencilWriteMask,this.stencilFunc=a.stencilFunc,this.stencilRef=a.stencilRef,this.stencilFuncMask=a.stencilFuncMask,this.stencilFail=a.stencilFail,this.stencilZFail=a.stencilZFail,this.stencilZPass=a.stencilZPass,this.stencilWrite=a.stencilWrite;let b=a.clippingPlanes,c=null;if(null!==b){let a=b.length;c=Array(a);for(let d=0;d!==a;++d)c[d]=b[d].clone()}return this.clippingPlanes=c,this.clipIntersection=a.clipIntersection,this.clipShadows=a.clipShadows,this.shadowSide=a.shadowSide,this.colorWrite=a.colorWrite,this.precision=a.precision,this.polygonOffset=a.polygonOffset,this.polygonOffsetFactor=a.polygonOffsetFactor,this.polygonOffsetUnits=a.polygonOffsetUnits,this.dithering=a.dithering,this.alphaTest=a.alphaTest,this.alphaHash=a.alphaHash,this.alphaToCoverage=a.alphaToCoverage,this.premultipliedAlpha=a.premultipliedAlpha,this.forceSinglePass=a.forceSinglePass,this.visible=a.visible,this.toneMapped=a.toneMapped,this.userData=JSON.parse(JSON.stringify(a.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(a){!0===a&&this.version++}}class bG extends bF{constructor(a){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new bC(0xffffff),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new a5,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.envMapRotation.copy(a.envMapRotation),this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.fog=a.fog,this}}let bH=new at,bI=new _;class bJ{constructor(a,b,c=!1){if(Array.isArray(a))throw TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=a,this.itemSize=b,this.count=void 0!==a?a.length/b:0,this.normalized=c,this.usage=35044,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=1015,this.version=0}onUploadCallback(){}set needsUpdate(a){!0===a&&this.version++}get updateRange(){var a;return(a="THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead.")in ad||(ad[a]=!0,console.warn(a)),this._updateRange}setUsage(a){return this.usage=a,this}addUpdateRange(a,b){this.updateRanges.push({start:a,count:b})}clearUpdateRanges(){this.updateRanges.length=0}copy(a){return this.name=a.name,this.array=new a.array.constructor(a.array),this.itemSize=a.itemSize,this.count=a.count,this.normalized=a.normalized,this.usage=a.usage,this.gpuType=a.gpuType,this}copyAt(a,b,c){a*=this.itemSize,c*=b.itemSize;for(let d=0,e=this.itemSize;d<e;d++)this.array[a+d]=b.array[c+d];return this}copyArray(a){return this.array.set(a),this}applyMatrix3(a){if(2===this.itemSize)for(let b=0,c=this.count;b<c;b++)bI.fromBufferAttribute(this,b),bI.applyMatrix3(a),this.setXY(b,bI.x,bI.y);else if(3===this.itemSize)for(let b=0,c=this.count;b<c;b++)bH.fromBufferAttribute(this,b),bH.applyMatrix3(a),this.setXYZ(b,bH.x,bH.y,bH.z);return this}applyMatrix4(a){for(let b=0,c=this.count;b<c;b++)bH.fromBufferAttribute(this,b),bH.applyMatrix4(a),this.setXYZ(b,bH.x,bH.y,bH.z);return this}applyNormalMatrix(a){for(let b=0,c=this.count;b<c;b++)bH.fromBufferAttribute(this,b),bH.applyNormalMatrix(a),this.setXYZ(b,bH.x,bH.y,bH.z);return this}transformDirection(a){for(let b=0,c=this.count;b<c;b++)bH.fromBufferAttribute(this,b),bH.transformDirection(a),this.setXYZ(b,bH.x,bH.y,bH.z);return this}set(a,b=0){return this.array.set(a,b),this}getComponent(a,b){let c=this.array[a*this.itemSize+b];return this.normalized&&(c=Y(c,this.array)),c}setComponent(a,b,c){return this.normalized&&(c=Z(c,this.array)),this.array[a*this.itemSize+b]=c,this}getX(a){let b=this.array[a*this.itemSize];return this.normalized&&(b=Y(b,this.array)),b}setX(a,b){return this.normalized&&(b=Z(b,this.array)),this.array[a*this.itemSize]=b,this}getY(a){let b=this.array[a*this.itemSize+1];return this.normalized&&(b=Y(b,this.array)),b}setY(a,b){return this.normalized&&(b=Z(b,this.array)),this.array[a*this.itemSize+1]=b,this}getZ(a){let b=this.array[a*this.itemSize+2];return this.normalized&&(b=Y(b,this.array)),b}setZ(a,b){return this.normalized&&(b=Z(b,this.array)),this.array[a*this.itemSize+2]=b,this}getW(a){let b=this.array[a*this.itemSize+3];return this.normalized&&(b=Y(b,this.array)),b}setW(a,b){return this.normalized&&(b=Z(b,this.array)),this.array[a*this.itemSize+3]=b,this}setXY(a,b,c){return a*=this.itemSize,this.normalized&&(b=Z(b,this.array),c=Z(c,this.array)),this.array[a+0]=b,this.array[a+1]=c,this}setXYZ(a,b,c,d){return a*=this.itemSize,this.normalized&&(b=Z(b,this.array),c=Z(c,this.array),d=Z(d,this.array)),this.array[a+0]=b,this.array[a+1]=c,this.array[a+2]=d,this}setXYZW(a,b,c,d,e){return a*=this.itemSize,this.normalized&&(b=Z(b,this.array),c=Z(c,this.array),d=Z(d,this.array),e=Z(e,this.array)),this.array[a+0]=b,this.array[a+1]=c,this.array[a+2]=d,this.array[a+3]=e,this}onUpload(a){return this.onUploadCallback=a,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let a={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(a.name=this.name),35044!==this.usage&&(a.usage=this.usage),a}}class bK extends bJ{constructor(a,b,c){super(new Uint16Array(a),b,c)}}class bL extends bJ{constructor(a,b,c){super(new Uint32Array(a),b,c)}}class bM extends bJ{constructor(a,b,c){super(new Float32Array(a),b,c)}}let bN=0,bO=new aX,bP=new bm,bQ=new at,bR=new aw,bS=new aw,bT=new at;class bU extends S{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:bN++}),this.uuid=W(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(a){return Array.isArray(a)?this.index=new(!function(a){for(let b=a.length-1;b>=0;--b)if(a[b]>=65535)return!0;return!1}(a)?bK:bL)(a,1):this.index=a,this}getAttribute(a){return this.attributes[a]}setAttribute(a,b){return this.attributes[a]=b,this}deleteAttribute(a){return delete this.attributes[a],this}hasAttribute(a){return void 0!==this.attributes[a]}addGroup(a,b,c=0){this.groups.push({start:a,count:b,materialIndex:c})}clearGroups(){this.groups=[]}setDrawRange(a,b){this.drawRange.start=a,this.drawRange.count=b}applyMatrix4(a){let b=this.attributes.position;void 0!==b&&(b.applyMatrix4(a),b.needsUpdate=!0);let c=this.attributes.normal;if(void 0!==c){let b=new aa().getNormalMatrix(a);c.applyNormalMatrix(b),c.needsUpdate=!0}let d=this.attributes.tangent;return void 0!==d&&(d.transformDirection(a),d.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(a){return bO.makeRotationFromQuaternion(a),this.applyMatrix4(bO),this}rotateX(a){return bO.makeRotationX(a),this.applyMatrix4(bO),this}rotateY(a){return bO.makeRotationY(a),this.applyMatrix4(bO),this}rotateZ(a){return bO.makeRotationZ(a),this.applyMatrix4(bO),this}translate(a,b,c){return bO.makeTranslation(a,b,c),this.applyMatrix4(bO),this}scale(a,b,c){return bO.makeScale(a,b,c),this.applyMatrix4(bO),this}lookAt(a){return bP.lookAt(a),bP.updateMatrix(),this.applyMatrix4(bP.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(bQ).negate(),this.translate(bQ.x,bQ.y,bQ.z),this}setFromPoints(a){let b=[];for(let c=0,d=a.length;c<d;c++){let d=a[c];b.push(d.x,d.y,d.z||0)}return this.setAttribute("position",new bM(b,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new aw);let a=this.attributes.position,b=this.morphAttributes.position;if(a&&a.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new at(-1/0,-1/0,-1/0),new at(Infinity,Infinity,Infinity));return}if(void 0!==a){if(this.boundingBox.setFromBufferAttribute(a),b)for(let a=0,c=b.length;a<c;a++){let c=b[a];bR.setFromBufferAttribute(c),this.morphTargetsRelative?(bT.addVectors(this.boundingBox.min,bR.min),this.boundingBox.expandByPoint(bT),bT.addVectors(this.boundingBox.max,bR.max),this.boundingBox.expandByPoint(bT)):(this.boundingBox.expandByPoint(bR.min),this.boundingBox.expandByPoint(bR.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new aO);let a=this.attributes.position,b=this.morphAttributes.position;if(a&&a.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new at,1/0);return}if(a){let c=this.boundingSphere.center;if(bR.setFromBufferAttribute(a),b)for(let a=0,c=b.length;a<c;a++){let c=b[a];bS.setFromBufferAttribute(c),this.morphTargetsRelative?(bT.addVectors(bR.min,bS.min),bR.expandByPoint(bT),bT.addVectors(bR.max,bS.max),bR.expandByPoint(bT)):(bR.expandByPoint(bS.min),bR.expandByPoint(bS.max))}bR.getCenter(c);let d=0;for(let b=0,e=a.count;b<e;b++)bT.fromBufferAttribute(a,b),d=Math.max(d,c.distanceToSquared(bT));if(b)for(let e=0,f=b.length;e<f;e++){let f=b[e],g=this.morphTargetsRelative;for(let b=0,e=f.count;b<e;b++)bT.fromBufferAttribute(f,b),g&&(bQ.fromBufferAttribute(a,b),bT.add(bQ)),d=Math.max(d,c.distanceToSquared(bT))}this.boundingSphere.radius=Math.sqrt(d),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let a=this.index,b=this.attributes;if(null===a||void 0===b.position||void 0===b.normal||void 0===b.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");let c=b.position,d=b.normal,e=b.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new bJ(new Float32Array(4*c.count),4));let f=this.getAttribute("tangent"),g=[],h=[];for(let a=0;a<c.count;a++)g[a]=new at,h[a]=new at;let i=new at,j=new at,k=new at,l=new _,m=new _,n=new _,o=new at,p=new at,q=this.groups;0===q.length&&(q=[{start:0,count:a.count}]);for(let b=0,d=q.length;b<d;++b){let d=q[b],f=d.start,r=d.count;for(let b=f,d=f+r;b<d;b+=3)!function(a,b,d){i.fromBufferAttribute(c,a),j.fromBufferAttribute(c,b),k.fromBufferAttribute(c,d),l.fromBufferAttribute(e,a),m.fromBufferAttribute(e,b),n.fromBufferAttribute(e,d),j.sub(i),k.sub(i),m.sub(l),n.sub(l);let f=1/(m.x*n.y-n.x*m.y);isFinite(f)&&(o.copy(j).multiplyScalar(n.y).addScaledVector(k,-m.y).multiplyScalar(f),p.copy(k).multiplyScalar(m.x).addScaledVector(j,-n.x).multiplyScalar(f),g[a].add(o),g[b].add(o),g[d].add(o),h[a].add(p),h[b].add(p),h[d].add(p))}(a.getX(b+0),a.getX(b+1),a.getX(b+2))}let r=new at,s=new at,t=new at,u=new at;function v(a){t.fromBufferAttribute(d,a),u.copy(t);let b=g[a];r.copy(b),r.sub(t.multiplyScalar(t.dot(b))).normalize(),s.crossVectors(u,b);let c=s.dot(h[a]);f.setXYZW(a,r.x,r.y,r.z,c<0?-1:1)}for(let b=0,c=q.length;b<c;++b){let c=q[b],d=c.start,e=c.count;for(let b=d,c=d+e;b<c;b+=3)v(a.getX(b+0)),v(a.getX(b+1)),v(a.getX(b+2))}}computeVertexNormals(){let a=this.index,b=this.getAttribute("position");if(void 0!==b){let c=this.getAttribute("normal");if(void 0===c)c=new bJ(new Float32Array(3*b.count),3),this.setAttribute("normal",c);else for(let a=0,b=c.count;a<b;a++)c.setXYZ(a,0,0,0);let d=new at,e=new at,f=new at,g=new at,h=new at,i=new at,j=new at,k=new at;if(a)for(let l=0,m=a.count;l<m;l+=3){let m=a.getX(l+0),n=a.getX(l+1),o=a.getX(l+2);d.fromBufferAttribute(b,m),e.fromBufferAttribute(b,n),f.fromBufferAttribute(b,o),j.subVectors(f,e),k.subVectors(d,e),j.cross(k),g.fromBufferAttribute(c,m),h.fromBufferAttribute(c,n),i.fromBufferAttribute(c,o),g.add(j),h.add(j),i.add(j),c.setXYZ(m,g.x,g.y,g.z),c.setXYZ(n,h.x,h.y,h.z),c.setXYZ(o,i.x,i.y,i.z)}else for(let a=0,g=b.count;a<g;a+=3)d.fromBufferAttribute(b,a+0),e.fromBufferAttribute(b,a+1),f.fromBufferAttribute(b,a+2),j.subVectors(f,e),k.subVectors(d,e),j.cross(k),c.setXYZ(a+0,j.x,j.y,j.z),c.setXYZ(a+1,j.x,j.y,j.z),c.setXYZ(a+2,j.x,j.y,j.z);this.normalizeNormals(),c.needsUpdate=!0}}normalizeNormals(){let a=this.attributes.normal;for(let b=0,c=a.count;b<c;b++)bT.fromBufferAttribute(a,b),bT.normalize(),a.setXYZ(b,bT.x,bT.y,bT.z)}toNonIndexed(){function a(a,b){let c=a.array,d=a.itemSize,e=a.normalized,f=new c.constructor(b.length*d),g=0,h=0;for(let e=0,i=b.length;e<i;e++){g=a.isInterleavedBufferAttribute?b[e]*a.data.stride+a.offset:b[e]*d;for(let a=0;a<d;a++)f[h++]=c[g++]}return new bJ(f,d,e)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let b=new bU,c=this.index.array,d=this.attributes;for(let e in d){let f=a(d[e],c);b.setAttribute(e,f)}let e=this.morphAttributes;for(let d in e){let f=[],g=e[d];for(let b=0,d=g.length;b<d;b++){let d=a(g[b],c);f.push(d)}b.morphAttributes[d]=f}b.morphTargetsRelative=this.morphTargetsRelative;let f=this.groups;for(let a=0,c=f.length;a<c;a++){let c=f[a];b.addGroup(c.start,c.count,c.materialIndex)}return b}toJSON(){let a={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(a.uuid=this.uuid,a.type=this.type,""!==this.name&&(a.name=this.name),Object.keys(this.userData).length>0&&(a.userData=this.userData),void 0!==this.parameters){let b=this.parameters;for(let c in b)void 0!==b[c]&&(a[c]=b[c]);return a}a.data={attributes:{}};let b=this.index;null!==b&&(a.data.index={type:b.array.constructor.name,array:Array.prototype.slice.call(b.array)});let c=this.attributes;for(let b in c){let d=c[b];a.data.attributes[b]=d.toJSON(a.data)}let d={},e=!1;for(let b in this.morphAttributes){let c=this.morphAttributes[b],f=[];for(let b=0,d=c.length;b<d;b++){let d=c[b];f.push(d.toJSON(a.data))}f.length>0&&(d[b]=f,e=!0)}e&&(a.data.morphAttributes=d,a.data.morphTargetsRelative=this.morphTargetsRelative);let f=this.groups;f.length>0&&(a.data.groups=JSON.parse(JSON.stringify(f)));let g=this.boundingSphere;return null!==g&&(a.data.boundingSphere={center:g.center.toArray(),radius:g.radius}),a}clone(){return new this.constructor().copy(this)}copy(a){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let b={};this.name=a.name;let c=a.index;null!==c&&this.setIndex(c.clone(b));let d=a.attributes;for(let a in d){let c=d[a];this.setAttribute(a,c.clone(b))}let e=a.morphAttributes;for(let a in e){let c=[],d=e[a];for(let a=0,e=d.length;a<e;a++)c.push(d[a].clone(b));this.morphAttributes[a]=c}this.morphTargetsRelative=a.morphTargetsRelative;let f=a.groups;for(let a=0,b=f.length;a<b;a++){let b=f[a];this.addGroup(b.start,b.count,b.materialIndex)}let g=a.boundingBox;null!==g&&(this.boundingBox=g.clone());let h=a.boundingSphere;return null!==h&&(this.boundingSphere=h.clone()),this.drawRange.start=a.drawRange.start,this.drawRange.count=a.drawRange.count,this.userData=a.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}let bV=new aX,bW=new aW,bX=new aO,bY=new at,bZ=new at,b$=new at,b_=new at,b0=new at,b1=new at,b2=new _,b3=new _,b4=new _,b5=new at,b6=new at,b7=new at,b8=new at,b9=new at;class ca extends bm{constructor(a=new bU,b=new bG){super(),this.isMesh=!0,this.type="Mesh",this.geometry=a,this.material=b,this.updateMorphTargets()}copy(a,b){return super.copy(a,b),void 0!==a.morphTargetInfluences&&(this.morphTargetInfluences=a.morphTargetInfluences.slice()),void 0!==a.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},a.morphTargetDictionary)),this.material=Array.isArray(a.material)?a.material.slice():a.material,this.geometry=a.geometry,this}updateMorphTargets(){let a=this.geometry.morphAttributes,b=Object.keys(a);if(b.length>0){let c=a[b[0]];if(void 0!==c){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,b=c.length;a<b;a++){let b=c[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[b]=a}}}}getVertexPosition(a,b){let c=this.geometry,d=c.attributes.position,e=c.morphAttributes.position,f=c.morphTargetsRelative;b.fromBufferAttribute(d,a);let g=this.morphTargetInfluences;if(e&&g){b1.set(0,0,0);for(let c=0,d=e.length;c<d;c++){let d=g[c],h=e[c];0!==d&&(b0.fromBufferAttribute(h,a),f?b1.addScaledVector(b0,d):b1.addScaledVector(b0.sub(b),d))}b.add(b1)}return b}raycast(a,b){let c=this.geometry,d=this.material,e=this.matrixWorld;if(void 0!==d)null===c.boundingSphere&&c.computeBoundingSphere(),bX.copy(c.boundingSphere),bX.applyMatrix4(e),bW.copy(a.ray).recast(a.near),!1===bX.containsPoint(bW.origin)&&(null===bW.intersectSphere(bX,bY)||bW.origin.distanceToSquared(bY)>(a.far-a.near)**2)||(bV.copy(e).invert(),bW.copy(a.ray).applyMatrix4(bV),(null===c.boundingBox||!1!==bW.intersectsBox(c.boundingBox))&&this._computeIntersections(a,b,bW))}_computeIntersections(a,b,c){let d,e=this.geometry,f=this.material,g=e.index,h=e.attributes.position,i=e.attributes.uv,j=e.attributes.uv1,k=e.attributes.normal,l=e.groups,m=e.drawRange;if(null!==g)if(Array.isArray(f))for(let e=0,h=l.length;e<h;e++){let h=l[e],n=f[h.materialIndex],o=Math.max(h.start,m.start),p=Math.min(g.count,Math.min(h.start+h.count,m.start+m.count));for(let e=o;e<p;e+=3){let f=g.getX(e);(d=cb(this,n,a,c,i,j,k,f,g.getX(e+1),g.getX(e+2)))&&(d.faceIndex=Math.floor(e/3),d.face.materialIndex=h.materialIndex,b.push(d))}}else{let e=Math.max(0,m.start),h=Math.min(g.count,m.start+m.count);for(let l=e;l<h;l+=3){let e=g.getX(l);(d=cb(this,f,a,c,i,j,k,e,g.getX(l+1),g.getX(l+2)))&&(d.faceIndex=Math.floor(l/3),b.push(d))}}else if(void 0!==h)if(Array.isArray(f))for(let e=0,g=l.length;e<g;e++){let g=l[e],n=f[g.materialIndex],o=Math.max(g.start,m.start),p=Math.min(h.count,Math.min(g.start+g.count,m.start+m.count));for(let e=o;e<p;e+=3)(d=cb(this,n,a,c,i,j,k,e,e+1,e+2))&&(d.faceIndex=Math.floor(e/3),d.face.materialIndex=g.materialIndex,b.push(d))}else{let e=Math.max(0,m.start),g=Math.min(h.count,m.start+m.count);for(let h=e;h<g;h+=3)(d=cb(this,f,a,c,i,j,k,h,h+1,h+2))&&(d.faceIndex=Math.floor(h/3),b.push(d))}}}function cb(a,b,c,d,e,f,g,h,i,j){a.getVertexPosition(h,bZ),a.getVertexPosition(i,b$),a.getVertexPosition(j,b_);let k=function(a,b,c,d,e,f,g,h){if(null===(1===b.side?d.intersectTriangle(g,f,e,!0,h):d.intersectTriangle(e,f,g,0===b.side,h)))return null;b9.copy(h),b9.applyMatrix4(a.matrixWorld);let i=c.ray.origin.distanceTo(b9);return i<c.near||i>c.far?null:{distance:i,point:b9.clone(),object:a}}(a,b,c,d,bZ,b$,b_,b8);if(k){e&&(b2.fromBufferAttribute(e,h),b3.fromBufferAttribute(e,i),b4.fromBufferAttribute(e,j),k.uv=bx.getInterpolation(b8,bZ,b$,b_,b2,b3,b4,new _)),f&&(b2.fromBufferAttribute(f,h),b3.fromBufferAttribute(f,i),b4.fromBufferAttribute(f,j),k.uv1=bx.getInterpolation(b8,bZ,b$,b_,b2,b3,b4,new _)),g&&(b5.fromBufferAttribute(g,h),b6.fromBufferAttribute(g,i),b7.fromBufferAttribute(g,j),k.normal=bx.getInterpolation(b8,bZ,b$,b_,b5,b6,b7,new at),k.normal.dot(d.direction)>0&&k.normal.multiplyScalar(-1));let a={a:h,b:i,c:j,normal:new at,materialIndex:0};bx.getNormal(bZ,b$,b_,a.normal),k.face=a}return k}function cc(a){let b={};for(let c in a)for(let d in b[c]={},a[c]){let e=a[c][d];e&&(e.isColor||e.isMatrix3||e.isMatrix4||e.isVector2||e.isVector3||e.isVector4||e.isTexture||e.isQuaternion)?e.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),b[c][d]=null):b[c][d]=e.clone():Array.isArray(e)?b[c][d]=e.slice():b[c][d]=e}return b}function cd(a){let b={};for(let c=0;c<a.length;c++){let d=cc(a[c]);for(let a in d)b[a]=d[a]}return b}class ce extends bm{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new aX,this.projectionMatrix=new aX,this.projectionMatrixInverse=new aX,this.coordinateSystem=2e3}copy(a,b){return super.copy(a,b),this.matrixWorldInverse.copy(a.matrixWorldInverse),this.projectionMatrix.copy(a.projectionMatrix),this.projectionMatrixInverse.copy(a.projectionMatrixInverse),this.coordinateSystem=a.coordinateSystem,this}getWorldDirection(a){return super.getWorldDirection(a).negate()}updateMatrixWorld(a){super.updateMatrixWorld(a),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(a,b){super.updateWorldMatrix(a,b),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}let cf=new at,cg=new _,ch=new _;class ci extends ce{constructor(a=50,b=1,c=.1,d=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=a,this.zoom=1,this.near=c,this.far=d,this.focus=10,this.aspect=b,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(a,b){return super.copy(a,b),this.fov=a.fov,this.zoom=a.zoom,this.near=a.near,this.far=a.far,this.focus=a.focus,this.aspect=a.aspect,this.view=null===a.view?null:Object.assign({},a.view),this.filmGauge=a.filmGauge,this.filmOffset=a.filmOffset,this}setFocalLength(a){let b=.5*this.getFilmHeight()/a;this.fov=2*V*Math.atan(b),this.updateProjectionMatrix()}getFocalLength(){let a=Math.tan(.5*U*this.fov);return .5*this.getFilmHeight()/a}getEffectiveFOV(){return 2*V*Math.atan(Math.tan(.5*U*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(a,b,c){cf.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),b.set(cf.x,cf.y).multiplyScalar(-a/cf.z),cf.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),c.set(cf.x,cf.y).multiplyScalar(-a/cf.z)}getViewSize(a,b){return this.getViewBounds(a,cg,ch),b.subVectors(ch,cg)}setViewOffset(a,b,c,d,e,f){this.aspect=a/b,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=a,this.view.fullHeight=b,this.view.offsetX=c,this.view.offsetY=d,this.view.width=e,this.view.height=f,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let a=this.near,b=a*Math.tan(.5*U*this.fov)/this.zoom,c=2*b,d=this.aspect*c,e=-.5*d,f=this.view;if(null!==this.view&&this.view.enabled){let a=f.fullWidth,g=f.fullHeight;e+=f.offsetX*d/a,b-=f.offsetY*c/g,d*=f.width/a,c*=f.height/g}let g=this.filmOffset;0!==g&&(e+=a*g/this.getFilmWidth()),this.projectionMatrix.makePerspective(e,e+d,b,b-c,a,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(a){let b=super.toJSON(a);return b.object.fov=this.fov,b.object.zoom=this.zoom,b.object.near=this.near,b.object.far=this.far,b.object.focus=this.focus,b.object.aspect=this.aspect,null!==this.view&&(b.object.view=Object.assign({},this.view)),b.object.filmGauge=this.filmGauge,b.object.filmOffset=this.filmOffset,b}}let cj=new at,ck=new at,cl=new aa;class cm{constructor(a=new at(1,0,0),b=0){this.isPlane=!0,this.normal=a,this.constant=b}set(a,b){return this.normal.copy(a),this.constant=b,this}setComponents(a,b,c,d){return this.normal.set(a,b,c),this.constant=d,this}setFromNormalAndCoplanarPoint(a,b){return this.normal.copy(a),this.constant=-b.dot(this.normal),this}setFromCoplanarPoints(a,b,c){let d=cj.subVectors(c,b).cross(ck.subVectors(a,b)).normalize();return this.setFromNormalAndCoplanarPoint(d,a),this}copy(a){return this.normal.copy(a.normal),this.constant=a.constant,this}normalize(){let a=1/this.normal.length();return this.normal.multiplyScalar(a),this.constant*=a,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(a){return this.normal.dot(a)+this.constant}distanceToSphere(a){return this.distanceToPoint(a.center)-a.radius}projectPoint(a,b){return b.copy(a).addScaledVector(this.normal,-this.distanceToPoint(a))}intersectLine(a,b){let c=a.delta(cj),d=this.normal.dot(c);if(0===d)return 0===this.distanceToPoint(a.start)?b.copy(a.start):null;let e=-(a.start.dot(this.normal)+this.constant)/d;return e<0||e>1?null:b.copy(a.start).addScaledVector(c,e)}intersectsLine(a){let b=this.distanceToPoint(a.start),c=this.distanceToPoint(a.end);return b<0&&c>0||c<0&&b>0}intersectsBox(a){return a.intersectsPlane(this)}intersectsSphere(a){return a.intersectsPlane(this)}coplanarPoint(a){return a.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(a,b){let c=b||cl.getNormalMatrix(a),d=this.coplanarPoint(cj).applyMatrix4(a),e=this.normal.applyMatrix3(c).normalize();return this.constant=-d.dot(e),this}translate(a){return this.constant-=a.dot(this.normal),this}equals(a){return a.normal.equals(this.normal)&&a.constant===this.constant}clone(){return new this.constructor().copy(this)}}let cn=new aO,co=new at;class cp{constructor(a=new cm,b=new cm,c=new cm,d=new cm,e=new cm,f=new cm){this.planes=[a,b,c,d,e,f]}set(a,b,c,d,e,f){let g=this.planes;return g[0].copy(a),g[1].copy(b),g[2].copy(c),g[3].copy(d),g[4].copy(e),g[5].copy(f),this}copy(a){let b=this.planes;for(let c=0;c<6;c++)b[c].copy(a.planes[c]);return this}setFromProjectionMatrix(a,b=2e3){let c=this.planes,d=a.elements,e=d[0],f=d[1],g=d[2],h=d[3],i=d[4],j=d[5],k=d[6],l=d[7],m=d[8],n=d[9],o=d[10],p=d[11],q=d[12],r=d[13],s=d[14],t=d[15];if(c[0].setComponents(h-e,l-i,p-m,t-q).normalize(),c[1].setComponents(h+e,l+i,p+m,t+q).normalize(),c[2].setComponents(h+f,l+j,p+n,t+r).normalize(),c[3].setComponents(h-f,l-j,p-n,t-r).normalize(),c[4].setComponents(h-g,l-k,p-o,t-s).normalize(),2e3===b)c[5].setComponents(h+g,l+k,p+o,t+s).normalize();else if(2001===b)c[5].setComponents(g,k,o,s).normalize();else throw Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+b);return this}intersectsObject(a){if(void 0!==a.boundingSphere)null===a.boundingSphere&&a.computeBoundingSphere(),cn.copy(a.boundingSphere).applyMatrix4(a.matrixWorld);else{let b=a.geometry;null===b.boundingSphere&&b.computeBoundingSphere(),cn.copy(b.boundingSphere).applyMatrix4(a.matrixWorld)}return this.intersectsSphere(cn)}intersectsSprite(a){return cn.center.set(0,0,0),cn.radius=.7071067811865476,cn.applyMatrix4(a.matrixWorld),this.intersectsSphere(cn)}intersectsSphere(a){let b=this.planes,c=a.center,d=-a.radius;for(let a=0;a<6;a++)if(b[a].distanceToPoint(c)<d)return!1;return!0}intersectsBox(a){let b=this.planes;for(let c=0;c<6;c++){let d=b[c];if(co.x=d.normal.x>0?a.max.x:a.min.x,co.y=d.normal.y>0?a.max.y:a.min.y,co.z=d.normal.z>0?a.max.z:a.min.z,0>d.distanceToPoint(co))return!1}return!0}containsPoint(a){let b=this.planes;for(let c=0;c<6;c++)if(0>b[c].distanceToPoint(a))return!1;return!0}clone(){return new this.constructor().copy(this)}}let cq={background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n	gl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n	vec4 texColor = texture2D( t2D, vUv );\n	#ifdef DECODE_VIDEO_TEXTURE\n		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n	#endif\n	texColor.rgb *= backgroundIntensity;\n	gl_FragColor = texColor;\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n	gl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n	uniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n	uniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n	#ifdef ENVMAP_TYPE_CUBE\n		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n	#elif defined( ENVMAP_TYPE_CUBE_UV )\n		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n	#else\n		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n	#endif\n	texColor.rgb *= backgroundIntensity;\n	gl_FragColor = texColor;\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n	gl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n	gl_FragColor = texColor;\n	gl_FragColor.a *= opacity;\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n	#include <uv_vertex>\n	#include <batching_vertex>\n	#include <skinbase_vertex>\n	#include <morphinstance_vertex>\n	#ifdef USE_DISPLACEMENTMAP\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n	uniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n	vec4 diffuseColor = vec4( 1.0 );\n	#include <clipping_planes_fragment>\n	#if DEPTH_PACKING == 3200\n		diffuseColor.a = opacity;\n	#endif\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <logdepthbuf_fragment>\n	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n	#if DEPTH_PACKING == 3200\n		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n	#elif DEPTH_PACKING == 3201\n		gl_FragColor = packDepthToRGBA( fragCoordZ );\n	#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <batching_vertex>\n	#include <skinbase_vertex>\n	#include <morphinstance_vertex>\n	#ifdef USE_DISPLACEMENTMAP\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <worldpos_vertex>\n	#include <clipping_planes_vertex>\n	vWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n	vec4 diffuseColor = vec4( 1.0 );\n	#include <clipping_planes_fragment>\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	float dist = length( vWorldPosition - referencePosition );\n	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n	dist = saturate( dist );\n	gl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vWorldDirection = transformDirection( position, modelMatrix );\n	#include <begin_vertex>\n	#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n	vec3 direction = normalize( vWorldDirection );\n	vec2 sampleUV = equirectUv( direction );\n	gl_FragColor = texture2D( tEquirect, sampleUV );\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	vLineDistance = scale * lineDistance;\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	if ( mod( vLineDistance, totalSize ) > dashSize ) {\n		discard;\n	}\n	vec3 outgoingLight = vec3( 0.0 );\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n		#include <beginnormal_vertex>\n		#include <morphnormal_vertex>\n		#include <skinbase_vertex>\n		#include <skinnormal_vertex>\n		#include <defaultnormal_vertex>\n	#endif\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n	varying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <specularmap_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	#ifdef USE_LIGHTMAP\n		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n	#else\n		reflectedLight.indirectDiffuse += vec3( 1.0 );\n	#endif\n	#include <aomap_fragment>\n	reflectedLight.indirectDiffuse *= diffuseColor.rgb;\n	vec3 outgoingLight = reflectedLight.indirectDiffuse;\n	#include <envmap_fragment>\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <specularmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_lambert_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n	#include <envmap_fragment>\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n	vViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	vec3 viewDir = normalize( vViewPosition );\n	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n	vec3 y = cross( viewDir, x );\n	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n	#ifdef USE_MATCAP\n		vec4 matcapColor = texture2D( matcap, uv );\n	#else\n		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n	#endif\n	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n	varying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphinstance_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n	vViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n	varying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n	#include <clipping_planes_fragment>\n	#include <logdepthbuf_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n	#ifdef OPAQUE\n		gl_FragColor.a = 1.0;\n	#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphinstance_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <envmap_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <specularmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_phong_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n	#include <envmap_fragment>\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n	varying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n	vWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n	#define IOR\n	#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n	uniform float ior;\n#endif\n#ifdef USE_SPECULAR\n	uniform float specularIntensity;\n	uniform vec3 specularColor;\n	#ifdef USE_SPECULAR_COLORMAP\n		uniform sampler2D specularColorMap;\n	#endif\n	#ifdef USE_SPECULAR_INTENSITYMAP\n		uniform sampler2D specularIntensityMap;\n	#endif\n#endif\n#ifdef USE_CLEARCOAT\n	uniform float clearcoat;\n	uniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n	uniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n	uniform float iridescence;\n	uniform float iridescenceIOR;\n	uniform float iridescenceThicknessMinimum;\n	uniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n	uniform vec3 sheenColor;\n	uniform float sheenRoughness;\n	#ifdef USE_SHEEN_COLORMAP\n		uniform sampler2D sheenColorMap;\n	#endif\n	#ifdef USE_SHEEN_ROUGHNESSMAP\n		uniform sampler2D sheenRoughnessMap;\n	#endif\n#endif\n#ifdef USE_ANISOTROPY\n	uniform vec2 anisotropyVector;\n	#ifdef USE_ANISOTROPYMAP\n		uniform sampler2D anisotropyMap;\n	#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <roughnessmap_fragment>\n	#include <metalnessmap_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <clearcoat_normal_fragment_begin>\n	#include <clearcoat_normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_physical_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n	#include <transmission_fragment>\n	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n	#ifdef USE_SHEEN\n		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n	#endif\n	#ifdef USE_CLEARCOAT\n		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n	#endif\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <normal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <displacementmap_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	vViewPosition = - mvPosition.xyz;\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n	vec3 totalEmissiveRadiance = emissive;\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <color_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	#include <normal_fragment_begin>\n	#include <normal_fragment_maps>\n	#include <emissivemap_fragment>\n	#include <lights_toon_fragment>\n	#include <lights_fragment_begin>\n	#include <lights_fragment_maps>\n	#include <lights_fragment_end>\n	#include <aomap_fragment>\n	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n	#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n	varying vec2 vUv;\n	uniform mat3 uvTransform;\n#endif\nvoid main() {\n	#ifdef USE_POINTS_UV\n		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n	#endif\n	#include <color_vertex>\n	#include <morphinstance_vertex>\n	#include <morphcolor_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <project_vertex>\n	gl_PointSize = size;\n	#ifdef USE_SIZEATTENUATION\n		bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n	#endif\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <worldpos_vertex>\n	#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	vec3 outgoingLight = vec3( 0.0 );\n	#include <logdepthbuf_fragment>\n	#include <map_particle_fragment>\n	#include <color_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n	#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n	#include <batching_vertex>\n	#include <beginnormal_vertex>\n	#include <morphinstance_vertex>\n	#include <morphnormal_vertex>\n	#include <skinbase_vertex>\n	#include <skinnormal_vertex>\n	#include <defaultnormal_vertex>\n	#include <begin_vertex>\n	#include <morphtarget_vertex>\n	#include <skinning_vertex>\n	#include <project_vertex>\n	#include <logdepthbuf_vertex>\n	#include <worldpos_vertex>\n	#include <shadowmap_vertex>\n	#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n	#include <logdepthbuf_fragment>\n	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n	#include <uv_vertex>\n	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n	vec2 scale;\n	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n	#ifndef USE_SIZEATTENUATION\n		bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n		if ( isPerspective ) scale *= - mvPosition.z;\n	#endif\n	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n	vec2 rotatedPosition;\n	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n	mvPosition.xy += rotatedPosition;\n	gl_Position = projectionMatrix * mvPosition;\n	#include <logdepthbuf_vertex>\n	#include <clipping_planes_vertex>\n	#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n	vec4 diffuseColor = vec4( diffuse, opacity );\n	#include <clipping_planes_fragment>\n	vec3 outgoingLight = vec3( 0.0 );\n	#include <logdepthbuf_fragment>\n	#include <map_fragment>\n	#include <alphamap_fragment>\n	#include <alphatest_fragment>\n	#include <alphahash_fragment>\n	outgoingLight = diffuseColor.rgb;\n	#include <opaque_fragment>\n	#include <tonemapping_fragment>\n	#include <colorspace_fragment>\n	#include <fog_fragment>\n}"},cr={common:{diffuse:{value:new bC(0xffffff)},opacity:{value:1},map:{value:null},mapTransform:{value:new aa},alphaMap:{value:null},alphaMapTransform:{value:new aa},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new aa}},envmap:{envMap:{value:null},envMapRotation:{value:new aa},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new aa}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new aa}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new aa},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new aa},normalScale:{value:new _(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new aa},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new aa}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new aa}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new aa}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new bC(0xffffff)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new bC(0xffffff)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new aa},alphaTest:{value:0},uvTransform:{value:new aa}},sprite:{diffuse:{value:new bC(0xffffff)},opacity:{value:1},center:{value:new _(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new aa},alphaMap:{value:null},alphaMapTransform:{value:new aa},alphaTest:{value:0}}},cs={basic:{uniforms:cd([cr.common,cr.specularmap,cr.envmap,cr.aomap,cr.lightmap,cr.fog]),vertexShader:cq.meshbasic_vert,fragmentShader:cq.meshbasic_frag},lambert:{uniforms:cd([cr.common,cr.specularmap,cr.envmap,cr.aomap,cr.lightmap,cr.emissivemap,cr.bumpmap,cr.normalmap,cr.displacementmap,cr.fog,cr.lights,{emissive:{value:new bC(0)}}]),vertexShader:cq.meshlambert_vert,fragmentShader:cq.meshlambert_frag},phong:{uniforms:cd([cr.common,cr.specularmap,cr.envmap,cr.aomap,cr.lightmap,cr.emissivemap,cr.bumpmap,cr.normalmap,cr.displacementmap,cr.fog,cr.lights,{emissive:{value:new bC(0)},specular:{value:new bC(1118481)},shininess:{value:30}}]),vertexShader:cq.meshphong_vert,fragmentShader:cq.meshphong_frag},standard:{uniforms:cd([cr.common,cr.envmap,cr.aomap,cr.lightmap,cr.emissivemap,cr.bumpmap,cr.normalmap,cr.displacementmap,cr.roughnessmap,cr.metalnessmap,cr.fog,cr.lights,{emissive:{value:new bC(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:cq.meshphysical_vert,fragmentShader:cq.meshphysical_frag},toon:{uniforms:cd([cr.common,cr.aomap,cr.lightmap,cr.emissivemap,cr.bumpmap,cr.normalmap,cr.displacementmap,cr.gradientmap,cr.fog,cr.lights,{emissive:{value:new bC(0)}}]),vertexShader:cq.meshtoon_vert,fragmentShader:cq.meshtoon_frag},matcap:{uniforms:cd([cr.common,cr.bumpmap,cr.normalmap,cr.displacementmap,cr.fog,{matcap:{value:null}}]),vertexShader:cq.meshmatcap_vert,fragmentShader:cq.meshmatcap_frag},points:{uniforms:cd([cr.points,cr.fog]),vertexShader:cq.points_vert,fragmentShader:cq.points_frag},dashed:{uniforms:cd([cr.common,cr.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:cq.linedashed_vert,fragmentShader:cq.linedashed_frag},depth:{uniforms:cd([cr.common,cr.displacementmap]),vertexShader:cq.depth_vert,fragmentShader:cq.depth_frag},normal:{uniforms:cd([cr.common,cr.bumpmap,cr.normalmap,cr.displacementmap,{opacity:{value:1}}]),vertexShader:cq.meshnormal_vert,fragmentShader:cq.meshnormal_frag},sprite:{uniforms:cd([cr.sprite,cr.fog]),vertexShader:cq.sprite_vert,fragmentShader:cq.sprite_frag},background:{uniforms:{uvTransform:{value:new aa},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:cq.background_vert,fragmentShader:cq.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new aa}},vertexShader:cq.backgroundCube_vert,fragmentShader:cq.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:cq.cube_vert,fragmentShader:cq.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:cq.equirect_vert,fragmentShader:cq.equirect_frag},distanceRGBA:{uniforms:cd([cr.common,cr.displacementmap,{referencePosition:{value:new at},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:cq.distanceRGBA_vert,fragmentShader:cq.distanceRGBA_frag},shadow:{uniforms:cd([cr.lights,cr.fog,{color:{value:new bC(0)},opacity:{value:1}}]),vertexShader:cq.shadow_vert,fragmentShader:cq.shadow_frag}};cs.physical={uniforms:cd([cs.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new aa},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new aa},clearcoatNormalScale:{value:new _(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new aa},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new aa},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new aa},sheen:{value:0},sheenColor:{value:new bC(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new aa},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new aa},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new aa},transmissionSamplerSize:{value:new _},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new aa},attenuationDistance:{value:0},attenuationColor:{value:new bC(0)},specularColor:{value:new bC(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new aa},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new aa},anisotropyVector:{value:new _},anisotropyMap:{value:null},anisotropyMapTransform:{value:new aa}}]),vertexShader:cq.meshphysical_vert,fragmentShader:cq.meshphysical_frag};class ct extends ce{constructor(a=-1,b=1,c=1,d=-1,e=.1,f=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=a,this.right=b,this.top=c,this.bottom=d,this.near=e,this.far=f,this.updateProjectionMatrix()}copy(a,b){return super.copy(a,b),this.left=a.left,this.right=a.right,this.top=a.top,this.bottom=a.bottom,this.near=a.near,this.far=a.far,this.zoom=a.zoom,this.view=null===a.view?null:Object.assign({},a.view),this}setViewOffset(a,b,c,d,e,f){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=a,this.view.fullHeight=b,this.view.offsetX=c,this.view.offsetY=d,this.view.width=e,this.view.height=f,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let a=(this.right-this.left)/(2*this.zoom),b=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,d=(this.top+this.bottom)/2,e=c-a,f=c+a,g=d+b,h=d-b;if(null!==this.view&&this.view.enabled){let a=(this.right-this.left)/this.view.fullWidth/this.zoom,b=(this.top-this.bottom)/this.view.fullHeight/this.zoom;e+=a*this.view.offsetX,f=e+a*this.view.width,g-=b*this.view.offsetY,h=g-b*this.view.height}this.projectionMatrix.makeOrthographic(e,f,g,h,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(a){let b=super.toJSON(a);return b.object.zoom=this.zoom,b.object.left=this.left,b.object.right=this.right,b.object.top=this.top,b.object.bottom=this.bottom,b.object.near=this.near,b.object.far=this.far,null!==this.view&&(b.object.view=Object.assign({},this.view)),b}}class cu extends aq{constructor(a,b,c,d,e,f,g,h,i,j){if(1026!==(j=void 0!==j?j:1026)&&1027!==j)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===c&&1026===j&&(c=1014),void 0===c&&1027===j&&(c=1020),super(null,d,e,f,g,h,j,c,i),this.isDepthTexture=!0,this.image={width:a,height:b},this.magFilter=void 0!==g?g:1003,this.minFilter=void 0!==h?h:1003,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(a){return super.copy(a),this.compareFunction=a.compareFunction,this}toJSON(a){let b=super.toJSON(a);return null!==this.compareFunction&&(b.compareFunction=this.compareFunction),b}}new cu(1,1).compareFunction=515,new Float32Array(16),new Float32Array(9),new Float32Array(4);class cv extends bm{constructor(){super(),this.isGroup=!0,this.type="Group"}}class cw extends bm{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new a5,this.environmentIntensity=1,this.environmentRotation=new a5,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(a,b){return super.copy(a,b),null!==a.background&&(this.background=a.background.clone()),null!==a.environment&&(this.environment=a.environment.clone()),null!==a.fog&&(this.fog=a.fog.clone()),this.backgroundBlurriness=a.backgroundBlurriness,this.backgroundIntensity=a.backgroundIntensity,this.backgroundRotation.copy(a.backgroundRotation),this.environmentIntensity=a.environmentIntensity,this.environmentRotation.copy(a.environmentRotation),null!==a.overrideMaterial&&(this.overrideMaterial=a.overrideMaterial.clone()),this.matrixAutoUpdate=a.matrixAutoUpdate,this}toJSON(a){let b=super.toJSON(a);return null!==this.fog&&(b.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(b.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(b.object.backgroundIntensity=this.backgroundIntensity),b.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(b.object.environmentIntensity=this.environmentIntensity),b.object.environmentRotation=this.environmentRotation.toArray(),b}}let cx=new at,cy=new ar,cz=new ar,cA=new at,cB=new aX,cC=new at,cD=new aO,cE=new aX,cF=new aW;class cG extends ca{constructor(a,b){super(a,b),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=L,this.bindMatrix=new aX,this.bindMatrixInverse=new aX,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){let a=this.geometry;null===this.boundingBox&&(this.boundingBox=new aw),this.boundingBox.makeEmpty();let b=a.getAttribute("position");for(let a=0;a<b.count;a++)this.getVertexPosition(a,cC),this.boundingBox.expandByPoint(cC)}computeBoundingSphere(){let a=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new aO),this.boundingSphere.makeEmpty();let b=a.getAttribute("position");for(let a=0;a<b.count;a++)this.getVertexPosition(a,cC),this.boundingSphere.expandByPoint(cC)}copy(a,b){return super.copy(a,b),this.bindMode=a.bindMode,this.bindMatrix.copy(a.bindMatrix),this.bindMatrixInverse.copy(a.bindMatrixInverse),this.skeleton=a.skeleton,null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone()),null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone()),this}raycast(a,b){let c=this.material,d=this.matrixWorld;if(void 0!==c)null===this.boundingSphere&&this.computeBoundingSphere(),cD.copy(this.boundingSphere),cD.applyMatrix4(d),!1!==a.ray.intersectsSphere(cD)&&(cE.copy(d).invert(),cF.copy(a.ray).applyMatrix4(cE),(null===this.boundingBox||!1!==cF.intersectsBox(this.boundingBox))&&this._computeIntersections(a,b,cF))}getVertexPosition(a,b){return super.getVertexPosition(a,b),this.applyBoneTransform(a,b),b}bind(a,b){this.skeleton=a,void 0===b&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),b=this.matrixWorld),this.bindMatrix.copy(b),this.bindMatrixInverse.copy(b).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){let a=new ar,b=this.geometry.attributes.skinWeight;for(let c=0,d=b.count;c<d;c++){a.fromBufferAttribute(b,c);let d=1/a.manhattanLength();d!==1/0?a.multiplyScalar(d):a.set(1,0,0,0),b.setXYZW(c,a.x,a.y,a.z,a.w)}}updateMatrixWorld(a){super.updateMatrixWorld(a),this.bindMode===L?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(a,b){let c=this.skeleton,d=this.geometry;cy.fromBufferAttribute(d.attributes.skinIndex,a),cz.fromBufferAttribute(d.attributes.skinWeight,a),cx.copy(b).applyMatrix4(this.bindMatrix),b.set(0,0,0);for(let a=0;a<4;a++){let d=cz.getComponent(a);if(0!==d){let e=cy.getComponent(a);cB.multiplyMatrices(c.bones[e].matrixWorld,c.boneInverses[e]),b.addScaledVector(cA.copy(cx).applyMatrix4(cB),d)}}return b.applyMatrix4(this.bindMatrixInverse)}}class cH extends bm{constructor(){super(),this.isBone=!0,this.type="Bone"}}class cI extends aq{constructor(a=null,b=1,c=1,d,e,f,g,h,i=1003,j=1003,k,l){super(null,f,g,h,i,j,d,e,k,l),this.isDataTexture=!0,this.image={data:a,width:b,height:c},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}let cJ=new aX,cK=new aX;class cL{constructor(a=[],b=[]){this.uuid=W(),this.bones=a.slice(0),this.boneInverses=b,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){let a=this.bones,b=this.boneInverses;if(this.boneMatrices=new Float32Array(16*a.length),0===b.length)this.calculateInverses();else if(a.length!==b.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let a=0,b=this.bones.length;a<b;a++)this.boneInverses.push(new aX)}}calculateInverses(){this.boneInverses.length=0;for(let a=0,b=this.bones.length;a<b;a++){let b=new aX;this.bones[a]&&b.copy(this.bones[a].matrixWorld).invert(),this.boneInverses.push(b)}}pose(){for(let a=0,b=this.bones.length;a<b;a++){let b=this.bones[a];b&&b.matrixWorld.copy(this.boneInverses[a]).invert()}for(let a=0,b=this.bones.length;a<b;a++){let b=this.bones[a];b&&(b.parent&&b.parent.isBone?(b.matrix.copy(b.parent.matrixWorld).invert(),b.matrix.multiply(b.matrixWorld)):b.matrix.copy(b.matrixWorld),b.matrix.decompose(b.position,b.quaternion,b.scale))}}update(){let a=this.bones,b=this.boneInverses,c=this.boneMatrices,d=this.boneTexture;for(let d=0,e=a.length;d<e;d++){let e=a[d]?a[d].matrixWorld:cK;cJ.multiplyMatrices(e,b[d]),cJ.toArray(c,16*d)}null!==d&&(d.needsUpdate=!0)}clone(){return new cL(this.bones,this.boneInverses)}computeBoneTexture(){let a=Math.sqrt(4*this.bones.length),b=new Float32Array((a=Math.max(a=4*Math.ceil(a/4),4))*a*4);b.set(this.boneMatrices);let c=new cI(b,a,a,1023,1015);return c.needsUpdate=!0,this.boneMatrices=b,this.boneTexture=c,this}getBoneByName(a){for(let b=0,c=this.bones.length;b<c;b++){let c=this.bones[b];if(c.name===a)return c}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(a,b){this.uuid=a.uuid;for(let c=0,d=a.bones.length;c<d;c++){let d=a.bones[c],e=b[d];void 0===e&&(console.warn("THREE.Skeleton: No bone found with UUID:",d),e=new cH),this.bones.push(e),this.boneInverses.push(new aX().fromArray(a.boneInverses[c]))}return this.init(),this}toJSON(){let a={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};a.uuid=this.uuid;let b=this.bones,c=this.boneInverses;for(let d=0,e=b.length;d<e;d++){let e=b[d];a.bones.push(e.uuid);let f=c[d];a.boneInverses.push(f.toArray())}return a}}class cM extends bF{constructor(a){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new bC(0xffffff),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.linewidth=a.linewidth,this.linecap=a.linecap,this.linejoin=a.linejoin,this.fog=a.fog,this}}let cN=new at,cO=new at,cP=new aX,cQ=new aW,cR=new aO,cS=new at,cT=new at;class cU extends bm{constructor(a=new bU,b=new cM){super(),this.isLine=!0,this.type="Line",this.geometry=a,this.material=b,this.updateMorphTargets()}copy(a,b){return super.copy(a,b),this.material=Array.isArray(a.material)?a.material.slice():a.material,this.geometry=a.geometry,this}computeLineDistances(){let a=this.geometry;if(null===a.index){let b=a.attributes.position,c=[0];for(let a=1,d=b.count;a<d;a++)cN.fromBufferAttribute(b,a-1),cO.fromBufferAttribute(b,a),c[a]=c[a-1],c[a]+=cN.distanceTo(cO);a.setAttribute("lineDistance",new bM(c,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(a,b){let c=this.geometry,d=this.matrixWorld,e=a.params.Line.threshold,f=c.drawRange;if(null===c.boundingSphere&&c.computeBoundingSphere(),cR.copy(c.boundingSphere),cR.applyMatrix4(d),cR.radius+=e,!1===a.ray.intersectsSphere(cR))return;cP.copy(d).invert(),cQ.copy(a.ray).applyMatrix4(cP);let g=e/((this.scale.x+this.scale.y+this.scale.z)/3),h=g*g,i=this.isLineSegments?2:1,j=c.index,k=c.attributes.position;if(null!==j){let c=Math.max(0,f.start),d=Math.min(j.count,f.start+f.count);for(let e=c,f=d-1;e<f;e+=i){let c=cV(this,a,cQ,h,j.getX(e),j.getX(e+1));c&&b.push(c)}if(this.isLineLoop){let e=cV(this,a,cQ,h,j.getX(d-1),j.getX(c));e&&b.push(e)}}else{let c=Math.max(0,f.start),d=Math.min(k.count,f.start+f.count);for(let e=c,f=d-1;e<f;e+=i){let c=cV(this,a,cQ,h,e,e+1);c&&b.push(c)}if(this.isLineLoop){let e=cV(this,a,cQ,h,d-1,c);e&&b.push(e)}}}updateMorphTargets(){let a=this.geometry.morphAttributes,b=Object.keys(a);if(b.length>0){let c=a[b[0]];if(void 0!==c){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,b=c.length;a<b;a++){let b=c[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[b]=a}}}}}function cV(a,b,c,d,e,f){let g=a.geometry.attributes.position;if(cN.fromBufferAttribute(g,e),cO.fromBufferAttribute(g,f),c.distanceSqToSegment(cN,cO,cS,cT)>d)return;cS.applyMatrix4(a.matrixWorld);let h=b.ray.origin.distanceTo(cS);if(!(h<b.near)&&!(h>b.far))return{distance:h,point:cT.clone().applyMatrix4(a.matrixWorld),index:e,face:null,faceIndex:null,object:a}}let cW=new at,cX=new at;class cY extends cU{constructor(a,b){super(a,b),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let a=this.geometry;if(null===a.index){let b=a.attributes.position,c=[];for(let a=0,d=b.count;a<d;a+=2)cW.fromBufferAttribute(b,a),cX.fromBufferAttribute(b,a+1),c[a]=0===a?0:c[a-1],c[a+1]=c[a]+cW.distanceTo(cX);a.setAttribute("lineDistance",new bM(c,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class cZ{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(a,b){let c=this.getUtoTmapping(a);return this.getPoint(c,b)}getPoints(a=5){let b=[];for(let c=0;c<=a;c++)b.push(this.getPoint(c/a));return b}getSpacedPoints(a=5){let b=[];for(let c=0;c<=a;c++)b.push(this.getPointAt(c/a));return b}getLength(){let a=this.getLengths();return a[a.length-1]}getLengths(a=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===a+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let b=[],c,d=this.getPoint(0),e=0;b.push(0);for(let f=1;f<=a;f++)b.push(e+=(c=this.getPoint(f/a)).distanceTo(d)),d=c;return this.cacheArcLengths=b,b}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(a,b){let c,d=this.getLengths(),e=0,f=d.length;c=b||a*d[f-1];let g=0,h=f-1,i;for(;g<=h;)if((i=d[e=Math.floor(g+(h-g)/2)]-c)<0)g=e+1;else if(i>0)h=e-1;else{h=e;break}if(d[e=h]===c)return e/(f-1);let j=d[e],k=d[e+1];return(e+(c-j)/(k-j))/(f-1)}getTangent(a,b){let c=a-1e-4,d=a+1e-4;c<0&&(c=0),d>1&&(d=1);let e=this.getPoint(c),f=this.getPoint(d),g=b||(e.isVector2?new _:new at);return g.copy(f).sub(e).normalize(),g}getTangentAt(a,b){let c=this.getUtoTmapping(a);return this.getTangent(c,b)}computeFrenetFrames(a,b){let c=new at,d=[],e=[],f=[],g=new at,h=new aX;for(let b=0;b<=a;b++){let c=b/a;d[b]=this.getTangentAt(c,new at)}e[0]=new at,f[0]=new at;let i=Number.MAX_VALUE,j=Math.abs(d[0].x),k=Math.abs(d[0].y),l=Math.abs(d[0].z);j<=i&&(i=j,c.set(1,0,0)),k<=i&&(i=k,c.set(0,1,0)),l<=i&&c.set(0,0,1),g.crossVectors(d[0],c).normalize(),e[0].crossVectors(d[0],g),f[0].crossVectors(d[0],e[0]);for(let b=1;b<=a;b++){if(e[b]=e[b-1].clone(),f[b]=f[b-1].clone(),g.crossVectors(d[b-1],d[b]),g.length()>Number.EPSILON){g.normalize();let a=Math.acos(X(d[b-1].dot(d[b]),-1,1));e[b].applyMatrix4(h.makeRotationAxis(g,a))}f[b].crossVectors(d[b],e[b])}if(!0===b){let b=Math.acos(X(e[0].dot(e[a]),-1,1));b/=a,d[0].dot(g.crossVectors(e[0],e[a]))>0&&(b=-b);for(let c=1;c<=a;c++)e[c].applyMatrix4(h.makeRotationAxis(d[c],b*c)),f[c].crossVectors(d[c],e[c])}return{tangents:d,normals:e,binormals:f}}clone(){return new this.constructor().copy(this)}copy(a){return this.arcLengthDivisions=a.arcLengthDivisions,this}toJSON(){let a={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return a.arcLengthDivisions=this.arcLengthDivisions,a.type=this.type,a}fromJSON(a){return this.arcLengthDivisions=a.arcLengthDivisions,this}}class c$ extends cZ{constructor(a=0,b=0,c=1,d=1,e=0,f=2*Math.PI,g=!1,h=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=a,this.aY=b,this.xRadius=c,this.yRadius=d,this.aStartAngle=e,this.aEndAngle=f,this.aClockwise=g,this.aRotation=h}getPoint(a,b=new _){let c=2*Math.PI,d=this.aEndAngle-this.aStartAngle,e=Math.abs(d)<Number.EPSILON;for(;d<0;)d+=c;for(;d>c;)d-=c;d<Number.EPSILON&&(d=e?0:c),!0!==this.aClockwise||e||(d===c?d=-c:d-=c);let f=this.aStartAngle+a*d,g=this.aX+this.xRadius*Math.cos(f),h=this.aY+this.yRadius*Math.sin(f);if(0!==this.aRotation){let a=Math.cos(this.aRotation),b=Math.sin(this.aRotation),c=g-this.aX,d=h-this.aY;g=c*a-d*b+this.aX,h=c*b+d*a+this.aY}return b.set(g,h)}copy(a){return super.copy(a),this.aX=a.aX,this.aY=a.aY,this.xRadius=a.xRadius,this.yRadius=a.yRadius,this.aStartAngle=a.aStartAngle,this.aEndAngle=a.aEndAngle,this.aClockwise=a.aClockwise,this.aRotation=a.aRotation,this}toJSON(){let a=super.toJSON();return a.aX=this.aX,a.aY=this.aY,a.xRadius=this.xRadius,a.yRadius=this.yRadius,a.aStartAngle=this.aStartAngle,a.aEndAngle=this.aEndAngle,a.aClockwise=this.aClockwise,a.aRotation=this.aRotation,a}fromJSON(a){return super.fromJSON(a),this.aX=a.aX,this.aY=a.aY,this.xRadius=a.xRadius,this.yRadius=a.yRadius,this.aStartAngle=a.aStartAngle,this.aEndAngle=a.aEndAngle,this.aClockwise=a.aClockwise,this.aRotation=a.aRotation,this}}class c_ extends c${constructor(a,b,c,d,e,f){super(a,b,c,c,d,e,f),this.isArcCurve=!0,this.type="ArcCurve"}}function c0(){let a=0,b=0,c=0,d=0;function e(e,f,g,h){a=e,b=g,c=-3*e+3*f-2*g-h,d=2*e-2*f+g+h}return{initCatmullRom:function(a,b,c,d,f){e(b,c,f*(c-a),f*(d-b))},initNonuniformCatmullRom:function(a,b,c,d,f,g,h){let i=(b-a)/f-(c-a)/(f+g)+(c-b)/g,j=(c-b)/g-(d-b)/(g+h)+(d-c)/h;e(b,c,i*=g,j*=g)},calc:function(e){let f=e*e;return a+b*e+c*f+f*e*d}}}let c1=new at,c2=new c0,c3=new c0,c4=new c0;class c5 extends cZ{constructor(a=[],b=!1,c="centripetal",d=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=a,this.closed=b,this.curveType=c,this.tension=d}getPoint(a,b=new at){let c,d,e=this.points,f=e.length,g=(f-!this.closed)*a,h=Math.floor(g),i=g-h;this.closed?h+=h>0?0:(Math.floor(Math.abs(h)/f)+1)*f:0===i&&h===f-1&&(h=f-2,i=1),this.closed||h>0?c=e[(h-1)%f]:(c1.subVectors(e[0],e[1]).add(e[0]),c=c1);let j=e[h%f],k=e[(h+1)%f];if(this.closed||h+2<f?d=e[(h+2)%f]:(c1.subVectors(e[f-1],e[f-2]).add(e[f-1]),d=c1),"centripetal"===this.curveType||"chordal"===this.curveType){let a="chordal"===this.curveType?.5:.25,b=Math.pow(c.distanceToSquared(j),a),e=Math.pow(j.distanceToSquared(k),a),f=Math.pow(k.distanceToSquared(d),a);e<1e-4&&(e=1),b<1e-4&&(b=e),f<1e-4&&(f=e),c2.initNonuniformCatmullRom(c.x,j.x,k.x,d.x,b,e,f),c3.initNonuniformCatmullRom(c.y,j.y,k.y,d.y,b,e,f),c4.initNonuniformCatmullRom(c.z,j.z,k.z,d.z,b,e,f)}else"catmullrom"===this.curveType&&(c2.initCatmullRom(c.x,j.x,k.x,d.x,this.tension),c3.initCatmullRom(c.y,j.y,k.y,d.y,this.tension),c4.initCatmullRom(c.z,j.z,k.z,d.z,this.tension));return b.set(c2.calc(i),c3.calc(i),c4.calc(i)),b}copy(a){super.copy(a),this.points=[];for(let b=0,c=a.points.length;b<c;b++){let c=a.points[b];this.points.push(c.clone())}return this.closed=a.closed,this.curveType=a.curveType,this.tension=a.tension,this}toJSON(){let a=super.toJSON();a.points=[];for(let b=0,c=this.points.length;b<c;b++){let c=this.points[b];a.points.push(c.toArray())}return a.closed=this.closed,a.curveType=this.curveType,a.tension=this.tension,a}fromJSON(a){super.fromJSON(a),this.points=[];for(let b=0,c=a.points.length;b<c;b++){let c=a.points[b];this.points.push(new at().fromArray(c))}return this.closed=a.closed,this.curveType=a.curveType,this.tension=a.tension,this}}function c6(a,b,c,d,e){let f=(d-b)*.5,g=(e-c)*.5,h=a*a;return a*h*(2*c-2*d+f+g)+(-3*c+3*d-2*f-g)*h+f*a+c}function c7(a,b,c,d){return function(a,b){let c=1-a;return c*c*b}(a,b)+2*(1-a)*a*c+a*a*d}function c8(a,b,c,d,e){return function(a,b){let c=1-a;return c*c*c*b}(a,b)+function(a,b){let c=1-a;return 3*c*c*a*b}(a,c)+3*(1-a)*a*a*d+a*a*a*e}class c9 extends cZ{constructor(a=new _,b=new _,c=new _,d=new _){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=a,this.v1=b,this.v2=c,this.v3=d}getPoint(a,b=new _){let c=this.v0,d=this.v1,e=this.v2,f=this.v3;return b.set(c8(a,c.x,d.x,e.x,f.x),c8(a,c.y,d.y,e.y,f.y)),b}copy(a){return super.copy(a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this.v3.copy(a.v3),this}toJSON(){let a=super.toJSON();return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a.v3=this.v3.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this.v3.fromArray(a.v3),this}}class da extends cZ{constructor(a=new at,b=new at,c=new at,d=new at){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=a,this.v1=b,this.v2=c,this.v3=d}getPoint(a,b=new at){let c=this.v0,d=this.v1,e=this.v2,f=this.v3;return b.set(c8(a,c.x,d.x,e.x,f.x),c8(a,c.y,d.y,e.y,f.y),c8(a,c.z,d.z,e.z,f.z)),b}copy(a){return super.copy(a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this.v3.copy(a.v3),this}toJSON(){let a=super.toJSON();return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a.v3=this.v3.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this.v3.fromArray(a.v3),this}}class db extends cZ{constructor(a=new _,b=new _){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=a,this.v2=b}getPoint(a,b=new _){return 1===a?b.copy(this.v2):(b.copy(this.v2).sub(this.v1),b.multiplyScalar(a).add(this.v1)),b}getPointAt(a,b){return this.getPoint(a,b)}getTangent(a,b=new _){return b.subVectors(this.v2,this.v1).normalize()}getTangentAt(a,b){return this.getTangent(a,b)}copy(a){return super.copy(a),this.v1.copy(a.v1),this.v2.copy(a.v2),this}toJSON(){let a=super.toJSON();return a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this}}class dc extends cZ{constructor(a=new at,b=new at){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=a,this.v2=b}getPoint(a,b=new at){return 1===a?b.copy(this.v2):(b.copy(this.v2).sub(this.v1),b.multiplyScalar(a).add(this.v1)),b}getPointAt(a,b){return this.getPoint(a,b)}getTangent(a,b=new at){return b.subVectors(this.v2,this.v1).normalize()}getTangentAt(a,b){return this.getTangent(a,b)}copy(a){return super.copy(a),this.v1.copy(a.v1),this.v2.copy(a.v2),this}toJSON(){let a=super.toJSON();return a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this}}class dd extends cZ{constructor(a=new _,b=new _,c=new _){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=a,this.v1=b,this.v2=c}getPoint(a,b=new _){let c=this.v0,d=this.v1,e=this.v2;return b.set(c7(a,c.x,d.x,e.x),c7(a,c.y,d.y,e.y)),b}copy(a){return super.copy(a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this}toJSON(){let a=super.toJSON();return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this}}class de extends cZ{constructor(a=new at,b=new at,c=new at){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=a,this.v1=b,this.v2=c}getPoint(a,b=new at){let c=this.v0,d=this.v1,e=this.v2;return b.set(c7(a,c.x,d.x,e.x),c7(a,c.y,d.y,e.y),c7(a,c.z,d.z,e.z)),b}copy(a){return super.copy(a),this.v0.copy(a.v0),this.v1.copy(a.v1),this.v2.copy(a.v2),this}toJSON(){let a=super.toJSON();return a.v0=this.v0.toArray(),a.v1=this.v1.toArray(),a.v2=this.v2.toArray(),a}fromJSON(a){return super.fromJSON(a),this.v0.fromArray(a.v0),this.v1.fromArray(a.v1),this.v2.fromArray(a.v2),this}}class df extends cZ{constructor(a=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=a}getPoint(a,b=new _){let c=this.points,d=(c.length-1)*a,e=Math.floor(d),f=d-e,g=c[0===e?e:e-1],h=c[e],i=c[e>c.length-2?c.length-1:e+1],j=c[e>c.length-3?c.length-1:e+2];return b.set(c6(f,g.x,h.x,i.x,j.x),c6(f,g.y,h.y,i.y,j.y)),b}copy(a){super.copy(a),this.points=[];for(let b=0,c=a.points.length;b<c;b++){let c=a.points[b];this.points.push(c.clone())}return this}toJSON(){let a=super.toJSON();a.points=[];for(let b=0,c=this.points.length;b<c;b++){let c=this.points[b];a.points.push(c.toArray())}return a}fromJSON(a){super.fromJSON(a),this.points=[];for(let b=0,c=a.points.length;b<c;b++){let c=a.points[b];this.points.push(new _().fromArray(c))}return this}}let dg={triangulate:function(a,b,c=2){let d,e,f,g,h,i,j,k=b&&b.length,l=k?b[0]*c:a.length,m=dh(a,0,l,c,!0),n=[];if(!m||m.next===m.prev)return n;if(k&&(m=function(a,b,c,d){let e,f,g,h,i,j=[];for(e=0,f=b.length;e<f;e++)g=b[e]*d,h=e<f-1?b[e+1]*d:a.length,(i=dh(a,g,h,d,!1))===i.next&&(i.steiner=!0),j.push(function(a){let b=a,c=a;do(b.x<c.x||b.x===c.x&&b.y<c.y)&&(c=b),b=b.next;while(b!==a);return c}(i));for(j.sort(dj),e=0;e<j.length;e++)c=function(a,b){let c=function(a,b){let c=b,d=-1/0,e,f=a.x,g=a.y;do{if(g<=c.y&&g>=c.next.y&&c.next.y!==c.y){let a=c.x+(g-c.y)*(c.next.x-c.x)/(c.next.y-c.y);if(a<=f&&a>d&&(d=a,e=c.x<c.next.x?c:c.next,a===f))return e}c=c.next}while(c!==b);if(!e)return null;let h=e,i=e.x,j=e.y,k=1/0,l;c=e;do{var m,n;f>=c.x&&c.x>=i&&f!==c.x&&dl(g<j?f:d,g,i,j,g<j?d:f,g,c.x,c.y)&&(l=Math.abs(g-c.y)/(f-c.x),ds(c,a)&&(l<k||l===k&&(c.x>e.x||c.x===e.x&&(m=e,n=c,0>dm(m.prev,m,n.prev)&&0>dm(n.next,m,m.next))))&&(e=c,k=l)),c=c.next}while(c!==h);return e}(a,b);if(!c)return b;let d=dt(c,a);return di(d,d.next),di(c,c.next)}(j[e],c);return c}(a,b,m,c)),a.length>80*c){d=f=a[0],e=g=a[1];for(let b=c;b<l;b+=c)h=a[b],i=a[b+1],h<d&&(d=h),i<e&&(e=i),h>f&&(f=h),i>g&&(g=i);j=0!==(j=Math.max(f-d,g-e))?32767/j:0}return function a(b,c,d,e,f,g,h){if(!b)return;!h&&g&&function(a,b,c,d){let e=a;do 0===e.z&&(e.z=dk(e.x,e.y,b,c,d)),e.prevZ=e.prev,e.nextZ=e.next,e=e.next;while(e!==a);e.prevZ.nextZ=null,e.prevZ=null,function(a){let b,c,d,e,f,g,h,i,j=1;do{for(c=a,a=null,f=null,g=0;c;){for(g++,d=c,h=0,b=0;b<j&&(h++,d=d.nextZ);b++);for(i=j;h>0||i>0&&d;)0!==h&&(0===i||!d||c.z<=d.z)?(e=c,c=c.nextZ,h--):(e=d,d=d.nextZ,i--),f?f.nextZ=e:a=e,e.prevZ=f,f=e;c=d}f.nextZ=null,j*=2}while(g>1)}(e)}(b,e,f,g);let i=b,j,k;for(;b.prev!==b.next;){if(j=b.prev,k=b.next,g?function(a,b,c,d){let e=a.prev,f=a.next;if(dm(e,a,f)>=0)return!1;let g=e.x,h=a.x,i=f.x,j=e.y,k=a.y,l=f.y,m=g<h?g<i?g:i:h<i?h:i,n=j<k?j<l?j:l:k<l?k:l,o=g>h?g>i?g:i:h>i?h:i,p=j>k?j>l?j:l:k>l?k:l,q=dk(m,n,b,c,d),r=dk(o,p,b,c,d),s=a.prevZ,t=a.nextZ;for(;s&&s.z>=q&&t&&t.z<=r;){if(s.x>=m&&s.x<=o&&s.y>=n&&s.y<=p&&s!==e&&s!==f&&dl(g,j,h,k,i,l,s.x,s.y)&&dm(s.prev,s,s.next)>=0||(s=s.prevZ,t.x>=m&&t.x<=o&&t.y>=n&&t.y<=p&&t!==e&&t!==f&&dl(g,j,h,k,i,l,t.x,t.y)&&dm(t.prev,t,t.next)>=0))return!1;t=t.nextZ}for(;s&&s.z>=q;){if(s.x>=m&&s.x<=o&&s.y>=n&&s.y<=p&&s!==e&&s!==f&&dl(g,j,h,k,i,l,s.x,s.y)&&dm(s.prev,s,s.next)>=0)return!1;s=s.prevZ}for(;t&&t.z<=r;){if(t.x>=m&&t.x<=o&&t.y>=n&&t.y<=p&&t!==e&&t!==f&&dl(g,j,h,k,i,l,t.x,t.y)&&dm(t.prev,t,t.next)>=0)return!1;t=t.nextZ}return!0}(b,e,f,g):function(a){let b=a.prev,c=a.next;if(dm(b,a,c)>=0)return!1;let d=b.x,e=a.x,f=c.x,g=b.y,h=a.y,i=c.y,j=d<e?d<f?d:f:e<f?e:f,k=g<h?g<i?g:i:h<i?h:i,l=d>e?d>f?d:f:e>f?e:f,m=g>h?g>i?g:i:h>i?h:i,n=c.next;for(;n!==b;){if(n.x>=j&&n.x<=l&&n.y>=k&&n.y<=m&&dl(d,g,e,h,f,i,n.x,n.y)&&dm(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}(b)){c.push(j.i/d|0),c.push(b.i/d|0),c.push(k.i/d|0),dv(b),b=k.next,i=k.next;continue}if((b=k)===i){h?1===h?a(b=function(a,b,c){let d=a;do{let e=d.prev,f=d.next.next;!dn(e,f)&&dp(e,d,d.next,f)&&ds(e,f)&&ds(f,e)&&(b.push(e.i/c|0),b.push(d.i/c|0),b.push(f.i/c|0),dv(d),dv(d.next),d=a=f),d=d.next}while(d!==a);return di(d)}(di(b),c,d),c,d,e,f,g,2):2===h&&function(b,c,d,e,f,g){let h=b;do{let b=h.next.next;for(;b!==h.prev;){var i,j;if(h.i!==b.i&&(i=h,j=b,i.next.i!==j.i&&i.prev.i!==j.i&&!function(a,b){let c=a;do{if(c.i!==a.i&&c.next.i!==a.i&&c.i!==b.i&&c.next.i!==b.i&&dp(c,c.next,a,b))return!0;c=c.next}while(c!==a);return!1}(i,j)&&(ds(i,j)&&ds(j,i)&&function(a,b){let c=a,d=!1,e=(a.x+b.x)/2,f=(a.y+b.y)/2;do c.y>f!=c.next.y>f&&c.next.y!==c.y&&e<(c.next.x-c.x)*(f-c.y)/(c.next.y-c.y)+c.x&&(d=!d),c=c.next;while(c!==a);return d}(i,j)&&(dm(i.prev,i,j.prev)||dm(i,j.prev,j))||dn(i,j)&&dm(i.prev,i,i.next)>0&&dm(j.prev,j,j.next)>0))){let i=dt(h,b);h=di(h,h.next),i=di(i,i.next),a(h,c,d,e,f,g,0),a(i,c,d,e,f,g,0);return}b=b.next}h=h.next}while(h!==b)}(b,c,d,e,f,g):a(di(b),c,d,e,f,g,1);break}}}(m,n,c,d,e,j,0),n}};function dh(a,b,c,d,e){let f,g;if(e===function(a,b,c,d){let e=0;for(let f=b,g=c-d;f<c;f+=d)e+=(a[g]-a[f])*(a[f+1]+a[g+1]),g=f;return e}(a,b,c,d)>0)for(f=b;f<c;f+=d)g=du(f,a[f],a[f+1],g);else for(f=c-d;f>=b;f-=d)g=du(f,a[f],a[f+1],g);return g&&dn(g,g.next)&&(dv(g),g=g.next),g}function di(a,b){if(!a)return a;b||(b=a);let c=a,d;do if(d=!1,!c.steiner&&(dn(c,c.next)||0===dm(c.prev,c,c.next))){if(dv(c),(c=b=c.prev)===c.next)break;d=!0}else c=c.next;while(d||c!==b);return b}function dj(a,b){return a.x-b.x}function dk(a,b,c,d,e){return(a=((a=((a=((a=((a=(a-c)*e|0)|a<<8)&0xff00ff)|a<<4)&0xf0f0f0f)|a<<2)&0x33333333)|a<<1)&0x55555555)|(b=((b=((b=((b=((b=(b-d)*e|0)|b<<8)&0xff00ff)|b<<4)&0xf0f0f0f)|b<<2)&0x33333333)|b<<1)&0x55555555)<<1}function dl(a,b,c,d,e,f,g,h){return(e-g)*(b-h)>=(a-g)*(f-h)&&(a-g)*(d-h)>=(c-g)*(b-h)&&(c-g)*(f-h)>=(e-g)*(d-h)}function dm(a,b,c){return(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)}function dn(a,b){return a.x===b.x&&a.y===b.y}function dp(a,b,c,d){let e=dr(dm(a,b,c)),f=dr(dm(a,b,d)),g=dr(dm(c,d,a)),h=dr(dm(c,d,b));return!!(e!==f&&g!==h||0===e&&dq(a,c,b)||0===f&&dq(a,d,b)||0===g&&dq(c,a,d)||0===h&&dq(c,b,d))}function dq(a,b,c){return b.x<=Math.max(a.x,c.x)&&b.x>=Math.min(a.x,c.x)&&b.y<=Math.max(a.y,c.y)&&b.y>=Math.min(a.y,c.y)}function dr(a){return a>0?1:a<0?-1:0}function ds(a,b){return 0>dm(a.prev,a,a.next)?dm(a,b,a.next)>=0&&dm(a,a.prev,b)>=0:0>dm(a,b,a.prev)||0>dm(a,a.next,b)}function dt(a,b){let c=new dw(a.i,a.x,a.y),d=new dw(b.i,b.x,b.y),e=a.next,f=b.prev;return a.next=b,b.prev=a,c.next=e,e.prev=c,d.next=c,c.prev=d,f.next=d,d.prev=f,d}function du(a,b,c,d){let e=new dw(a,b,c);return d?(e.next=d.next,e.prev=d,d.next.prev=e,d.next=e):(e.prev=e,e.next=e),e}function dv(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function dw(a,b,c){this.i=a,this.x=b,this.y=c,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class dx{static area(a){let b=a.length,c=0;for(let d=b-1,e=0;e<b;d=e++)c+=a[d].x*a[e].y-a[e].x*a[d].y;return .5*c}static isClockWise(a){return 0>dx.area(a)}static triangulateShape(a,b){let c=[],d=[],e=[];dy(a),dz(c,a);let f=a.length;b.forEach(dy);for(let a=0;a<b.length;a++)d.push(f),f+=b[a].length,dz(c,b[a]);let g=dg.triangulate(c,d);for(let a=0;a<g.length;a+=3)e.push(g.slice(a,a+3));return e}}function dy(a){let b=a.length;b>2&&a[b-1].equals(a[0])&&a.pop()}function dz(a,b){for(let c=0;c<b.length;c++)a.push(b[c].x),a.push(b[c].y)}class dA extends bF{constructor(a){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new bC(0xffffff),this.specular=new bC(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new bC(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new _(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new a5,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.specular.copy(a.specular),this.shininess=a.shininess,this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.envMapRotation.copy(a.envMapRotation),this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.flatShading=a.flatShading,this.fog=a.fog,this}}class dB extends bF{constructor(a){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new bC(0xffffff),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new bC(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new _(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new a5,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(a)}copy(a){return super.copy(a),this.color.copy(a.color),this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalMapType=a.normalMapType,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.envMapRotation.copy(a.envMapRotation),this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.flatShading=a.flatShading,this.fog=a.fog,this}}function dC(a,b,c){return a&&(c||a.constructor!==b)?"number"==typeof b.BYTES_PER_ELEMENT?new b(a):Array.prototype.slice.call(a):a}function dD(a,b,c){let d=a.length,e=new a.constructor(d);for(let f=0,g=0;g!==d;++f){let d=c[f]*b;for(let c=0;c!==b;++c)e[g++]=a[d+c]}return e}function dE(a,b,c,d){let e=1,f=a[0];for(;void 0!==f&&void 0===f[d];)f=a[e++];if(void 0===f)return;let g=f[d];if(void 0!==g)if(Array.isArray(g))do void 0!==(g=f[d])&&(b.push(f.time),c.push.apply(c,g)),f=a[e++];while(void 0!==f);else if(void 0!==g.toArray)do void 0!==(g=f[d])&&(b.push(f.time),g.toArray(c,c.length)),f=a[e++];while(void 0!==f);else do void 0!==(g=f[d])&&(b.push(f.time),c.push(g)),f=a[e++];while(void 0!==f)}class dF{constructor(a,b,c,d){this.parameterPositions=a,this._cachedIndex=0,this.resultBuffer=void 0!==d?d:new b.constructor(c),this.sampleValues=b,this.valueSize=c,this.settings=null,this.DefaultSettings_={}}evaluate(a){let b=this.parameterPositions,c=this._cachedIndex,d=b[c],e=b[c-1];a:{b:{let f;c:{d:if(!(a<d)){for(let f=c+2;;){if(void 0===d){if(a<e)break d;return c=b.length,this._cachedIndex=c,this.copySampleValue_(c-1)}if(c===f)break;if(e=d,a<(d=b[++c]))break b}f=b.length;break c}if(!(a>=e)){let g=b[1];a<g&&(c=2,e=g);for(let f=c-2;;){if(void 0===e)return this._cachedIndex=0,this.copySampleValue_(0);if(c===f)break;if(d=e,a>=(e=b[--c-1]))break b}f=c,c=0;break c}break a}for(;c<f;){let d=c+f>>>1;a<b[d]?f=d:c=d+1}if(d=b[c],void 0===(e=b[c-1]))return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===d)return c=b.length,this._cachedIndex=c,this.copySampleValue_(c-1)}this._cachedIndex=c,this.intervalChanged_(c,e,d)}return this.interpolate_(c,e,a,d)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(a){let b=this.resultBuffer,c=this.sampleValues,d=this.valueSize,e=a*d;for(let a=0;a!==d;++a)b[a]=c[e+a];return b}interpolate_(){throw Error("call to abstract method")}intervalChanged_(){}}class dG extends dF{constructor(a,b,c,d){super(a,b,c,d),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(a,b,c){let d=this.parameterPositions,e=a-2,f=a+1,g=d[e],h=d[f];if(void 0===g)switch(this.getSettings_().endingStart){case 2401:e=a,g=2*b-c;break;case 2402:e=d.length-2,g=b+d[e]-d[e+1];break;default:e=a,g=c}if(void 0===h)switch(this.getSettings_().endingEnd){case 2401:f=a,h=2*c-b;break;case 2402:f=1,h=c+d[1]-d[0];break;default:f=a-1,h=b}let i=(c-b)*.5,j=this.valueSize;this._weightPrev=i/(b-g),this._weightNext=i/(h-c),this._offsetPrev=e*j,this._offsetNext=f*j}interpolate_(a,b,c,d){let e=this.resultBuffer,f=this.sampleValues,g=this.valueSize,h=a*g,i=h-g,j=this._offsetPrev,k=this._offsetNext,l=this._weightPrev,m=this._weightNext,n=(c-b)/(d-b),o=n*n,p=o*n,q=-l*p+2*l*o-l*n,r=(1+l)*p+(-1.5-2*l)*o+(-.5+l)*n+1,s=(-1-m)*p+(1.5+m)*o+.5*n,t=m*p-m*o;for(let a=0;a!==g;++a)e[a]=q*f[j+a]+r*f[i+a]+s*f[h+a]+t*f[k+a];return e}}class dH extends dF{constructor(a,b,c,d){super(a,b,c,d)}interpolate_(a,b,c,d){let e=this.resultBuffer,f=this.sampleValues,g=this.valueSize,h=a*g,i=h-g,j=(c-b)/(d-b),k=1-j;for(let a=0;a!==g;++a)e[a]=f[i+a]*k+f[h+a]*j;return e}}class dI extends dF{constructor(a,b,c,d){super(a,b,c,d)}interpolate_(a){return this.copySampleValue_(a-1)}}class dJ{constructor(a,b,c,d){if(void 0===a)throw Error("THREE.KeyframeTrack: track name is undefined");if(void 0===b||0===b.length)throw Error("THREE.KeyframeTrack: no keyframes in track named "+a);this.name=a,this.times=dC(b,this.TimeBufferType),this.values=dC(c,this.ValueBufferType),this.setInterpolation(d||this.DefaultInterpolation)}static toJSON(a){let b,c=a.constructor;if(c.toJSON!==this.toJSON)b=c.toJSON(a);else{b={name:a.name,times:dC(a.times,Array),values:dC(a.values,Array)};let c=a.getInterpolation();c!==a.DefaultInterpolation&&(b.interpolation=c)}return b.type=a.ValueTypeName,b}InterpolantFactoryMethodDiscrete(a){return new dI(this.times,this.values,this.getValueSize(),a)}InterpolantFactoryMethodLinear(a){return new dH(this.times,this.values,this.getValueSize(),a)}InterpolantFactoryMethodSmooth(a){return new dG(this.times,this.values,this.getValueSize(),a)}setInterpolation(a){let b;switch(a){case 2300:b=this.InterpolantFactoryMethodDiscrete;break;case 2301:b=this.InterpolantFactoryMethodLinear;break;case 2302:b=this.InterpolantFactoryMethodSmooth}if(void 0===b){let b="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant)if(a!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw Error(b);return console.warn("THREE.KeyframeTrack:",b),this}return this.createInterpolant=b,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(a){if(0!==a){let b=this.times;for(let c=0,d=b.length;c!==d;++c)b[c]+=a}return this}scale(a){if(1!==a){let b=this.times;for(let c=0,d=b.length;c!==d;++c)b[c]*=a}return this}trim(a,b){let c=this.times,d=c.length,e=0,f=d-1;for(;e!==d&&c[e]<a;)++e;for(;-1!==f&&c[f]>b;)--f;if(++f,0!==e||f!==d){e>=f&&(e=(f=Math.max(f,1))-1);let a=this.getValueSize();this.times=c.slice(e,f),this.values=this.values.slice(e*a,f*a)}return this}validate(){var a;let b=!0,c=this.getValueSize();c-Math.floor(c)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),b=!1);let d=this.times,e=this.values,f=d.length;0===f&&(console.error("THREE.KeyframeTrack: Track is empty.",this),b=!1);let g=null;for(let a=0;a!==f;a++){let c=d[a];if("number"==typeof c&&isNaN(c)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,c),b=!1;break}if(null!==g&&g>c){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,c,g),b=!1;break}g=c}if(void 0!==e&&ArrayBuffer.isView(a=e)&&!(a instanceof DataView))for(let a=0,c=e.length;a!==c;++a){let c=e[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),b=!1;break}}return b}optimize(){let a=this.times.slice(),b=this.values.slice(),c=this.getValueSize(),d=2302===this.getInterpolation(),e=a.length-1,f=1;for(let g=1;g<e;++g){let e=!1,h=a[g];if(h!==a[g+1]&&(1!==g||h!==a[0]))if(d)e=!0;else{let a=g*c,d=a-c,f=a+c;for(let g=0;g!==c;++g){let c=b[a+g];if(c!==b[d+g]||c!==b[f+g]){e=!0;break}}}if(e){if(g!==f){a[f]=a[g];let d=g*c,e=f*c;for(let a=0;a!==c;++a)b[e+a]=b[d+a]}++f}}if(e>0){a[f]=a[e];for(let a=e*c,d=f*c,g=0;g!==c;++g)b[d+g]=b[a+g];++f}return f!==a.length?(this.times=a.slice(0,f),this.values=b.slice(0,f*c)):(this.times=a,this.values=b),this}clone(){let a=this.times.slice(),b=this.values.slice(),c=new this.constructor(this.name,a,b);return c.createInterpolant=this.createInterpolant,c}}dJ.prototype.TimeBufferType=Float32Array,dJ.prototype.ValueBufferType=Float32Array,dJ.prototype.DefaultInterpolation=2301;class dK extends dJ{}dK.prototype.ValueTypeName="bool",dK.prototype.ValueBufferType=Array,dK.prototype.DefaultInterpolation=2300,dK.prototype.InterpolantFactoryMethodLinear=void 0,dK.prototype.InterpolantFactoryMethodSmooth=void 0;class dL extends dJ{}dL.prototype.ValueTypeName="color";class dM extends dJ{}dM.prototype.ValueTypeName="number";class dN extends dF{constructor(a,b,c,d){super(a,b,c,d)}interpolate_(a,b,c,d){let e=this.resultBuffer,f=this.sampleValues,g=this.valueSize,h=(c-b)/(d-b),i=a*g;for(let a=i+g;i!==a;i+=4)as.slerpFlat(e,0,f,i-g,f,i,h);return e}}class dO extends dJ{InterpolantFactoryMethodLinear(a){return new dN(this.times,this.values,this.getValueSize(),a)}}dO.prototype.ValueTypeName="quaternion",dO.prototype.DefaultInterpolation=2301,dO.prototype.InterpolantFactoryMethodSmooth=void 0;class dP extends dJ{}dP.prototype.ValueTypeName="string",dP.prototype.ValueBufferType=Array,dP.prototype.DefaultInterpolation=2300,dP.prototype.InterpolantFactoryMethodLinear=void 0,dP.prototype.InterpolantFactoryMethodSmooth=void 0;class dQ extends dJ{}dQ.prototype.ValueTypeName="vector";class dR{constructor(a="",b=-1,c=[],d=2500){this.name=a,this.tracks=c,this.duration=b,this.blendMode=d,this.uuid=W(),this.duration<0&&this.resetDuration()}static parse(a){let b=[],c=a.tracks,d=1/(a.fps||1);for(let a=0,e=c.length;a!==e;++a)b.push((function(a){if(void 0===a.type)throw Error("THREE.KeyframeTrack: track type undefined, can not parse");let b=function(a){switch(a.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return dM;case"vector":case"vector2":case"vector3":case"vector4":return dQ;case"color":return dL;case"quaternion":return dO;case"bool":case"boolean":return dK;case"string":return dP}throw Error("THREE.KeyframeTrack: Unsupported typeName: "+a)}(a.type);if(void 0===a.times){let b=[],c=[];dE(a.keys,b,c,"value"),a.times=b,a.values=c}return void 0!==b.parse?b.parse(a):new b(a.name,a.times,a.values,a.interpolation)})(c[a]).scale(d));let e=new this(a.name,a.duration,b,a.blendMode);return e.uuid=a.uuid,e}static toJSON(a){let b=[],c=a.tracks,d={name:a.name,duration:a.duration,tracks:b,uuid:a.uuid,blendMode:a.blendMode};for(let a=0,d=c.length;a!==d;++a)b.push(dJ.toJSON(c[a]));return d}static CreateFromMorphTargetSequence(a,b,c,d){let e=b.length,f=[];for(let a=0;a<e;a++){let g=[],h=[];g.push((a+e-1)%e,a,(a+1)%e),h.push(0,1,0);let i=function(a){let b=a.length,c=Array(b);for(let a=0;a!==b;++a)c[a]=a;return c.sort(function(b,c){return a[b]-a[c]}),c}(g);g=dD(g,1,i),h=dD(h,1,i),d||0!==g[0]||(g.push(e),h.push(h[0])),f.push(new dM(".morphTargetInfluences["+b[a].name+"]",g,h).scale(1/c))}return new this(a,-1,f)}static findByName(a,b){let c=a;Array.isArray(a)||(c=a.geometry&&a.geometry.animations||a.animations);for(let a=0;a<c.length;a++)if(c[a].name===b)return c[a];return null}static CreateClipsFromMorphTargetSequences(a,b,c){let d={},e=/^([\w-]*?)([\d]+)$/;for(let b=0,c=a.length;b<c;b++){let c=a[b],f=c.name.match(e);if(f&&f.length>1){let a=f[1],b=d[a];b||(d[a]=b=[]),b.push(c)}}let f=[];for(let a in d)f.push(this.CreateFromMorphTargetSequence(a,d[a],b,c));return f}static parseAnimation(a,b){if(!a)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let c=function(a,b,c,d,e){if(0!==c.length){let f=[],g=[];dE(c,f,g,d),0!==f.length&&e.push(new a(b,f,g))}},d=[],e=a.name||"default",f=a.fps||30,g=a.blendMode,h=a.length||-1,i=a.hierarchy||[];for(let a=0;a<i.length;a++){let e=i[a].keys;if(e&&0!==e.length)if(e[0].morphTargets){let a,b={};for(a=0;a<e.length;a++)if(e[a].morphTargets)for(let c=0;c<e[a].morphTargets.length;c++)b[e[a].morphTargets[c]]=-1;for(let c in b){let b=[],f=[];for(let d=0;d!==e[a].morphTargets.length;++d){let d=e[a];b.push(d.time),f.push(+(d.morphTarget===c))}d.push(new dM(".morphTargetInfluence["+c+"]",b,f))}h=b.length*f}else{let f=".bones["+b[a].name+"]";c(dQ,f+".position",e,"pos",d),c(dO,f+".quaternion",e,"rot",d),c(dQ,f+".scale",e,"scl",d)}}return 0===d.length?null:new this(e,h,d,g)}resetDuration(){let a=this.tracks,b=0;for(let c=0,d=a.length;c!==d;++c){let a=this.tracks[c];b=Math.max(b,a.times[a.times.length-1])}return this.duration=b,this}trim(){for(let a=0;a<this.tracks.length;a++)this.tracks[a].trim(0,this.duration);return this}validate(){let a=!0;for(let b=0;b<this.tracks.length;b++)a=a&&this.tracks[b].validate();return a}optimize(){for(let a=0;a<this.tracks.length;a++)this.tracks[a].optimize();return this}clone(){let a=[];for(let b=0;b<this.tracks.length;b++)a.push(this.tracks[b].clone());return new this.constructor(this.name,this.duration,a,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}let dS={enabled:!1,files:{},add:function(a,b){!1!==this.enabled&&(this.files[a]=b)},get:function(a){if(!1!==this.enabled)return this.files[a]},remove:function(a){delete this.files[a]},clear:function(){this.files={}}};class dT{constructor(a,b,c){let d,e=this,f=!1,g=0,h=0,i=[];this.onStart=void 0,this.onLoad=a,this.onProgress=b,this.onError=c,this.itemStart=function(a){h++,!1===f&&void 0!==e.onStart&&e.onStart(a,g,h),f=!0},this.itemEnd=function(a){g++,void 0!==e.onProgress&&e.onProgress(a,g,h),g===h&&(f=!1,void 0!==e.onLoad&&e.onLoad())},this.itemError=function(a){void 0!==e.onError&&e.onError(a)},this.resolveURL=function(a){return d?d(a):a},this.setURLModifier=function(a){return d=a,this},this.addHandler=function(a,b){return i.push(a,b),this},this.removeHandler=function(a){let b=i.indexOf(a);return -1!==b&&i.splice(b,2),this},this.getHandler=function(a){for(let b=0,c=i.length;b<c;b+=2){let c=i[b],d=i[b+1];if(c.global&&(c.lastIndex=0),c.test(a))return d}return null}}}let dU=new dT;class dV{constructor(a){this.manager=void 0!==a?a:dU,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(a,b){let c=this;return new Promise(function(d,e){c.load(a,d,b,e)})}parse(){}setCrossOrigin(a){return this.crossOrigin=a,this}setWithCredentials(a){return this.withCredentials=a,this}setPath(a){return this.path=a,this}setResourcePath(a){return this.resourcePath=a,this}setRequestHeader(a){return this.requestHeader=a,this}}dV.DEFAULT_MATERIAL_NAME="__DEFAULT";let dW={};class dX extends Error{constructor(a,b){super(a),this.response=b}}class dY extends dV{constructor(a){super(a)}load(a,b,c,d){void 0===a&&(a=""),void 0!==this.path&&(a=this.path+a),a=this.manager.resolveURL(a);let e=dS.get(a);if(void 0!==e)return this.manager.itemStart(a),setTimeout(()=>{b&&b(e),this.manager.itemEnd(a)},0),e;if(void 0!==dW[a])return void dW[a].push({onLoad:b,onProgress:c,onError:d});dW[a]=[],dW[a].push({onLoad:b,onProgress:c,onError:d});let f=new Request(a,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),g=this.mimeType,h=this.responseType;fetch(f).then(b=>{if(200===b.status||0===b.status){if(0===b.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===b.body||void 0===b.body.getReader)return b;let c=dW[a],d=b.body.getReader(),e=b.headers.get("X-File-Size")||b.headers.get("Content-Length"),f=e?parseInt(e):0,g=0!==f,h=0;return new Response(new ReadableStream({start(a){!function b(){d.read().then(({done:d,value:e})=>{if(d)a.close();else{let d=new ProgressEvent("progress",{lengthComputable:g,loaded:h+=e.byteLength,total:f});for(let a=0,b=c.length;a<b;a++){let b=c[a];b.onProgress&&b.onProgress(d)}a.enqueue(e),b()}})}()}}))}throw new dX(`fetch for "${b.url}" responded with ${b.status}: ${b.statusText}`,b)}).then(a=>{switch(h){case"arraybuffer":return a.arrayBuffer();case"blob":return a.blob();case"document":return a.text().then(a=>new DOMParser().parseFromString(a,g));case"json":return a.json();default:if(void 0===g)return a.text();{let b=/charset="?([^;"\s]*)"?/i.exec(g),c=new TextDecoder(b&&b[1]?b[1].toLowerCase():void 0);return a.arrayBuffer().then(a=>c.decode(a))}}}).then(b=>{dS.add(a,b);let c=dW[a];delete dW[a];for(let a=0,d=c.length;a<d;a++){let d=c[a];d.onLoad&&d.onLoad(b)}}).catch(b=>{let c=dW[a];if(void 0===c)throw this.manager.itemError(a),b;delete dW[a];for(let a=0,d=c.length;a<d;a++){let d=c[a];d.onError&&d.onError(b)}this.manager.itemError(a)}).finally(()=>{this.manager.itemEnd(a)}),this.manager.itemStart(a)}setResponseType(a){return this.responseType=a,this}setMimeType(a){return this.mimeType=a,this}}class dZ extends dV{constructor(a){super(a)}load(a,b,c,d){void 0!==this.path&&(a=this.path+a),a=this.manager.resolveURL(a);let e=this,f=dS.get(a);if(void 0!==f)return e.manager.itemStart(a),setTimeout(function(){b&&b(f),e.manager.itemEnd(a)},0),f;let g=ac("img");function h(){j(),dS.add(a,this),b&&b(this),e.manager.itemEnd(a)}function i(b){j(),d&&d(b),e.manager.itemError(a),e.manager.itemEnd(a)}function j(){g.removeEventListener("load",h,!1),g.removeEventListener("error",i,!1)}return g.addEventListener("load",h,!1),g.addEventListener("error",i,!1),"data:"!==a.slice(0,5)&&void 0!==this.crossOrigin&&(g.crossOrigin=this.crossOrigin),e.manager.itemStart(a),g.src=a,g}}class d$ extends dV{constructor(a){super(a)}load(a,b,c,d){let e=this,f=new cI,g=new dY(this.manager);return g.setResponseType("arraybuffer"),g.setRequestHeader(this.requestHeader),g.setPath(this.path),g.setWithCredentials(e.withCredentials),g.load(a,function(a){let c;try{c=e.parse(a)}catch(a){if(void 0===d)return void console.error(a);d(a)}void 0!==c.image?f.image=c.image:void 0!==c.data&&(f.image.width=c.width,f.image.height=c.height,f.image.data=c.data),f.wrapS=void 0!==c.wrapS?c.wrapS:1001,f.wrapT=void 0!==c.wrapT?c.wrapT:1001,f.magFilter=void 0!==c.magFilter?c.magFilter:1006,f.minFilter=void 0!==c.minFilter?c.minFilter:1006,f.anisotropy=void 0!==c.anisotropy?c.anisotropy:1,void 0!==c.colorSpace&&(f.colorSpace=c.colorSpace),void 0!==c.flipY&&(f.flipY=c.flipY),void 0!==c.format&&(f.format=c.format),void 0!==c.type&&(f.type=c.type),void 0!==c.mipmaps&&(f.mipmaps=c.mipmaps,f.minFilter=1008),1===c.mipmapCount&&(f.minFilter=1006),void 0!==c.generateMipmaps&&(f.generateMipmaps=c.generateMipmaps),f.needsUpdate=!0,b&&b(f,c)},c,d),f}}class d_ extends dV{constructor(a){super(a)}load(a,b,c,d){let e=new aq,f=new dZ(this.manager);return f.setCrossOrigin(this.crossOrigin),f.setPath(this.path),f.load(a,function(a){e.image=a,e.needsUpdate=!0,void 0!==b&&b(e)},c,d),e}}class d0 extends bm{constructor(a,b=1){super(),this.isLight=!0,this.type="Light",this.color=new bC(a),this.intensity=b}dispose(){}copy(a,b){return super.copy(a,b),this.color.copy(a.color),this.intensity=a.intensity,this}toJSON(a){let b=super.toJSON(a);return b.object.color=this.color.getHex(),b.object.intensity=this.intensity,void 0!==this.groundColor&&(b.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(b.object.distance=this.distance),void 0!==this.angle&&(b.object.angle=this.angle),void 0!==this.decay&&(b.object.decay=this.decay),void 0!==this.penumbra&&(b.object.penumbra=this.penumbra),void 0!==this.shadow&&(b.object.shadow=this.shadow.toJSON()),b}}let d1=new aX,d2=new at,d3=new at;class d4{constructor(a){this.camera=a,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new _(512,512),this.map=null,this.mapPass=null,this.matrix=new aX,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new cp,this._frameExtents=new _(1,1),this._viewportCount=1,this._viewports=[new ar(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(a){let b=this.camera,c=this.matrix;d2.setFromMatrixPosition(a.matrixWorld),b.position.copy(d2),d3.setFromMatrixPosition(a.target.matrixWorld),b.lookAt(d3),b.updateMatrixWorld(),d1.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse),this._frustum.setFromProjectionMatrix(d1),c.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),c.multiply(d1)}getViewport(a){return this._viewports[a]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(a){return this.camera=a.camera.clone(),this.bias=a.bias,this.radius=a.radius,this.mapSize.copy(a.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let a={};return 0!==this.bias&&(a.bias=this.bias),0!==this.normalBias&&(a.normalBias=this.normalBias),1!==this.radius&&(a.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(a.mapSize=this.mapSize.toArray()),a.camera=this.camera.toJSON(!1).object,delete a.camera.matrix,a}}class d5 extends d4{constructor(){super(new ci(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(a){let b=this.camera,c=2*V*a.angle*this.focus,d=this.mapSize.width/this.mapSize.height,e=a.distance||b.far;(c!==b.fov||d!==b.aspect||e!==b.far)&&(b.fov=c,b.aspect=d,b.far=e,b.updateProjectionMatrix()),super.updateMatrices(a)}copy(a){return super.copy(a),this.focus=a.focus,this}}class d6 extends d0{constructor(a,b,c=0,d=Math.PI/3,e=0,f=2){super(a,b),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(bm.DEFAULT_UP),this.updateMatrix(),this.target=new bm,this.distance=c,this.angle=d,this.penumbra=e,this.decay=f,this.map=null,this.shadow=new d5}get power(){return this.intensity*Math.PI}set power(a){this.intensity=a/Math.PI}dispose(){this.shadow.dispose()}copy(a,b){return super.copy(a,b),this.distance=a.distance,this.angle=a.angle,this.penumbra=a.penumbra,this.decay=a.decay,this.target=a.target.clone(),this.shadow=a.shadow.clone(),this}}let d7=new aX,d8=new at,d9=new at;class ea extends d4{constructor(){super(new ci(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new _(4,2),this._viewportCount=6,this._viewports=[new ar(2,1,1,1),new ar(0,1,1,1),new ar(3,1,1,1),new ar(1,1,1,1),new ar(3,0,1,1),new ar(1,0,1,1)],this._cubeDirections=[new at(1,0,0),new at(-1,0,0),new at(0,0,1),new at(0,0,-1),new at(0,1,0),new at(0,-1,0)],this._cubeUps=[new at(0,1,0),new at(0,1,0),new at(0,1,0),new at(0,1,0),new at(0,0,1),new at(0,0,-1)]}updateMatrices(a,b=0){let c=this.camera,d=this.matrix,e=a.distance||c.far;e!==c.far&&(c.far=e,c.updateProjectionMatrix()),d8.setFromMatrixPosition(a.matrixWorld),c.position.copy(d8),d9.copy(c.position),d9.add(this._cubeDirections[b]),c.up.copy(this._cubeUps[b]),c.lookAt(d9),c.updateMatrixWorld(),d.makeTranslation(-d8.x,-d8.y,-d8.z),d7.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse),this._frustum.setFromProjectionMatrix(d7)}}class eb extends d0{constructor(a,b,c=0,d=2){super(a,b),this.isPointLight=!0,this.type="PointLight",this.distance=c,this.decay=d,this.shadow=new ea}get power(){return 4*this.intensity*Math.PI}set power(a){this.intensity=a/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(a,b){return super.copy(a,b),this.distance=a.distance,this.decay=a.decay,this.shadow=a.shadow.clone(),this}}class ec extends d4{constructor(){super(new ct(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class ed extends d0{constructor(a,b){super(a,b),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(bm.DEFAULT_UP),this.updateMatrix(),this.target=new bm,this.shadow=new ec}dispose(){this.shadow.dispose()}copy(a){return super.copy(a),this.target=a.target.clone(),this.shadow=a.shadow.clone(),this}}class ee extends d0{constructor(a,b){super(a,b),this.isAmbientLight=!0,this.type="AmbientLight"}}class ef{static decodeText(a){if("undefined"!=typeof TextDecoder)return new TextDecoder().decode(a);let b="";for(let c=0,d=a.length;c<d;c++)b+=String.fromCharCode(a[c]);try{return decodeURIComponent(escape(b))}catch(a){return b}}static extractUrlBase(a){let b=a.lastIndexOf("/");return -1===b?"./":a.slice(0,b+1)}static resolveURL(a,b){return"string"!=typeof a||""===a?"":(/^https?:\/\//i.test(b)&&/^\//.test(a)&&(b=b.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(a)||/^data:.*,.*$/i.test(a)||/^blob:.*$/i.test(a))?a:b+a}}let eg="\\[\\]\\.:\\/",eh=RegExp("["+eg+"]","g"),ei="[^"+eg+"]",ej="[^"+eg.replace("\\.","")+"]",ek=/((?:WC+[\/:])*)/.source.replace("WC",ei),el=/(WCOD+)?/.source.replace("WCOD",ej),em=RegExp("^"+ek+el+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",ei)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",ei)+"$"),en=["material","materials","bones","map"];class eo{constructor(a,b,c){let d=c||ep.parseTrackName(b);this._targetGroup=a,this._bindings=a.subscribe_(b,d)}getValue(a,b){this.bind();let c=this._targetGroup.nCachedObjects_,d=this._bindings[c];void 0!==d&&d.getValue(a,b)}setValue(a,b){let c=this._bindings;for(let d=this._targetGroup.nCachedObjects_,e=c.length;d!==e;++d)c[d].setValue(a,b)}bind(){let a=this._bindings;for(let b=this._targetGroup.nCachedObjects_,c=a.length;b!==c;++b)a[b].bind()}unbind(){let a=this._bindings;for(let b=this._targetGroup.nCachedObjects_,c=a.length;b!==c;++b)a[b].unbind()}}class ep{constructor(a,b,c){this.path=b,this.parsedPath=c||ep.parseTrackName(b),this.node=ep.findNode(a,this.parsedPath.nodeName),this.rootNode=a,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(a,b,c){return a&&a.isAnimationObjectGroup?new ep.Composite(a,b,c):new ep(a,b,c)}static sanitizeNodeName(a){return a.replace(/\s/g,"_").replace(eh,"")}static parseTrackName(a){let b=em.exec(a);if(null===b)throw Error("PropertyBinding: Cannot parse trackName: "+a);let c={nodeName:b[2],objectName:b[3],objectIndex:b[4],propertyName:b[5],propertyIndex:b[6]},d=c.nodeName&&c.nodeName.lastIndexOf(".");if(void 0!==d&&-1!==d){let a=c.nodeName.substring(d+1);-1!==en.indexOf(a)&&(c.nodeName=c.nodeName.substring(0,d),c.objectName=a)}if(null===c.propertyName||0===c.propertyName.length)throw Error("PropertyBinding: can not parse propertyName from trackName: "+a);return c}static findNode(a,b){if(void 0===b||""===b||"."===b||-1===b||b===a.name||b===a.uuid)return a;if(a.skeleton){let c=a.skeleton.getBoneByName(b);if(void 0!==c)return c}if(a.children){let c=function(a){for(let d=0;d<a.length;d++){let e=a[d];if(e.name===b||e.uuid===b)return e;let f=c(e.children);if(f)return f}return null},d=c(a.children);if(d)return d}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(a,b){a[b]=this.targetObject[this.propertyName]}_getValue_array(a,b){let c=this.resolvedProperty;for(let d=0,e=c.length;d!==e;++d)a[b++]=c[d]}_getValue_arrayElement(a,b){a[b]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(a,b){this.resolvedProperty.toArray(a,b)}_setValue_direct(a,b){this.targetObject[this.propertyName]=a[b]}_setValue_direct_setNeedsUpdate(a,b){this.targetObject[this.propertyName]=a[b],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(a,b){this.targetObject[this.propertyName]=a[b],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(a,b){let c=this.resolvedProperty;for(let d=0,e=c.length;d!==e;++d)c[d]=a[b++]}_setValue_array_setNeedsUpdate(a,b){let c=this.resolvedProperty;for(let d=0,e=c.length;d!==e;++d)c[d]=a[b++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(a,b){let c=this.resolvedProperty;for(let d=0,e=c.length;d!==e;++d)c[d]=a[b++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(a,b){this.resolvedProperty[this.propertyIndex]=a[b]}_setValue_arrayElement_setNeedsUpdate(a,b){this.resolvedProperty[this.propertyIndex]=a[b],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(a,b){this.resolvedProperty[this.propertyIndex]=a[b],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(a,b){this.resolvedProperty.fromArray(a,b)}_setValue_fromArray_setNeedsUpdate(a,b){this.resolvedProperty.fromArray(a,b),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(a,b){this.resolvedProperty.fromArray(a,b),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(a,b){this.bind(),this.getValue(a,b)}_setValue_unbound(a,b){this.bind(),this.setValue(a,b)}bind(){let a=this.node,b=this.parsedPath,c=b.objectName,d=b.propertyName,e=b.propertyIndex;if(a||(a=ep.findNode(this.rootNode,b.nodeName),this.node=a),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!a)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(c){let d=b.objectIndex;switch(c){case"materials":if(!a.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!a.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);a=a.material.materials;break;case"bones":if(!a.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);a=a.skeleton.bones;for(let b=0;b<a.length;b++)if(a[b].name===d){d=b;break}break;case"map":if("map"in a){a=a.map;break}if(!a.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!a.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);a=a.material.map;break;default:if(void 0===a[c])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);a=a[c]}if(void 0!==d){if(void 0===a[d])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,a);a=a[d]}}let f=a[d];if(void 0===f)return void console.error("THREE.PropertyBinding: Trying to update property for track: "+b.nodeName+"."+d+" but it wasn't found.",a);let g=this.Versioning.None;this.targetObject=a,void 0!==a.needsUpdate?g=this.Versioning.NeedsUpdate:void 0!==a.matrixWorldNeedsUpdate&&(g=this.Versioning.MatrixWorldNeedsUpdate);let h=this.BindingType.Direct;if(void 0!==e){if("morphTargetInfluences"===d){if(!a.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!a.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==a.morphTargetDictionary[e]&&(e=a.morphTargetDictionary[e])}h=this.BindingType.ArrayElement,this.resolvedProperty=f,this.propertyIndex=e}else void 0!==f.fromArray&&void 0!==f.toArray?(h=this.BindingType.HasFromToArray,this.resolvedProperty=f):Array.isArray(f)?(h=this.BindingType.EntireArray,this.resolvedProperty=f):this.propertyName=d;this.getValue=this.GetterByBindingType[h],this.setValue=this.SetterByBindingTypeAndVersioning[h][g]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}ep.Composite=eo,ep.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},ep.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},ep.prototype.GetterByBindingType=[ep.prototype._getValue_direct,ep.prototype._getValue_array,ep.prototype._getValue_arrayElement,ep.prototype._getValue_toArray],ep.prototype.SetterByBindingTypeAndVersioning=[[ep.prototype._setValue_direct,ep.prototype._setValue_direct_setNeedsUpdate,ep.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ep.prototype._setValue_array,ep.prototype._setValue_array_setNeedsUpdate,ep.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ep.prototype._setValue_arrayElement,ep.prototype._setValue_arrayElement_setNeedsUpdate,ep.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ep.prototype._setValue_fromArray,ep.prototype._setValue_fromArray_setNeedsUpdate,ep.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],new Float32Array(1),"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"164"}}));class eq extends d${constructor(a){super(a)}parse(a){if(a.length<19)throw Error("THREE.TGALoader: Not enough data to contain header.");let b=0,c=new Uint8Array(a),d={id_length:c[b++],colormap_type:c[b++],image_type:c[b++],colormap_index:c[b++]|c[b++]<<8,colormap_length:c[b++]|c[b++]<<8,colormap_size:c[b++],origin:[c[b++]|c[b++]<<8,c[b++]|c[b++]<<8],width:c[b++]|c[b++]<<8,height:c[b++]|c[b++]<<8,pixel_size:c[b++],flags:c[b++]};switch(d.image_type){case 1:case 9:if(d.colormap_length>256||24!==d.colormap_size||1!==d.colormap_type)throw Error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case 2:case 3:case 10:case 11:if(d.colormap_type)throw Error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case 0:throw Error("THREE.TGALoader: No data.");default:throw Error("THREE.TGALoader: Invalid type "+d.image_type)}if(d.width<=0||d.height<=0)throw Error("THREE.TGALoader: Invalid image size.");if(8!==d.pixel_size&&16!==d.pixel_size&&24!==d.pixel_size&&32!==d.pixel_size)throw Error("THREE.TGALoader: Invalid pixel size "+d.pixel_size);if(d.id_length+b>a.length)throw Error("THREE.TGALoader: No data.");b+=d.id_length;let e=!1,f=!1,g=!1;switch(d.image_type){case 9:e=!0,f=!0;break;case 1:f=!0;break;case 10:e=!0;break;case 2:break;case 11:e=!0,g=!0;break;case 3:g=!0}let h=new Uint8Array(d.width*d.height*4),i=function(a,b,c,d,e){let f,g,h=c.pixel_size>>3,i=c.width*c.height*h;if(b&&(g=e.subarray(d,d+=c.colormap_length*(c.colormap_size>>3))),a){let a,b,c;f=new Uint8Array(i);let g=0,j=new Uint8Array(h);for(;g<i;)if(b=(127&(a=e[d++]))+1,128&a){for(c=0;c<h;++c)j[c]=e[d++];for(c=0;c<b;++c)f.set(j,g+c*h);g+=h*b}else{for(b*=h,c=0;c<b;++c)f[g+c]=e[d++];g+=b}}else f=e.subarray(d,d+=b?c.width*c.height:i);return{pixel_data:f,palettes:g}}(e,f,d,b,c);return!function(a,b,c,e,f){let h,i,j,k,l,m;switch((48&d.flags)>>4){default:case 2:h=0,j=1,l=b,i=0,k=1,m=c;break;case 0:h=0,j=1,l=b,i=c-1,k=-1,m=-1;break;case 3:h=b-1,j=-1,l=-1,i=0,k=1,m=c;break;case 1:h=b-1,j=-1,l=-1,i=c-1,k=-1,m=-1}if(g)switch(d.pixel_size){case 8:!function(a,b,c,e,f,g,h,i){let j,k=0,l,m,n=d.width;for(m=b;m!==e;m+=c)for(l=f;l!==h;l+=g,k++)j=i[k],a[(l+n*m)*4+0]=j,a[(l+n*m)*4+1]=j,a[(l+n*m)*4+2]=j,a[(l+n*m)*4+3]=255}(a,i,k,m,h,j,l,e);break;case 16:var n=a,o=i,p=k,q=m,r=h,s=j,t=l,u=e;let v=0,w,x,y=d.width;for(x=o;x!==q;x+=p)for(w=r;w!==t;w+=s,v+=2)n[(w+y*x)*4+0]=u[v+0],n[(w+y*x)*4+1]=u[v+0],n[(w+y*x)*4+2]=u[v+0],n[(w+y*x)*4+3]=u[v+1];break;default:throw Error("THREE.TGALoader: Format not supported.")}else switch(d.pixel_size){case 8:!function(a,b,c,e,f,g,h,i,j){let k,l=0,m,n,o=d.width;for(n=b;n!==e;n+=c)for(m=f;m!==h;m+=g,l++)k=i[l],a[(m+o*n)*4+3]=255,a[(m+o*n)*4+2]=j[3*k+0],a[(m+o*n)*4+1]=j[3*k+1],a[(m+o*n)*4+0]=j[3*k+2]}(a,i,k,m,h,j,l,e,f);break;case 16:!function(a,b,c,e,f,g,h,i){let j,k=0,l,m,n=d.width;for(m=b;m!==e;m+=c)for(l=f;l!==h;l+=g,k+=2)j=i[k+0]+(i[k+1]<<8),a[(l+n*m)*4+0]=(31744&j)>>7,a[(l+n*m)*4+1]=(992&j)>>2,a[(l+n*m)*4+2]=(31&j)<<3,a[(l+n*m)*4+3]=32768&j?0:255}(a,i,k,m,h,j,l,e);break;case 24:var z=a,A=i,B=k,C=m,D=h,E=j,F=l,G=e;let H=0,I,J,K=d.width;for(J=A;J!==C;J+=B)for(I=D;I!==F;I+=E,H+=3)z[(I+K*J)*4+3]=255,z[(I+K*J)*4+2]=G[H+0],z[(I+K*J)*4+1]=G[H+1],z[(I+K*J)*4+0]=G[H+2];break;case 32:var L=a,M=i,N=k,O=m,P=h,Q=j,R=l,S=e;let T=0,U,V,W=d.width;for(V=M;V!==O;V+=N)for(U=P;U!==R;U+=Q,T+=4)L[(U+W*V)*4+2]=S[T+0],L[(U+W*V)*4+1]=S[T+1],L[(U+W*V)*4+0]=S[T+2],L[(U+W*V)*4+3]=S[T+3];break;default:throw Error("THREE.TGALoader: Format not supported.")}}(h,d.width,d.height,i.pixel_data,i.palettes),{data:h,width:d.width,height:d.height,flipY:!0,generateMipmaps:!0,minFilter:1008}}}class er extends dV{load(a,b,c,d){let e=this,f=""===e.path?ef.extractUrlBase(a):e.path,g=new dY(e.manager);g.setPath(e.path),g.setRequestHeader(e.requestHeader),g.setWithCredentials(e.withCredentials),g.load(a,function(c){try{b(e.parse(c,f))}catch(b){d?d(b):console.error(b),e.manager.itemError(a)}},c,d)}parse(a,b){var c,d,e,f;let g;function h(a,b){let c=[],d=a.childNodes;for(let a=0,e=d.length;a<e;a++){let e=d[a];e.nodeName===b&&c.push(e)}return c}function i(a){if(0===a.length)return[];let b=a.trim().split(/\s+/),c=Array(b.length);for(let a=0,d=b.length;a<d;a++)c[a]=parseFloat(b[a]);return c}function j(a){if(0===a.length)return[];let b=a.trim().split(/\s+/),c=Array(b.length);for(let a=0,d=b.length;a<d;a++)c[a]=parseInt(b[a]);return c}function k(a){return a.substring(1)}function l(a){return 0===Object.keys(a).length}function m(a,b,c,d){let e=h(a,b)[0];if(void 0!==e){let a=h(e,c);for(let b=0;b<a.length;b++)d(a[b])}}function n(a,b){for(let c in a)a[c].build=b(a[c])}function o(a,b){return void 0!==a.build||(a.build=b(a)),a.build}function p(a){let b=[],c=a.channels,d=a.samplers,e=a.sources;for(let a in c)if(c.hasOwnProperty(a)){let f=c[a],g=d[f.sampler],h=g.inputs.INPUT,i=g.inputs.OUTPUT;!function(a,b){let c=a.keyframes,d=a.name,e=[],f=[],g=[],h=[];for(let a=0,b=c.length;a<b;a++){let b=c[a],d=b.time,i=b.value;O.fromArray(i).transpose(),O.decompose(r,t,s),e.push(d),f.push(r.x,r.y,r.z),g.push(t.x,t.y,t.z,t.w),h.push(s.x,s.y,s.z)}f.length>0&&b.push(new dQ(d+".position",e,f)),g.length>0&&b.push(new dO(d+".quaternion",e,g)),h.length>0&&b.push(new dQ(d+".scale",e,h))}(function(a,b,c){let d,e,f,g,h,i,j=aj.nodes[a.id],k=X(j.id),l=j.transforms[a.sid],m=j.matrix.clone().transpose(),n={};switch(l){case"matrix":for(f=0,g=b.array.length;f<g;f++)if(d=b.array[f],e=f*c.stride,void 0===n[d]&&(n[d]={}),!0===a.arraySyntax){let b=c.array[e],f=a.indices[0]+4*a.indices[1];n[d][f]=b}else for(h=0,i=c.stride;h<i;h++)n[d][h]=c.array[e+h];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',l)}let o=function(a,b){let c=[];for(let b in a)c.push({time:parseFloat(b),value:a[b]});c.sort(function(a,b){return a.time-b.time});for(let a=0;a<16;a++)!function(a,b,c){let d,e,f,g=!0;for(e=0,f=a.length;e<f;e++)void 0===(d=a[e]).value[b]?d.value[b]=null:g=!1;if(!0===g)for(e=0,f=a.length;e<f;e++)(d=a[e]).value[b]=c;else!function(a,b){let c,d;for(let e=0,f=a.length;e<f;e++){let f=a[e];if(null===f.value[b]){if(c=function(a,b,c){for(;b>=0;){let d=a[b];if(null!==d.value[c])return d;b--}return null}(a,e,b),d=function(a,b,c){for(;b<a.length;){let d=a[b];if(null!==d.value[c])return d;b++}return null}(a,e,b),null===c){f.value[b]=d.value[b];continue}if(null===d){f.value[b]=c.value[b];continue}!function(a,b,c,d){if(c.time-b.time==0){a.value[d]=b.value[d];return}a.value[d]=(a.time-b.time)*(c.value[d]-b.value[d])/(c.time-b.time)+b.value[d]}(f,c,d,b)}}}(a,b)}(c,a,b.elements[a]);return c}(n,m);return{name:k.uuid,keyframes:o}}(f,e[h],e[i]),b)}return b}function q(a){return o(aj.animations[a],p)}let r=new at,s=new at,t=new as;function u(a){let b=[],c=a.name,d=a.end-a.start||-1,e=a.animations;for(let a=0,c=e.length;a<c;a++){let c=q(e[a]);for(let a=0,d=c.length;a<d;a++)b.push(c[a])}return new dR(c,d,b)}function v(a){let b={id:a.id},c=aj.geometries[b.id];return void 0!==a.skin&&(b.skin=function(a){let b,c,d,e={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},f=a.sources,g=a.vertexWeights,h=g.vcount,i=g.v,j=g.inputs.JOINT.offset,k=g.inputs.WEIGHT.offset,l=a.sources[a.joints.inputs.JOINT],m=a.sources[a.joints.inputs.INV_BIND_MATRIX],n=f[g.inputs.WEIGHT.id].array,o=0;for(b=0,d=h.length;b<d;b++){let a=h[b],d=[];for(c=0;c<a;c++){let a=i[o+j],b=n[i[o+k]];d.push({index:a,weight:b}),o+=2}for(d.sort(p),c=0;c<4;c++){let a=d[c];void 0!==a?(e.indices.array.push(a.index),e.weights.array.push(a.weight)):(e.indices.array.push(0),e.weights.array.push(0))}}for(a.bindShapeMatrix?e.bindMatrix=new aX().fromArray(a.bindShapeMatrix).transpose():e.bindMatrix=new aX().identity(),b=0,d=l.array.length;b<d;b++){let a=l.array[b],c=new aX().fromArray(m.array,b*m.stride).transpose();e.joints.push({name:a,boneInverse:c})}return e;function p(a,b){return b.weight-a.weight}}(a.skin),c.sources.skinIndices=b.skin.indices,c.sources.skinWeights=b.skin.weights),b}function w(a){return void 0!==a.build?a.build:a.init_from}function x(a){let b=aj.images[a];return void 0!==b?o(b,w):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",a),null)}function y(a){let b={};for(let c=0,d=a.childNodes.length;c<d;c++){let d=a.childNodes[c];if(1===d.nodeType)switch(d.nodeName){case"color":b[d.nodeName]=i(d.textContent);break;case"float":b[d.nodeName]=parseFloat(d.textContent);break;case"texture":b[d.nodeName]={id:d.getAttribute("texture"),extra:z(d)}}}return b}function z(a){let b={technique:{}};for(let c=0,d=a.childNodes.length;c<d;c++){let d=a.childNodes[c];1===d.nodeType&&"extra"===d.nodeName&&function(a,b){for(let c=0,d=a.childNodes.length;c<d;c++){let d=a.childNodes[c];1===d.nodeType&&"technique"===d.nodeName&&function(a,b){for(let c=0,d=a.childNodes.length;c<d;c++){let d=a.childNodes[c];if(1===d.nodeType)switch(d.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":b.technique[d.nodeName]=parseFloat(d.textContent);break;case"wrapU":case"wrapV":"TRUE"===d.textContent.toUpperCase()?b.technique[d.nodeName]=1:"FALSE"===d.textContent.toUpperCase()?b.technique[d.nodeName]=0:b.technique[d.nodeName]=parseInt(d.textContent);break;case"bump":b[d.nodeName]=B(d)}}}(d,b)}}(d,b)}return b}function A(a){let b={};for(let c=0,d=a.childNodes.length;c<d;c++){let d=a.childNodes[c];1===d.nodeType&&"technique"===d.nodeName&&(b.technique=function(a){let b={};for(let c=0,d=a.childNodes.length;c<d;c++){let d=a.childNodes[c];if(1===d.nodeType)switch(d.nodeName){case"double_sided":b[d.nodeName]=parseInt(d.textContent);break;case"bump":b[d.nodeName]=B(d)}}return b}(d))}return b}function B(a){let b={};for(let c=0,d=a.childNodes.length;c<d;c++){let d=a.childNodes[c];1===d.nodeType&&"texture"===d.nodeName&&(b[d.nodeName]={id:d.getAttribute("texture"),texcoord:d.getAttribute("texcoord"),extra:z(d)})}return b}function C(a){return a}function D(a){var b;let c,d=(b=a.url,o(aj.effects[b],C)),e=d.profile.technique;switch(e.type){case"phong":case"blinn":c=new dA;break;case"lambert":c=new dB;break;default:c=new bG}function f(a,b=null){let c=d.profile.samplers[a.id],e=null;if(void 0!==c?e=x(d.profile.surfaces[c.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),e=x(a.id)),null===e)return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",a.id),null;{var h;let c="tga"===(h=e).slice((h.lastIndexOf(".")-1>>>0)+2).toLowerCase()?g:ae;if(void 0===c)return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",e),null;{let d=c.load(e),f=a.extra;if(void 0!==f&&void 0!==f.technique&&!1===l(f.technique)){let a=f.technique;d.wrapS=a.wrapU?1e3:1001,d.wrapT=a.wrapV?1e3:1001,d.offset.set(a.offsetU||0,a.offsetV||0),d.repeat.set(a.repeatU||1,a.repeatV||1)}else d.wrapS=1e3,d.wrapT=1e3;return null!==b&&(d.colorSpace=b),d}}}c.name=a.name||"";let h=e.parameters;for(let a in h){let b=h[a];switch(a){case"diffuse":b.color&&c.color.fromArray(b.color),b.texture&&(c.map=f(b.texture,M));break;case"specular":b.color&&c.specular&&c.specular.fromArray(b.color),b.texture&&(c.specularMap=f(b.texture));break;case"bump":b.texture&&(c.normalMap=f(b.texture));break;case"ambient":b.texture&&(c.lightMap=f(b.texture,M));break;case"shininess":b.float&&c.shininess&&(c.shininess=b.float);break;case"emission":b.color&&c.emissive&&c.emissive.fromArray(b.color),b.texture&&(c.emissiveMap=f(b.texture,M))}}c.color.convertSRGBToLinear(),c.specular&&c.specular.convertSRGBToLinear(),c.emissive&&c.emissive.convertSRGBToLinear();let i=h.transparent,j=h.transparency;if(void 0===j&&i&&(j={float:1}),void 0===i&&j&&(i={opaque:"A_ONE",data:{color:[1,1,1,1]}}),i&&j)if(i.data.texture)c.transparent=!0;else{let a=i.data.color;switch(i.opaque){case"A_ONE":c.opacity=a[3]*j.float;break;case"RGB_ZERO":c.opacity=1-a[0]*j.float;break;case"A_ZERO":c.opacity=1-a[3]*j.float;break;case"RGB_ONE":c.opacity=a[0]*j.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',i.opaque)}c.opacity<1&&(c.transparent=!0)}if(void 0!==e.extra&&void 0!==e.extra.technique){let a=e.extra.technique;for(let b in a){let d=a[b];switch(b){case"double_sided":c.side=2*(1===d);break;case"bump":c.normalMap=f(d.texture),c.normalScale=new _(1,1)}}}return c}function E(a){let b;switch(a.optics.technique){case"perspective":b=new ci(a.optics.parameters.yfov,a.optics.parameters.aspect_ratio,a.optics.parameters.znear,a.optics.parameters.zfar);break;case"orthographic":let c=a.optics.parameters.ymag,d=a.optics.parameters.xmag,e=a.optics.parameters.aspect_ratio;d=void 0===d?c*e:d,c=void 0===c?d/e:c,d*=.5,c*=.5,b=new ct(-d,d,c,-c,a.optics.parameters.znear,a.optics.parameters.zfar);break;default:b=new ci}return b.name=a.name||"",b}function F(a){let b;switch(a.technique){case"directional":b=new ed;break;case"point":b=new eb;break;case"spot":b=new d6;break;case"ambient":b=new ee}return a.parameters.color&&b.color.copy(a.parameters.color),a.parameters.distance&&(b.distance=a.parameters.distance),b}function G(a){let b={array:[],stride:3};for(let c=0;c<a.childNodes.length;c++){let d=a.childNodes[c];if(1===d.nodeType)switch(d.nodeName){case"float_array":b.array=i(d.textContent);break;case"Name_array":b.array=function(a){if(0===a.length)return[];let b=a.trim().split(/\s+/),c=Array(b.length);for(let a=0,d=b.length;a<d;a++)c[a]=b[a];return c}(d.textContent);break;case"technique_common":let e=h(d,"accessor")[0];void 0!==e&&(b.stride=parseInt(e.getAttribute("stride")))}}return b}function H(a){let b={},c=a.sources,d=a.vertices,e=a.primitives;if(0===e.length)return{};let f=function(a){let b={};for(let c=0;c<a.length;c++){let d=a[c];void 0===b[d.type]&&(b[d.type]=[]),b[d.type].push(d)}return b}(e);for(let a in f){let e=f[a];!function(a){let b=0;for(let c=0,d=a.length;c<d;c++)!0===a[c].hasUV&&b++;b>0&&b<a.length&&(a.uvsNeedsFix=!0)}(e),b[a]=function(a,b,c){let d={},e={array:[],stride:0},f={array:[],stride:0},g={array:[],stride:0},h={array:[],stride:0},i={array:[],stride:0},j=[],k=[],l=new bU,m=[],n=0;for(let d=0;d<a.length;d++){let o=a[d],p=o.inputs,q=0;switch(o.type){case"lines":case"linestrips":q=2*o.count;break;case"triangles":q=3*o.count;break;case"polylist":for(let a=0;a<o.count;a++){let b=o.vcount[a];switch(b){case 3:q+=3;break;case 4:q+=6;break;default:q+=(b-2)*3}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",o.type)}for(let r in l.addGroup(n,q,d),n+=q,o.material&&m.push(o.material),p){let d=p[r];switch(r){case"VERTEX":for(let l in c){let m=c[l];switch(l){case"POSITION":let n=e.array.length;if(I(o,b[m],d.offset,e.array),e.stride=b[m].stride,b.skinWeights&&b.skinIndices&&(I(o,b.skinIndices,d.offset,j),I(o,b.skinWeights,d.offset,k)),!1===o.hasUV&&!0===a.uvsNeedsFix){let a=(e.array.length-n)/e.stride;for(let b=0;b<a;b++)g.array.push(0,0)}break;case"NORMAL":I(o,b[m],d.offset,f.array),f.stride=b[m].stride;break;case"COLOR":I(o,b[m],d.offset,i.array),i.stride=b[m].stride;break;case"TEXCOORD":I(o,b[m],d.offset,g.array),g.stride=b[m].stride;break;case"TEXCOORD1":I(o,b[m],d.offset,h.array),g.stride=b[m].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',l)}}break;case"NORMAL":I(o,b[d.id],d.offset,f.array),f.stride=b[d.id].stride;break;case"COLOR":I(o,b[d.id],d.offset,i.array,!0),i.stride=b[d.id].stride;break;case"TEXCOORD":I(o,b[d.id],d.offset,g.array),g.stride=b[d.id].stride;break;case"TEXCOORD1":I(o,b[d.id],d.offset,h.array),h.stride=b[d.id].stride}}}return e.array.length>0&&l.setAttribute("position",new bM(e.array,e.stride)),f.array.length>0&&l.setAttribute("normal",new bM(f.array,f.stride)),i.array.length>0&&l.setAttribute("color",new bM(i.array,i.stride)),g.array.length>0&&l.setAttribute("uv",new bM(g.array,g.stride)),h.array.length>0&&l.setAttribute("uv1",new bM(h.array,h.stride)),j.length>0&&l.setAttribute("skinIndex",new bM(j,4)),k.length>0&&l.setAttribute("skinWeight",new bM(k,4)),d.data=l,d.type=a[0].type,d.materialKeys=m,d}(e,c,d)}return b}function I(a,b,c,d,e=!1){let f=a.p,g=a.stride,h=a.vcount;function i(a){let b=f[a+c]*k,g=b+k;for(;b<g;b++)d.push(j[b]);if(e){let a=d.length-k-1;af.setRGB(d[a+0],d[a+1],d[a+2]).convertSRGBToLinear(),d[a+0]=af.r,d[a+1]=af.g,d[a+2]=af.b}}let j=b.array,k=b.stride;if(void 0!==a.vcount){let a=0;for(let b=0,c=h.length;b<c;b++){let c=h[b];if(4===c){let b=a+0*g,c=a+ +g,d=a+2*g,e=a+3*g;i(b),i(c),i(e),i(c),i(d),i(e)}else if(3===c){let b=a+0*g,c=a+ +g,d=a+2*g;i(b),i(c),i(d)}else if(c>4)for(let b=1,d=c-2;b<=d;b++){let c=a+0*g,d=a+g*b,e=a+g*(b+1);i(c),i(d),i(e)}a+=g*c}}else for(let a=0,b=f.length;a<b;a+=g)i(a)}function J(a){return o(aj.geometries[a],H)}function K(a){return void 0!==a.build?a.build:a}function L(a){let b={type:a.nodeName},c=i(a.textContent);switch(b.type){case"matrix":b.obj=new aX,b.obj.fromArray(c).transpose();break;case"translate":b.obj=new at,b.obj.fromArray(c);break;case"rotate":b.obj=new at,b.obj.fromArray(c),b.angle=$.degToRad(c[3])}return b}function N(a){return void 0!==a.build?a.build:a}let O=new aX,P=new at;function Q(a){let b={name:a.getAttribute("name")||"",type:a.getAttribute("type"),id:a.getAttribute("id"),sid:a.getAttribute("sid"),matrix:new aX,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}};for(let c=0;c<a.childNodes.length;c++){let d,e=a.childNodes[c];if(1===e.nodeType)switch(e.nodeName){case"node":b.nodes.push(e.getAttribute("id")),Q(e);break;case"instance_camera":b.instanceCameras.push(k(e.getAttribute("url")));break;case"instance_controller":b.instanceControllers.push(R(e));break;case"instance_light":b.instanceLights.push(k(e.getAttribute("url")));break;case"instance_geometry":b.instanceGeometries.push(R(e));break;case"instance_node":b.instanceNodes.push(k(e.getAttribute("url")));break;case"matrix":d=i(e.textContent),b.matrix.multiply(O.fromArray(d).transpose()),b.transforms[e.getAttribute("sid")]=e.nodeName;break;case"translate":d=i(e.textContent),P.fromArray(d),b.matrix.multiply(O.makeTranslation(P.x,P.y,P.z)),b.transforms[e.getAttribute("sid")]=e.nodeName;break;case"rotate":d=i(e.textContent);let f=$.degToRad(d[3]);b.matrix.multiply(O.makeRotationAxis(P.fromArray(d),f)),b.transforms[e.getAttribute("sid")]=e.nodeName;break;case"scale":d=i(e.textContent),b.matrix.scale(P.fromArray(d)),b.transforms[e.getAttribute("sid")]=e.nodeName;break;case"extra":break;default:console.log(e)}}return W(b.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",b.id):aj.nodes[b.id]=b,b}function R(a){let b={id:k(a.getAttribute("url")),materials:{},skeletons:[]};for(let c=0;c<a.childNodes.length;c++){let d=a.childNodes[c];switch(d.nodeName){case"bind_material":let e=d.getElementsByTagName("instance_material");for(let a=0;a<e.length;a++){let c=e[a],d=c.getAttribute("symbol"),f=c.getAttribute("target");b.materials[d]=k(f)}break;case"skeleton":b.skeletons.push(k(d.textContent))}}return b}function S(a,b,c){a.traverse(function(a){if(!0===a.isBone){let d;for(let c=0;c<b.length;c++){let e=b[c];if(e.name===a.name){d=e.boneInverse;break}}void 0===d&&(d=new aX),c.push({bone:a,boneInverse:d,processed:!1})}})}function T(a){let b,c=[],d=a.matrix,e=a.nodes,f=a.type,g=a.instanceCameras,h=a.instanceControllers,i=a.instanceLights,j=a.instanceGeometries,k=a.instanceNodes;for(let a=0,b=e.length;a<b;a++)c.push(X(e[a]));for(let a=0,b=g.length;a<b;a++){let b=function(a){let b=aj.cameras[a];return void 0!==b?o(b,E):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",a),null)}(g[a]);null!==b&&c.push(b.clone())}for(let a=0,b=h.length;a<b;a++){var l;let b=h[a],d=(l=b.id,o(aj.controllers[l],v)),e=V(J(d.id),b.materials),f=function(a,b){let c,d,e,f=[],g=[];for(c=0;c<a.length;c++){let d=a[c];if(W(d))S(X(d),b,f);else{var h;if(h=d,void 0!==aj.visualScenes[h]){let a=aj.visualScenes[d].children;for(let c=0;c<a.length;c++){let d=a[c];"JOINT"===d.type&&S(X(d.id),b,f)}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",d)}}for(c=0;c<b.length;c++)for(d=0;d<f.length;d++)if((e=f[d]).bone.name===b[c].name){g[c]=e,e.processed=!0;break}for(c=0;c<f.length;c++)!1===(e=f[c]).processed&&(g.push(e),e.processed=!0);let i=[],j=[];for(c=0;c<g.length;c++)e=g[c],i.push(e.bone),j.push(e.boneInverse);return new cL(i,j)}(b.skeletons,d.skin.joints);for(let a=0,b=e.length;a<b;a++){let b=e[a];b.isSkinnedMesh&&(b.bind(f,d.skin.bindMatrix),b.normalizeSkinWeights()),c.push(b)}}for(let a=0,b=i.length;a<b;a++){let b=function(a){let b=aj.lights[a];return void 0!==b?o(b,F):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",a),null)}(i[a]);null!==b&&c.push(b.clone())}for(let a=0,b=j.length;a<b;a++){let b=j[a],d=V(J(b.id),b.materials);for(let a=0,b=d.length;a<b;a++)c.push(d[a])}for(let a=0,b=k.length;a<b;a++)c.push(X(k[a]).clone());if(0===e.length&&1===c.length)b=c[0];else{b="JOINT"===f?new cH:new cv;for(let a=0;a<c.length;a++)b.add(c[a])}return b.name="JOINT"===f?a.sid:a.name,b.matrix.copy(d),b.matrix.decompose(b.position,b.quaternion,b.scale),b}let U=new bG({name:dV.DEFAULT_MATERIAL_NAME,color:0xff00ff});function V(a,b){let c=[];for(let d in a){let e,f=a[d],g=function(a,b){let c=[];for(let d=0,e=a.length;d<e;d++){let e=b[a[d]];if(void 0===e)console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",a[d]),c.push(U);else c.push(o(aj.materials[e],D))}return c}(f.materialKeys,b);if(0===g.length&&("lines"===d||"linestrips"===d?g.push(new cM):g.push(new dA)),"lines"===d||"linestrips"===d)for(let a=0,b=g.length;a<b;a++){let b=g[a];if(!0===b.isMeshPhongMaterial||!0===b.isMeshLambertMaterial){let c=new cM;c.color.copy(b.color),c.opacity=b.opacity,c.transparent=b.transparent,g[a]=c}}let h=void 0!==f.data.attributes.skinIndex,i=1===g.length?g[0]:g;switch(d){case"lines":e=new cY(f.data,i);break;case"linestrips":e=new cU(f.data,i);break;case"triangles":case"polylist":e=h?new cG(f.data,i):new ca(f.data,i)}c.push(e)}return c}function W(a){return void 0!==aj.nodes[a]}function X(a){return o(aj.nodes[a],T)}function Y(a){let b=new cv;b.name=a.name;let c=a.children;for(let a=0;a<c.length;a++){let d=c[a];b.add(X(d.id))}return b}function Z(a){return o(aj.visualScenes[a],Y)}if(0===a.length)return{scene:new cw};let aa=new DOMParser().parseFromString(a,"application/xml"),ab=h(aa,"COLLADA")[0],ac=aa.getElementsByTagName("parsererror")[0];if(void 0!==ac){let a=h(ac,"div")[0];return console.error("THREE.ColladaLoader: Failed to parse collada file.\n",a?a.textContent:function(a){let b="",c=[a];for(;c.length;){let a=c.shift();a.nodeType===Node.TEXT_NODE?b+=a.textContent:(b+="\n",c.push.apply(c,a.childNodes))}return b.trim()}(ac)),null}console.debug("THREE.ColladaLoader: File version",ab.getAttribute("version"));let ad=(c=h(ab,"asset")[0],{unit:void 0!==(e=h(c,"unit")[0])&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1,upAxis:void 0!==(f=h(c,"up_axis")[0])?f.textContent:"Y_UP"}),ae=new d_(this.manager);ae.setPath(this.resourcePath||b).setCrossOrigin(this.crossOrigin),eq&&(g=new eq(this.manager)).setPath(this.resourcePath||b);let af=new bC,ag=[],ah={},ai=0,aj={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};m(ab,"library_animations","animation",function a(b){let c={sources:{},samplers:{},channels:{}},d=!1;for(let e=0,f=b.childNodes.length;e<f;e++){let f,g=b.childNodes[e];if(1===g.nodeType)switch(g.nodeName){case"source":f=g.getAttribute("id"),c.sources[f]=G(g);break;case"sampler":f=g.getAttribute("id"),c.samplers[f]=function(a){let b={inputs:{}};for(let c=0,d=a.childNodes.length;c<d;c++){let d=a.childNodes[c];if(1===d.nodeType&&"input"===d.nodeName){let a=k(d.getAttribute("source")),c=d.getAttribute("semantic");b.inputs[c]=a}}return b}(g);break;case"channel":f=g.getAttribute("target"),c.channels[f]=function(a){let b={},c=a.getAttribute("target").split("/"),d=c.shift(),e=c.shift(),f=-1!==e.indexOf("("),g=-1!==e.indexOf(".");if(g)e=(c=e.split(".")).shift(),b.member=c.shift();else if(f){let a=e.split("(");e=a.shift();for(let b=0;b<a.length;b++)a[b]=parseInt(a[b].replace(/\)/,""));b.indices=a}return b.id=d,b.sid=e,b.arraySyntax=f,b.memberSyntax=g,b.sampler=k(a.getAttribute("source")),b}(g);break;case"animation":a(g),d=!0;break;default:console.log(g)}}!1===d&&(aj.animations[b.getAttribute("id")||$.generateUUID()]=c)}),m(ab,"library_animation_clips","animation_clip",function(a){let b={name:a.getAttribute("id")||"default",start:parseFloat(a.getAttribute("start")||0),end:parseFloat(a.getAttribute("end")||0),animations:[]};for(let c=0,d=a.childNodes.length;c<d;c++){let d=a.childNodes[c];1===d.nodeType&&"instance_animation"===d.nodeName&&b.animations.push(k(d.getAttribute("url")))}aj.clips[a.getAttribute("id")]=b}),m(ab,"library_controllers","controller",function(a){let b={};for(let c=0,d=a.childNodes.length;c<d;c++){let d=a.childNodes[c];if(1===d.nodeType)switch(d.nodeName){case"skin":b.id=k(d.getAttribute("source")),b.skin=function(a){let b={sources:{}};for(let c=0,d=a.childNodes.length;c<d;c++){let d=a.childNodes[c];if(1===d.nodeType)switch(d.nodeName){case"bind_shape_matrix":b.bindShapeMatrix=i(d.textContent);break;case"source":let e=d.getAttribute("id");b.sources[e]=G(d);break;case"joints":b.joints=function(a){let b={inputs:{}};for(let c=0,d=a.childNodes.length;c<d;c++){let d=a.childNodes[c];if(1===d.nodeType&&"input"===d.nodeName){let a=d.getAttribute("semantic"),c=k(d.getAttribute("source"));b.inputs[a]=c}}return b}(d);break;case"vertex_weights":b.vertexWeights=function(a){let b={inputs:{}};for(let c=0,d=a.childNodes.length;c<d;c++){let d=a.childNodes[c];if(1===d.nodeType)switch(d.nodeName){case"input":let e=d.getAttribute("semantic"),f=k(d.getAttribute("source")),g=parseInt(d.getAttribute("offset"));b.inputs[e]={id:f,offset:g};break;case"vcount":b.vcount=j(d.textContent);break;case"v":b.v=j(d.textContent)}}return b}(d)}}return b}(d);break;case"morph":b.id=k(d.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}aj.controllers[a.getAttribute("id")]=b}),m(ab,"library_images","image",function(a){let b={init_from:h(a,"init_from")[0].textContent};aj.images[a.getAttribute("id")]=b}),m(ab,"library_effects","effect",function(a){let b={};for(let c=0,d=a.childNodes.length;c<d;c++){let d=a.childNodes[c];1===d.nodeType&&"profile_COMMON"===d.nodeName&&(b.profile=function(a){let b={surfaces:{},samplers:{}};for(let e=0,f=a.childNodes.length;e<f;e++){let f=a.childNodes[e];if(1===f.nodeType)switch(f.nodeName){case"newparam":var c=f,d=b;let g=c.getAttribute("sid");for(let a=0,b=c.childNodes.length;a<b;a++){let b=c.childNodes[a];if(1===b.nodeType)switch(b.nodeName){case"surface":d.surfaces[g]=function(a){let b={};for(let c=0,d=a.childNodes.length;c<d;c++){let d=a.childNodes[c];1===d.nodeType&&"init_from"===d.nodeName&&(b.init_from=d.textContent)}return b}(b);break;case"sampler2D":d.samplers[g]=function(a){let b={};for(let c=0,d=a.childNodes.length;c<d;c++){let d=a.childNodes[c];1===d.nodeType&&"source"===d.nodeName&&(b.source=d.textContent)}return b}(b)}}break;case"technique":b.technique=function(a){let b={};for(let c=0,d=a.childNodes.length;c<d;c++){let d=a.childNodes[c];if(1===d.nodeType)switch(d.nodeName){case"constant":case"lambert":case"blinn":case"phong":b.type=d.nodeName,b.parameters=function(a){let b={};for(let c=0,d=a.childNodes.length;c<d;c++){let d=a.childNodes[c];if(1===d.nodeType)switch(d.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":b[d.nodeName]=y(d);break;case"transparent":b[d.nodeName]={opaque:d.hasAttribute("opaque")?d.getAttribute("opaque"):"A_ONE",data:y(d)}}}return b}(d);break;case"extra":b.extra=A(d)}}return b}(f);break;case"extra":b.extra=A(f)}}return b}(d))}aj.effects[a.getAttribute("id")]=b}),m(ab,"library_materials","material",function(a){let b={name:a.getAttribute("name")};for(let c=0,d=a.childNodes.length;c<d;c++){let d=a.childNodes[c];1===d.nodeType&&"instance_effect"===d.nodeName&&(b.url=k(d.getAttribute("url")))}aj.materials[a.getAttribute("id")]=b}),m(ab,"library_cameras","camera",function(a){let b={name:a.getAttribute("name")};for(let c=0,d=a.childNodes.length;c<d;c++){let d=a.childNodes[c];1===d.nodeType&&"optics"===d.nodeName&&(b.optics=function(a){for(let c=0;c<a.childNodes.length;c++){let d=a.childNodes[c];if("technique_common"===d.nodeName){var b=d;let a={};for(let c=0;c<b.childNodes.length;c++){let d=b.childNodes[c];switch(d.nodeName){case"perspective":case"orthographic":a.technique=d.nodeName,a.parameters=function(a){let b={};for(let c=0;c<a.childNodes.length;c++){let d=a.childNodes[c];switch(d.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":b[d.nodeName]=parseFloat(d.textContent)}}return b}(d)}}return a}}return{}}(d))}aj.cameras[a.getAttribute("id")]=b}),m(ab,"library_lights","light",function(a){let b={};for(let c=0,d=a.childNodes.length;c<d;c++){let d=a.childNodes[c];1===d.nodeType&&"technique_common"===d.nodeName&&(b=function(a){let b={};for(let c=0,d=a.childNodes.length;c<d;c++){let d=a.childNodes[c];if(1===d.nodeType)switch(d.nodeName){case"directional":case"point":case"spot":case"ambient":b.technique=d.nodeName,b.parameters=function(a){let b={};for(let c=0,d=a.childNodes.length;c<d;c++){let d=a.childNodes[c];if(1===d.nodeType)switch(d.nodeName){case"color":let e=i(d.textContent);b.color=new bC().fromArray(e).convertSRGBToLinear();break;case"falloff_angle":b.falloffAngle=parseFloat(d.textContent);break;case"quadratic_attenuation":let f=parseFloat(d.textContent);b.distance=f?Math.sqrt(1/f):0}}return b}(d)}}return b}(d))}aj.lights[a.getAttribute("id")]=b}),m(ab,"library_geometries","geometry",function(a){let b={name:a.getAttribute("name"),sources:{},vertices:{},primitives:[]},c=h(a,"mesh")[0];if(void 0!==c){for(let a=0;a<c.childNodes.length;a++){let d=c.childNodes[a];if(1!==d.nodeType)continue;let e=d.getAttribute("id");switch(d.nodeName){case"source":b.sources[e]=G(d);break;case"vertices":b.vertices=function(a){let b={};for(let c=0;c<a.childNodes.length;c++){let d=a.childNodes[c];1===d.nodeType&&(b[d.getAttribute("semantic")]=k(d.getAttribute("source")))}return b}(d);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",d.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":b.primitives.push(function(a){let b={type:a.nodeName,material:a.getAttribute("material"),count:parseInt(a.getAttribute("count")),inputs:{},stride:0,hasUV:!1};for(let c=0,d=a.childNodes.length;c<d;c++){let d=a.childNodes[c];if(1===d.nodeType)switch(d.nodeName){case"input":let e=k(d.getAttribute("source")),f=d.getAttribute("semantic"),g=parseInt(d.getAttribute("offset")),h=parseInt(d.getAttribute("set")),i=h>0?f+h:f;b.inputs[i]={id:e,offset:g},b.stride=Math.max(b.stride,g+1),"TEXCOORD"===f&&(b.hasUV=!0);break;case"vcount":b.vcount=j(d.textContent);break;case"p":b.p=j(d.textContent)}}return b}(d));break;default:console.log(d)}}aj.geometries[a.getAttribute("id")]=b}}),m(ab,"library_nodes","node",Q),m(ab,"library_visual_scenes","visual_scene",function(a){let b={name:a.getAttribute("name"),children:[]},c=a.getElementsByTagName("node");for(let a=0;a<c.length;a++){let b=c[a];!1===b.hasAttribute("id")&&b.setAttribute("id","three_default_"+ai++)}let d=h(a,"node");for(let a=0;a<d.length;a++)b.children.push(Q(d[a]));aj.visualScenes[a.getAttribute("id")]=b}),m(ab,"library_kinematics_models","kinematics_model",function(a){let b={name:a.getAttribute("name")||"",joints:{},links:[]};for(let c=0;c<a.childNodes.length;c++){let d=a.childNodes[c];1===d.nodeType&&"technique_common"===d.nodeName&&function(a,b){for(let c=0;c<a.childNodes.length;c++){let d=a.childNodes[c];if(1===d.nodeType)switch(d.nodeName){case"joint":b.joints[d.getAttribute("sid")]=function(a){let b;for(let c=0;c<a.childNodes.length;c++){let d=a.childNodes[c];if(1===d.nodeType)switch(d.nodeName){case"prismatic":case"revolute":b=function(a){let b={sid:a.getAttribute("sid"),name:a.getAttribute("name")||"",axis:new at,limits:{min:0,max:0},type:a.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(let c=0;c<a.childNodes.length;c++){let d=a.childNodes[c];if(1===d.nodeType)switch(d.nodeName){case"axis":let e=i(d.textContent);b.axis.fromArray(e);break;case"limits":let f=d.getElementsByTagName("max")[0],g=d.getElementsByTagName("min")[0];b.limits.max=parseFloat(f.textContent),b.limits.min=parseFloat(g.textContent)}}return b.limits.min>=b.limits.max&&(b.static=!0),b.middlePosition=(b.limits.min+b.limits.max)/2,b}(d)}}return b}(d);break;case"link":b.links.push(function a(b){let c={sid:b.getAttribute("sid"),name:b.getAttribute("name")||"",attachments:[],transforms:[]};for(let d=0;d<b.childNodes.length;d++){let e=b.childNodes[d];if(1===e.nodeType)switch(e.nodeName){case"attachment_full":c.attachments.push(function(b){let c={joint:b.getAttribute("joint").split("/").pop(),transforms:[],links:[]};for(let d=0;d<b.childNodes.length;d++){let e=b.childNodes[d];if(1===e.nodeType)switch(e.nodeName){case"link":c.links.push(a(e));break;case"matrix":case"translate":case"rotate":c.transforms.push(L(e))}}return c}(e));break;case"matrix":case"translate":case"rotate":c.transforms.push(L(e))}}return c}(d))}}}(d,b)}aj.kinematicsModels[a.getAttribute("id")]=b}),m(ab,"library_physics_models","physics_model",function(a){let b={name:a.getAttribute("name")||"",rigidBodies:{}};for(let c=0;c<a.childNodes.length;c++){let d=a.childNodes[c];1===d.nodeType&&"rigid_body"===d.nodeName&&(b.rigidBodies[d.getAttribute("name")]={},function(a,b){for(let c=0;c<a.childNodes.length;c++){let d=a.childNodes[c];1===d.nodeType&&"technique_common"===d.nodeName&&function(a,b){for(let c=0;c<a.childNodes.length;c++){let d=a.childNodes[c];if(1===d.nodeType)switch(d.nodeName){case"inertia":b.inertia=i(d.textContent);break;case"mass":b.mass=i(d.textContent)[0]}}}(d,b)}}(d,b.rigidBodies[d.getAttribute("name")]))}aj.physicsModels[a.getAttribute("id")]=b}),m(ab,"scene","instance_kinematics_scene",function(a){let b={bindJointAxis:[]};for(let c=0;c<a.childNodes.length;c++){let d=a.childNodes[c];1===d.nodeType&&"bind_joint_axis"===d.nodeName&&b.bindJointAxis.push(function(a){let b={target:a.getAttribute("target").split("/").pop()};for(let c=0;c<a.childNodes.length;c++){let d=a.childNodes[c];if(1===d.nodeType&&"axis"===d.nodeName){b.axis=d.getElementsByTagName("param")[0].textContent;let a=b.axis.split("inst_").pop().split("axis")[0];b.jointIndex=a.substring(0,a.length-1)}}return b}(d))}aj.kinematicsScenes[k(a.getAttribute("url"))]=b}),n(aj.animations,p),n(aj.clips,u),n(aj.controllers,v),n(aj.images,w),n(aj.effects,C),n(aj.materials,D),n(aj.cameras,E),n(aj.lights,F),n(aj.geometries,H),n(aj.visualScenes,Y),function(){let a=aj.clips;if(!0===l(a)){if(!1===l(aj.animations)){let a=[];for(let b in aj.animations){let c=q(b);for(let b=0,d=c.length;b<d;b++)a.push(c[b])}ag.push(new dR("default",-1,a))}}else for(let b in a)ag.push(o(aj.clips[b],u))}(),function(){let a=Object.keys(aj.kinematicsModels)[0],b=Object.keys(aj.kinematicsScenes)[0],c=Object.keys(aj.visualScenes)[0];if(void 0===a||void 0===b)return;let d=o(aj.kinematicsModels[a],K),e=o(aj.kinematicsScenes[b],N),f=Z(c),g=e.bindJointAxis,h={};for(let a=0,b=g.length;a<b;a++){let b=g[a],c=ab.querySelector('[sid="'+b.target+'"]');if(c){let a=c.parentElement;!function(a,b){let c=b.getAttribute("name"),e=d.joints[a];f.traverse(function(d){d.name===c&&(h[a]={object:d,transforms:function(a){let b=[],c=ab.querySelector('[id="'+a.id+'"]');for(let a=0;a<c.childNodes.length;a++){let d,e,f=c.childNodes[a];if(1===f.nodeType)switch(f.nodeName){case"matrix":d=i(f.textContent);let g=new aX().fromArray(d).transpose();b.push({sid:f.getAttribute("sid"),type:f.nodeName,obj:g});break;case"translate":case"scale":d=i(f.textContent),e=new at().fromArray(d),b.push({sid:f.getAttribute("sid"),type:f.nodeName,obj:e});break;case"rotate":d=i(f.textContent),e=new at().fromArray(d);let h=$.degToRad(d[3]);b.push({sid:f.getAttribute("sid"),type:f.nodeName,obj:e,angle:h})}}return b}(b),joint:e,position:e.zeroPosition})})}(b.jointIndex,a)}}let j=new aX;ah={joints:d&&d.joints,getJointValue:function(a){let b=h[a];if(b)return b.position;console.warn("THREE.ColladaLoader: Joint "+a+" doesn't exist.")},setJointValue:function(a,b){let c=h[a];if(c){let d=c.joint;if(b>d.limits.max||b<d.limits.min)console.warn("THREE.ColladaLoader: Joint "+a+" value "+b+" outside of limits (min: "+d.limits.min+", max: "+d.limits.max+").");else if(d.static)console.warn("THREE.ColladaLoader: Joint "+a+" is static.");else{let e=c.object,f=d.axis,g=c.transforms;O.identity();for(let c=0;c<g.length;c++){let e=g[c];if(e.sid&&-1!==e.sid.indexOf(a))switch(d.type){case"revolute":O.multiply(j.makeRotationAxis(f,$.degToRad(b)));break;case"prismatic":O.multiply(j.makeTranslation(f.x*b,f.y*b,f.z*b));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+d.type)}else switch(e.type){case"matrix":O.multiply(e.obj);break;case"translate":O.multiply(j.makeTranslation(e.obj.x,e.obj.y,e.obj.z));break;case"scale":O.scale(e.obj);break;case"rotate":O.multiply(j.makeRotationAxis(e.obj,e.angle))}}e.matrix.copy(O),e.matrix.decompose(e.position,e.quaternion,e.scale),h[a].position=b}}else console.log("THREE.ColladaLoader: "+a+" does not exist.")}}}();let ak=(d=h(ab,"scene")[0],Z(k(h(d,"instance_visual_scene")[0].getAttribute("url"))));return ak.animations=ag,"Z_UP"===ad.upAxis&&(console.warn("THREE.ColladaLoader: You are loading an asset with a Z-UP coordinate system. The loader just rotates the asset to transform it into Y-UP. The vertex data are not converted, see #24289."),ak.rotation.set(-Math.PI/2,0,0)),ak.scale.multiplyScalar(ad.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),ag},kinematics:ah,library:aj,scene:ak}}}THREE.ColladaLoader=er,AFRAME.registerComponent("collada-model-legacy",{schema:{type:"asset"},init:function(){this.model=null,this.loader=new THREE.ColladaLoader},update:function(){var a=this,b=this.el,c=this.data,d=this.el.sceneEl.systems.renderer;c&&(this.remove(),this.loader.load(c,function(c){a.model=c.scene,a.model.traverse(function(a){if(a.isMesh){var b=a.material;b.color&&d.applyColorCorrection(b.color),b.map&&d.applyColorCorrection(b.map),b.emissive&&d.applyColorCorrection(b.emissive),b.emissiveMap&&d.applyColorCorrection(b.emissiveMap)}}),b.setObject3D("mesh",a.model),b.emit("model-loaded",{format:"collada",model:a.model})}))},remove:function(){this.model&&this.el.removeObject3D("mesh")}});var es=Uint8Array,et=Uint16Array,eu=Int32Array,ev=new es([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ew=new es([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ex=new es([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ey=function(a,b){for(var c=new et(31),d=0;d<31;++d)c[d]=b+=1<<a[d-1];for(var e=new eu(c[30]),d=1;d<30;++d)for(var f=c[d];f<c[d+1];++f)e[f]=f-c[d]<<5|d;return{b:c,r:e}},ez=ey(ev,2),eA=ez.b,eB=ez.r;eA[28]=258,eB[258]=28;var eC=ey(ew,0),eD=eC.b;eC.r;for(var eE=new et(32768),eF=0;eF<32768;++eF){var eG=(43690&eF)>>1|(21845&eF)<<1;eG=(61680&(eG=(52428&eG)>>2|(13107&eG)<<2))>>4|(3855&eG)<<4,eE[eF]=((65280&eG)>>8|(255&eG)<<8)>>1}for(var eH=function(a,b,c){for(var d,e=a.length,f=0,g=new et(b);f<e;++f)a[f]&&++g[a[f]-1];var h=new et(b);for(f=1;f<b;++f)h[f]=h[f-1]+g[f-1]<<1;if(c){d=new et(1<<b);var i=15-b;for(f=0;f<e;++f)if(a[f])for(var j=f<<4|a[f],k=b-a[f],l=h[a[f]-1]++<<k,m=l|(1<<k)-1;l<=m;++l)d[eE[l]>>i]=j}else for(f=0,d=new et(e);f<e;++f)a[f]&&(d[f]=eE[h[a[f]-1]++]>>15-a[f]);return d},eI=new es(288),eF=0;eF<144;++eF)eI[eF]=8;for(var eF=144;eF<256;++eF)eI[eF]=9;for(var eF=256;eF<280;++eF)eI[eF]=7;for(var eF=280;eF<288;++eF)eI[eF]=8;for(var eJ=new es(32),eF=0;eF<32;++eF)eJ[eF]=5;var eK=eH(eI,9,1),eL=eH(eJ,5,1),eM=function(a){for(var b=a[0],c=1;c<a.length;++c)a[c]>b&&(b=a[c]);return b},eN=function(a,b,c){var d=b/8|0;return(a[d]|a[d+1]<<8)>>(7&b)&c},eO=function(a,b){var c=b/8|0;return(a[c]|a[c+1]<<8|a[c+2]<<16)>>(7&b)},eP=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],eQ=function(a,b,c){var d=Error(b||eP[a]);if(d.code=a,Error.captureStackTrace&&Error.captureStackTrace(d,eQ),!c)throw d;return d},eR=function(a,b,c,d){var e,f,g,h=a.length,i=d?d.length:0;if(!h||b.f&&!b.l)return c||new es(0);var j=!c,k=j||2!=b.i,l=b.i;j&&(c=new es(3*h));var m=function(a){var b=c.length;if(a>b){var d=new es(Math.max(2*b,a));d.set(c),c=d}},n=b.f||0,o=b.p||0,p=b.b||0,q=b.l,r=b.d,s=b.m,t=b.n,u=8*h;do{if(!q){n=eN(a,o,1);var v=eN(a,o+1,3);if(o+=3,v)if(1==v)q=eK,r=eL,s=9,t=5;else if(2==v){var w=eN(a,o,31)+257,x=eN(a,o+10,15)+4,y=w+eN(a,o+5,31)+1;o+=14;for(var z=new es(y),A=new es(19),B=0;B<x;++B)A[ex[B]]=eN(a,o+3*B,7);o+=3*x;for(var C=eM(A),D=(1<<C)-1,E=eH(A,C,1),B=0;B<y;){var F=E[eN(a,o,D)];o+=15&F;var G=F>>4;if(G<16)z[B++]=G;else{var H=0,I=0;for(16==G?(I=3+eN(a,o,3),o+=2,H=z[B-1]):17==G?(I=3+eN(a,o,7),o+=3):18==G&&(I=11+eN(a,o,127),o+=7);I--;)z[B++]=H}}var J=z.subarray(0,w),K=z.subarray(w);s=eM(J),t=eM(K),q=eH(J,s,1),r=eH(K,t,1)}else eQ(1);else{var G=((o+7)/8|0)+4,L=a[G-4]|a[G-3]<<8,M=G+L;if(M>h){l&&eQ(0);break}k&&m(p+L),c.set(a.subarray(G,M),p),b.b=p+=L,b.p=o=8*M,b.f=n;continue}if(o>u){l&&eQ(0);break}}k&&m(p+131072);for(var N=(1<<s)-1,O=(1<<t)-1,P=o;;P=o){var H=q[eO(a,o)&N],Q=H>>4;if((o+=15&H)>u){l&&eQ(0);break}if(H||eQ(2),Q<256)c[p++]=Q;else if(256==Q){P=o,q=null;break}else{var R=Q-254;if(Q>264){var B=Q-257,S=ev[B];R=eN(a,o,(1<<S)-1)+eA[B],o+=S}var T=r[eO(a,o)&O],U=T>>4;T||eQ(3),o+=15&T;var K=eD[U];if(U>3){var S=ew[U];K+=eO(a,o)&(1<<S)-1,o+=S}if(o>u){l&&eQ(0);break}k&&m(p+131072);var V=p+R;if(p<K){var W=i-K,X=Math.min(K,V);for(W+p<0&&eQ(3);p<X;++p)c[p]=d[W+p]}for(;p<V;++p)c[p]=c[p-K]}}b.l=q,b.p=P,b.b=p,b.f=n,q&&(n=1,b.m=s,b.d=r,b.n=t)}while(!n);return p!=c.length&&j?(e=c,(f=0)<0&&(f=0),(null==(g=p)||g>e.length)&&(g=e.length),new es(e.subarray(f,g))):c.subarray(0,p)},eS=new es(0),eT="undefined"!=typeof TextDecoder&&new TextDecoder;try{eT.decode(eS,{stream:!0})}catch(a){}function eU(a,b,c){let d=c.length-a-1;if(b>=c[d])return d-1;if(b<=c[a])return a;let e=a,f=d,g=Math.floor((e+f)/2);for(;b<c[g]||b>=c[g+1];)b<c[g]?f=g:e=g,g=Math.floor((e+f)/2);return g}"function"==typeof queueMicrotask&&queueMicrotask;class eV extends cZ{constructor(a,b,c,d,e){super(),this.degree=a,this.knots=b,this.controlPoints=[],this.startKnot=d||0,this.endKnot=e||this.knots.length-1;for(let a=0;a<c.length;++a){let b=c[a];this.controlPoints[a]=new ar(b.x,b.y,b.z,b.w)}}getPoint(a,b=new at){let c=this.knots[this.startKnot]+a*(this.knots[this.endKnot]-this.knots[this.startKnot]),d=function(a,b,c,d){let e=eU(a,d,b),f=function(a,b,c,d){let e=[],f=[],g=[];e[0]=1;for(let h=1;h<=c;++h){f[h]=b-d[a+1-h],g[h]=d[a+h]-b;let c=0;for(let a=0;a<h;++a){let b=g[a+1],d=f[h-a],i=e[a]/(b+d);e[a]=c+b*i,c=d*i}e[h]=c}return e}(e,d,a,b),g=new ar(0,0,0,0);for(let b=0;b<=a;++b){let d=c[e-a+b],h=f[b],i=d.w*h;g.x+=d.x*i,g.y+=d.y*i,g.z+=d.z*i,g.w+=d.w*h}return g}(this.degree,this.knots,this.controlPoints,c);return 1!==d.w&&d.divideScalar(d.w),b.set(d.x,d.y,d.z)}getTangent(a,b=new at){var c,d,e;let f=this.knots[0]+a*(this.knots[this.knots.length-1]-this.knots[0]),g=(c=this.degree,d=this.knots,e=this.controlPoints,function(a){let b=a.length,c=[],d=[];for(let e=0;e<b;++e){let b=a[e];c[e]=new at(b.x,b.y,b.z),d[e]=b.w}let e=[];for(let a=0;a<b;++a){let b=c[a].clone();for(let c=1;c<=a;++c)b.sub(e[a-c].clone().multiplyScalar(function(a,b){let c=1;for(let b=2;b<=a;++b)c*=b;let d=1;for(let a=2;a<=b;++a)d*=a;for(let c=2;c<=a-b;++c)d*=c;return c/d}(a,c)*d[c]));e[a]=b.divideScalar(d[0])}return e}(function(a,b,c,d,e){let f=1<a?e:a,g=[],h=eU(a,d,b),i=function(a,b,c,d,e){let f=[];for(let a=0;a<=c;++a)f[a]=0;let g=[];for(let a=0;a<=d;++a)g[a]=f.slice(0);let h=[];for(let a=0;a<=c;++a)h[a]=f.slice(0);h[0][0]=1;let i=f.slice(0),j=f.slice(0);for(let d=1;d<=c;++d){i[d]=b-e[a+1-d],j[d]=e[a+d]-b;let c=0;for(let a=0;a<d;++a){let b=j[a+1],e=i[d-a];h[d][a]=b+e;let f=h[a][d-1]/h[d][a];h[a][d]=c+b*f,c=e*f}h[d][d]=c}for(let a=0;a<=c;++a)g[0][a]=h[a][c];for(let a=0;a<=c;++a){let b=0,e=1,i=[];for(let a=0;a<=c;++a)i[a]=f.slice(0);i[0][0]=1;for(let f=1;f<=d;++f){let d=0,j=a-f,k=c-f;a>=f&&(i[e][0]=i[b][0]/h[k+1][j],d=i[e][0]*h[j][k]);let l=j>=-1?1:-j,m=a-1<=k?f-1:c-a;for(let a=l;a<=m;++a)i[e][a]=(i[b][a]-i[b][a-1])/h[k+1][j+a],d+=i[e][a]*h[j+a][k];a<=k&&(i[e][f]=-i[b][f-1]/h[k+1][a],d+=i[e][f]*h[a][k]),g[f][a]=d;let n=b;b=e,e=n}}let k=c;for(let a=1;a<=d;++a){for(let b=0;b<=c;++b)g[a][b]*=k;k*=c-a}return g}(h,d,a,f,b),j=[];for(let a=0;a<c.length;++a){let b=c[a].clone(),d=b.w;b.x*=d,b.y*=d,b.z*=d,j[a]=b}for(let b=0;b<=f;++b){let c=j[h-a].clone().multiplyScalar(i[b][0]);for(let d=1;d<=a;++d)c.add(j[h-a+d].clone().multiplyScalar(i[b][d]));g[b]=c}for(let a=f+1;a<=e+1;++a)g[a]=new ar(0,0,0);return g}(c,d,e,f,1)));return b.copy(g[1]).normalize(),b}}class eW extends dV{constructor(a){super(a)}load(a,b,c,d){let e=this,f=""===e.path?ef.extractUrlBase(a):e.path,g=new dY(this.manager);g.setPath(e.path),g.setResponseType("arraybuffer"),g.setRequestHeader(e.requestHeader),g.setWithCredentials(e.withCredentials),g.load(a,function(c){try{b(e.parse(c,f))}catch(b){d?d(b):console.error(b),e.manager.itemError(a)}},c,d)}parse(a,b){if(function(a){let b="Kaydara FBX Binary  \0";return a.byteLength>=b.length&&b===fb(a,0,b.length)}(a))e=new e_().parse(a);else{let b=fb(a);if(!function(a){let b=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],c=0;for(let d=0;d<b.length;++d)if(function(b){let d=a[0];return a=a.slice(c+1),c++,d}(1)===b[d])return!1;return!0}(b))throw Error("THREE.FBXLoader: Unknown format.");if(7e3>e2(b))throw Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+e2(b));e=new e$().parse(b)}return new eX(new d_(this.manager).setPath(this.resourcePath||b).setCrossOrigin(this.crossOrigin),this.manager).parse(e)}}class eX{constructor(a,b){this.textureLoader=a,this.manager=b}parse(){f=this.parseConnections();let a=this.parseImages(),b=this.parseTextures(a),c=this.parseMaterials(b),d=this.parseDeformers(),e=new eY().parse(d);return this.parseScene(d,e,c),g}parseConnections(){let a=new Map;return"Connections"in e&&e.Connections.connections.forEach(function(b){let c=b[0],d=b[1],e=b[2];a.has(c)||a.set(c,{parents:[],children:[]}),a.get(c).parents.push({ID:d,relationship:e}),a.has(d)||a.set(d,{parents:[],children:[]}),a.get(d).children.push({ID:c,relationship:e})}),a}parseImages(){let a={},b={};if("Video"in e.Objects){let c=e.Objects.Video;for(let d in c){let e=c[d];if(a[parseInt(d)]=e.RelativeFilename||e.Filename,"Content"in e){let a=e.Content instanceof ArrayBuffer&&e.Content.byteLength>0,f="string"==typeof e.Content&&""!==e.Content;if(a||f){let a=this.parseImage(c[d]);b[e.RelativeFilename||e.Filename]=a}}}}for(let c in a){let d=a[c];void 0!==b[d]?a[c]=b[d]:a[c]=a[c].split("\\").pop()}return a}parseImage(a){let b,c=a.Content,d=a.RelativeFilename||a.Filename,e=d.slice(d.lastIndexOf(".")+1).toLowerCase();switch(e){case"bmp":b="image/bmp";break;case"jpg":case"jpeg":b="image/jpeg";break;case"png":b="image/png";break;case"tif":b="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",d),b="image/tga";break;default:console.warn('FBXLoader: Image type "'+e+'" is not supported.');return}if("string"==typeof c)return"data:"+b+";base64,"+c;{let a=new Uint8Array(c);return window.URL.createObjectURL(new Blob([a],{type:b}))}}parseTextures(a){let b=new Map;if("Texture"in e.Objects){let c=e.Objects.Texture;for(let d in c){let e=this.parseTexture(c[d],a);b.set(parseInt(d),e)}}return b}parseTexture(a,b){let c=this.loadTexture(a,b);c.ID=a.id,c.name=a.attrName;let d=a.WrapModeU,e=a.WrapModeV,f=void 0!==d?d.value:0,g=void 0!==e?e.value:0;if(c.wrapS=0===f?1e3:1001,c.wrapT=0===g?1e3:1001,"Scaling"in a){let b=a.Scaling.value;c.repeat.x=b[0],c.repeat.y=b[1]}if("Translation"in a){let b=a.Translation.value;c.offset.x=b[0],c.offset.y=b[1]}return c}loadTexture(a,b){let c,d,e=this.textureLoader.path,g=f.get(a.id).children;void 0!==g&&g.length>0&&void 0!==b[g[0].ID]&&(0===(c=b[g[0].ID]).indexOf("blob:")||0===c.indexOf("data:"))&&this.textureLoader.setPath(void 0);let h=a.FileName.slice(-3).toLowerCase();if("tga"===h){let b=this.manager.getHandler(".tga");null===b?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",a.RelativeFilename),d=new aq):(b.setPath(this.textureLoader.path),d=b.load(c))}else if("dds"===h){let b=this.manager.getHandler(".dds");null===b?(console.warn("FBXLoader: DDS loader not found, creating placeholder texture for",a.RelativeFilename),d=new aq):(b.setPath(this.textureLoader.path),d=b.load(c))}else"psd"===h?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",a.RelativeFilename),d=new aq):d=this.textureLoader.load(c);return this.textureLoader.setPath(e),d}parseMaterials(a){let b=new Map;if("Material"in e.Objects){let c=e.Objects.Material;for(let d in c){let e=this.parseMaterial(c[d],a);null!==e&&b.set(parseInt(d),e)}}return b}parseMaterial(a,b){let c,d=a.id,e=a.attrName,g=a.ShadingModel;if("object"==typeof g&&(g=g.value),!f.has(d))return null;let h=this.parseParameters(a,b,d);switch(g.toLowerCase()){case"phong":c=new dA;break;case"lambert":c=new dB;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',g),c=new dA}return c.setValues(h),c.name=e,c}parseParameters(a,b,c){let d={};a.BumpFactor&&(d.bumpScale=a.BumpFactor.value),a.Diffuse?d.color=new bC().fromArray(a.Diffuse.value).convertSRGBToLinear():a.DiffuseColor&&("Color"===a.DiffuseColor.type||"ColorRGB"===a.DiffuseColor.type)&&(d.color=new bC().fromArray(a.DiffuseColor.value).convertSRGBToLinear()),a.DisplacementFactor&&(d.displacementScale=a.DisplacementFactor.value),a.Emissive?d.emissive=new bC().fromArray(a.Emissive.value).convertSRGBToLinear():a.EmissiveColor&&("Color"===a.EmissiveColor.type||"ColorRGB"===a.EmissiveColor.type)&&(d.emissive=new bC().fromArray(a.EmissiveColor.value).convertSRGBToLinear()),a.EmissiveFactor&&(d.emissiveIntensity=parseFloat(a.EmissiveFactor.value)),a.Opacity&&(d.opacity=parseFloat(a.Opacity.value)),d.opacity<1&&(d.transparent=!0),a.ReflectionFactor&&(d.reflectivity=a.ReflectionFactor.value),a.Shininess&&(d.shininess=a.Shininess.value),a.Specular?d.specular=new bC().fromArray(a.Specular.value).convertSRGBToLinear():a.SpecularColor&&"Color"===a.SpecularColor.type&&(d.specular=new bC().fromArray(a.SpecularColor.value).convertSRGBToLinear());let e=this;return f.get(c).children.forEach(function(a){let c=a.relationship;switch(c){case"Bump":d.bumpMap=e.getTexture(b,a.ID);break;case"Maya|TEX_ao_map":d.aoMap=e.getTexture(b,a.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":d.map=e.getTexture(b,a.ID),void 0!==d.map&&(d.map.colorSpace=M);break;case"DisplacementColor":d.displacementMap=e.getTexture(b,a.ID);break;case"EmissiveColor":d.emissiveMap=e.getTexture(b,a.ID),void 0!==d.emissiveMap&&(d.emissiveMap.colorSpace=M);break;case"NormalMap":case"Maya|TEX_normal_map":d.normalMap=e.getTexture(b,a.ID);break;case"ReflectionColor":d.envMap=e.getTexture(b,a.ID),void 0!==d.envMap&&(d.envMap.mapping=303,d.envMap.colorSpace=M);break;case"SpecularColor":d.specularMap=e.getTexture(b,a.ID),void 0!==d.specularMap&&(d.specularMap.colorSpace=M);break;case"TransparentColor":case"TransparencyFactor":d.alphaMap=e.getTexture(b,a.ID),d.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",c)}}),d}getTexture(a,b){return"LayeredTexture"in e.Objects&&b in e.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),b=f.get(b).children[0].ID),a.get(b)}parseDeformers(){let a={},b={};if("Deformer"in e.Objects){let c=e.Objects.Deformer;for(let d in c){let e=c[d],g=f.get(parseInt(d));if("Skin"===e.attrType){let b=this.parseSkeleton(g,c);b.ID=d,g.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),b.geometryID=g.parents[0].ID,a[d]=b}else if("BlendShape"===e.attrType){let a={id:d};a.rawTargets=this.parseMorphTargets(g,c),a.id=d,g.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),b[d]=a}}}return{skeletons:a,morphTargets:b}}parseSkeleton(a,b){let c=[];return a.children.forEach(function(a){let d=b[a.ID];if("Cluster"!==d.attrType)return;let e={ID:a.ID,indices:[],weights:[],transformLink:new aX().fromArray(d.TransformLink.a)};"Indexes"in d&&(e.indices=d.Indexes.a,e.weights=d.Weights.a),c.push(e)}),{rawBones:c,bones:[]}}parseMorphTargets(a,b){let c=[];for(let d=0;d<a.children.length;d++){let e=a.children[d],g=b[e.ID],h={name:g.attrName,initialWeight:g.DeformPercent,id:g.id,fullWeights:g.FullWeights.a};if("BlendShapeChannel"!==g.attrType)return;h.geoID=f.get(parseInt(e.ID)).children.filter(function(a){return void 0===a.relationship})[0].ID,c.push(h)}return c}parseScene(a,b,c){g=new cv;let d=this.parseModels(a.skeletons,b,c),h=e.Objects.Model,i=this;d.forEach(function(a){let b=h[a.ID];i.setLookAtProperties(a,b),f.get(a.ID).parents.forEach(function(b){let c=d.get(b.ID);void 0!==c&&c.add(a)}),null===a.parent&&g.add(a)}),this.bindSkeleton(a.skeletons,b,d),this.addGlobalSceneSettings(),g.traverse(function(a){if(a.userData.transformData){a.parent&&(a.userData.transformData.parentMatrix=a.parent.matrix,a.userData.transformData.parentMatrixWorld=a.parent.matrixWorld);let b=e8(a.userData.transformData);a.applyMatrix4(b),a.updateWorldMatrix()}});let j=new eZ().parse();1===g.children.length&&g.children[0].isGroup&&(g.children[0].animations=j,g=g.children[0]),g.animations=j}parseModels(a,b,c){let d=new Map,g=e.Objects.Model;for(let e in g){let h=parseInt(e),i=g[e],j=f.get(h),k=this.buildSkeleton(j,a,h,i.attrName);if(!k){switch(i.attrType){case"Camera":k=this.createCamera(j);break;case"Light":k=this.createLight(j);break;case"Mesh":k=this.createMesh(j,b,c);break;case"NurbsCurve":k=this.createCurve(j,b);break;case"LimbNode":case"Root":k=new cH;break;default:k=new cv}k.name=i.attrName?ep.sanitizeNodeName(i.attrName):"",k.userData.originalName=i.attrName,k.ID=h}this.getTransformData(k,i),d.set(h,k)}return d}buildSkeleton(a,b,c,d){let e=null;return a.parents.forEach(function(a){for(let f in b){let g=b[f];g.rawBones.forEach(function(b,f){if(b.ID===a.ID){let a=e;(e=new cH).matrixWorld.copy(b.transformLink),e.name=d?ep.sanitizeNodeName(d):"",e.userData.originalName=d,e.ID=c,g.bones[f]=e,null!==a&&e.add(a)}})}}),e}createCamera(a){let b,c;if(a.children.forEach(function(a){let b=e.Objects.NodeAttribute[a.ID];void 0!==b&&(c=b)}),void 0===c)b=new bm;else{let a=0;void 0!==c.CameraProjectionType&&1===c.CameraProjectionType.value&&(a=1);let d=1;void 0!==c.NearPlane&&(d=c.NearPlane.value/1e3);let e=1e3;void 0!==c.FarPlane&&(e=c.FarPlane.value/1e3);let f=window.innerWidth,g=window.innerHeight;void 0!==c.AspectWidth&&void 0!==c.AspectHeight&&(f=c.AspectWidth.value,g=c.AspectHeight.value);let h=f/g,i=45;void 0!==c.FieldOfView&&(i=c.FieldOfView.value);let j=c.FocalLength?c.FocalLength.value:null;switch(a){case 0:b=new ci(i,h,d,e),null!==j&&b.setFocalLength(j);break;case 1:b=new ct(-f/2,f/2,g/2,-g/2,d,e);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+a+"."),b=new bm}}return b}createLight(a){let b,c;if(a.children.forEach(function(a){let b=e.Objects.NodeAttribute[a.ID];void 0!==b&&(c=b)}),void 0===c)b=new bm;else{let a;a=void 0===c.LightType?0:c.LightType.value;let d=0xffffff;void 0!==c.Color&&(d=new bC().fromArray(c.Color.value).convertSRGBToLinear());let e=void 0===c.Intensity?1:c.Intensity.value/100;void 0!==c.CastLightOnObject&&0===c.CastLightOnObject.value&&(e=0);let f=0;switch(void 0!==c.FarAttenuationEnd&&(f=void 0!==c.EnableFarAttenuation&&0===c.EnableFarAttenuation.value?0:c.FarAttenuationEnd.value),a){case 0:b=new eb(d,e,f,1);break;case 1:b=new ed(d,e);break;case 2:let g=Math.PI/3;void 0!==c.InnerAngle&&(g=$.degToRad(c.InnerAngle.value));let h=0;void 0!==c.OuterAngle&&(h=Math.max(h=$.degToRad(c.OuterAngle.value),1)),b=new d6(d,e,f,g,h,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+c.LightType.value+", defaulting to a PointLight."),b=new eb(d,e)}void 0!==c.CastShadows&&1===c.CastShadows.value&&(b.castShadow=!0)}return b}createMesh(a,b,c){let d,e=null,f=null,g=[];return a.children.forEach(function(a){b.has(a.ID)&&(e=b.get(a.ID)),c.has(a.ID)&&g.push(c.get(a.ID))}),g.length>1?f=g:g.length>0?f=g[0]:(f=new dA({name:dV.DEFAULT_MATERIAL_NAME,color:0xcccccc}),g.push(f)),"color"in e.attributes&&g.forEach(function(a){a.vertexColors=!0}),e.FBX_Deformer?(d=new cG(e,f)).normalizeSkinWeights():d=new ca(e,f),d}createCurve(a,b){return new cU(a.children.reduce(function(a,c){return b.has(c.ID)&&(a=b.get(c.ID)),a},null),new cM({name:dV.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1}))}getTransformData(a,b){let c={};"InheritType"in b&&(c.inheritType=parseInt(b.InheritType.value)),"RotationOrder"in b?c.eulerOrder=e9(b.RotationOrder.value):c.eulerOrder="ZYX","Lcl_Translation"in b&&(c.translation=b.Lcl_Translation.value),"PreRotation"in b&&(c.preRotation=b.PreRotation.value),"Lcl_Rotation"in b&&(c.rotation=b.Lcl_Rotation.value),"PostRotation"in b&&(c.postRotation=b.PostRotation.value),"Lcl_Scaling"in b&&(c.scale=b.Lcl_Scaling.value),"ScalingOffset"in b&&(c.scalingOffset=b.ScalingOffset.value),"ScalingPivot"in b&&(c.scalingPivot=b.ScalingPivot.value),"RotationOffset"in b&&(c.rotationOffset=b.RotationOffset.value),"RotationPivot"in b&&(c.rotationPivot=b.RotationPivot.value),a.userData.transformData=c}setLookAtProperties(a,b){"LookAtProperty"in b&&f.get(a.ID).children.forEach(function(b){if("LookAtProperty"===b.relationship){let c=e.Objects.Model[b.ID];if("Lcl_Translation"in c){let b=c.Lcl_Translation.value;void 0!==a.target?(a.target.position.fromArray(b),g.add(a.target)):a.lookAt(new at().fromArray(b))}}})}bindSkeleton(a,b,c){let d=this.parsePoseNodes();for(let e in a){let g=a[e];f.get(parseInt(g.ID)).parents.forEach(function(a){if(b.has(a.ID)){let b=a.ID;f.get(b).parents.forEach(function(a){c.has(a.ID)&&c.get(a.ID).bind(new cL(g.bones),d[a.ID])})}})}}parsePoseNodes(){let a={};if("Pose"in e.Objects){let b=e.Objects.Pose;for(let c in b)if("BindPose"===b[c].attrType&&b[c].NbPoseNodes>0){let d=b[c].PoseNode;Array.isArray(d)?d.forEach(function(b){a[b.Node]=new aX().fromArray(b.Matrix.a)}):a[d.Node]=new aX().fromArray(d.Matrix.a)}}return a}addGlobalSceneSettings(){if("GlobalSettings"in e){if("AmbientColor"in e.GlobalSettings){let a=e.GlobalSettings.AmbientColor.value,b=a[0],c=a[1],d=a[2];if(0!==b||0!==c||0!==d){let a=new bC(b,c,d).convertSRGBToLinear();g.add(new ee(a,1))}}"UnitScaleFactor"in e.GlobalSettings&&(g.userData.unitScaleFactor=e.GlobalSettings.UnitScaleFactor.value)}}}class eY{constructor(){this.negativeMaterialIndices=!1}parse(a){let b=new Map;if("Geometry"in e.Objects){let c=e.Objects.Geometry;for(let d in c){let e=f.get(parseInt(d)),g=this.parseGeometry(e,c[d],a);b.set(parseInt(d),g)}}return!0===this.negativeMaterialIndices&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),b}parseGeometry(a,b,c){switch(b.attrType){case"Mesh":return this.parseMeshGeometry(a,b,c);case"NurbsCurve":return this.parseNurbsGeometry(b)}}parseMeshGeometry(a,b,c){let d=c.skeletons,f=[],g=a.parents.map(function(a){return e.Objects.Model[a.ID]});if(0===g.length)return;let h=a.children.reduce(function(a,b){return void 0!==d[b.ID]&&(a=d[b.ID]),a},null);a.children.forEach(function(a){void 0!==c.morphTargets[a.ID]&&f.push(c.morphTargets[a.ID])});let i=g[0],j={};"RotationOrder"in i&&(j.eulerOrder=e9(i.RotationOrder.value)),"InheritType"in i&&(j.inheritType=parseInt(i.InheritType.value)),"GeometricTranslation"in i&&(j.translation=i.GeometricTranslation.value),"GeometricRotation"in i&&(j.rotation=i.GeometricRotation.value),"GeometricScaling"in i&&(j.scale=i.GeometricScaling.value);let k=e8(j);return this.genGeometry(b,h,f,k)}genGeometry(a,b,c,d){let e=new bU;a.attrName&&(e.name=a.attrName);let f=this.parseGeoNode(a,b),g=this.genBuffers(f),h=new bM(g.vertex,3);if(h.applyMatrix4(d),e.setAttribute("position",h),g.colors.length>0&&e.setAttribute("color",new bM(g.colors,3)),b&&(e.setAttribute("skinIndex",new bK(g.weightsIndices,4)),e.setAttribute("skinWeight",new bM(g.vertexWeights,4)),e.FBX_Deformer=b),g.normal.length>0){let a=new aa().getNormalMatrix(d),b=new bM(g.normal,3);b.applyNormalMatrix(a),e.setAttribute("normal",b)}if(g.uvs.forEach(function(a,b){let c=0===b?"uv":`uv${b}`;e.setAttribute(c,new bM(g.uvs[b],2))}),f.material&&"AllSame"!==f.material.mappingType){let a=g.materialIndex[0],b=0;if(g.materialIndex.forEach(function(c,d){c!==a&&(e.addGroup(b,d-b,a),a=c,b=d)}),e.groups.length>0){let b=e.groups[e.groups.length-1],c=b.start+b.count;c!==g.materialIndex.length&&e.addGroup(c,g.materialIndex.length-c,a)}0===e.groups.length&&e.addGroup(0,g.materialIndex.length,g.materialIndex[0])}return this.addMorphTargets(e,a,c,d),e}parseGeoNode(a,b){let c={};if(c.vertexPositions=void 0!==a.Vertices?a.Vertices.a:[],c.vertexIndices=void 0!==a.PolygonVertexIndex?a.PolygonVertexIndex.a:[],a.LayerElementColor&&(c.color=this.parseVertexColors(a.LayerElementColor[0])),a.LayerElementMaterial&&(c.material=this.parseMaterialIndices(a.LayerElementMaterial[0])),a.LayerElementNormal&&(c.normal=this.parseNormals(a.LayerElementNormal[0])),a.LayerElementUV){c.uv=[];let b=0;for(;a.LayerElementUV[b];)a.LayerElementUV[b].UV&&c.uv.push(this.parseUVs(a.LayerElementUV[b])),b++}return c.weightTable={},null!==b&&(c.skeleton=b,b.rawBones.forEach(function(a,b){a.indices.forEach(function(d,e){void 0===c.weightTable[d]&&(c.weightTable[d]=[]),c.weightTable[d].push({id:b,weight:a.weights[e]})})})),c}genBuffers(a){let b={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},c=0,d=0,e=!1,f=[],g=[],h=[],i=[],j=[],k=[],l=this;return a.vertexIndices.forEach(function(m,n){let o,p=!1;m<0&&(m^=-1,p=!0);let q=[],r=[];if(f.push(3*m,3*m+1,3*m+2),a.color){let b=e5(n,c,m,a.color);h.push(b[0],b[1],b[2])}if(a.skeleton){if(void 0!==a.weightTable[m]&&a.weightTable[m].forEach(function(a){r.push(a.weight),q.push(a.id)}),r.length>4){e||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),e=!0);let a=[0,0,0,0],b=[0,0,0,0];r.forEach(function(c,d){let e=c,f=q[d];b.forEach(function(b,c,d){if(e>b){d[c]=e,e=b;let g=a[c];a[c]=f,f=g}})}),q=a,r=b}for(;r.length<4;)r.push(0),q.push(0);for(let a=0;a<4;++a)j.push(r[a]),k.push(q[a])}if(a.normal){let b=e5(n,c,m,a.normal);g.push(b[0],b[1],b[2])}a.material&&"AllSame"!==a.material.mappingType&&(o=e5(n,c,m,a.material)[0])<0&&(l.negativeMaterialIndices=!0,o=0),a.uv&&a.uv.forEach(function(a,b){let d=e5(n,c,m,a);void 0===i[b]&&(i[b]=[]),i[b].push(d[0]),i[b].push(d[1])}),d++,p&&(l.genFace(b,a,f,o,g,h,i,j,k,d),c++,d=0,f=[],g=[],h=[],i=[],j=[],k=[])}),b}getNormalNewell(a){let b=new at(0,0,0);for(let c=0;c<a.length;c++){let d=a[c],e=a[(c+1)%a.length];b.x+=(d.y-e.y)*(d.z+e.z),b.y+=(d.z-e.z)*(d.x+e.x),b.z+=(d.x-e.x)*(d.y+e.y)}return b.normalize(),b}getNormalTangentAndBitangent(a){let b=this.getNormalNewell(a),c=(Math.abs(b.z)>.5?new at(0,1,0):new at(0,0,1)).cross(b).normalize(),d=b.clone().cross(c).normalize();return{normal:b,tangent:c,bitangent:d}}flattenVertex(a,b,c){return new _(a.dot(b),a.dot(c))}genFace(a,b,c,d,e,f,g,h,i,j){let k;if(j>3){let a=[];for(let d=0;d<c.length;d+=3)a.push(new at(b.vertexPositions[c[d]],b.vertexPositions[c[d+1]],b.vertexPositions[c[d+2]]));let{tangent:d,bitangent:e}=this.getNormalTangentAndBitangent(a),f=[];for(let b of a)f.push(this.flattenVertex(b,d,e));k=dx.triangulateShape(f,[])}else k=[[0,1,2]];for(let[j,l,m]of k)a.vertex.push(b.vertexPositions[c[3*j]]),a.vertex.push(b.vertexPositions[c[3*j+1]]),a.vertex.push(b.vertexPositions[c[3*j+2]]),a.vertex.push(b.vertexPositions[c[3*l]]),a.vertex.push(b.vertexPositions[c[3*l+1]]),a.vertex.push(b.vertexPositions[c[3*l+2]]),a.vertex.push(b.vertexPositions[c[3*m]]),a.vertex.push(b.vertexPositions[c[3*m+1]]),a.vertex.push(b.vertexPositions[c[3*m+2]]),b.skeleton&&(a.vertexWeights.push(h[4*j]),a.vertexWeights.push(h[4*j+1]),a.vertexWeights.push(h[4*j+2]),a.vertexWeights.push(h[4*j+3]),a.vertexWeights.push(h[4*l]),a.vertexWeights.push(h[4*l+1]),a.vertexWeights.push(h[4*l+2]),a.vertexWeights.push(h[4*l+3]),a.vertexWeights.push(h[4*m]),a.vertexWeights.push(h[4*m+1]),a.vertexWeights.push(h[4*m+2]),a.vertexWeights.push(h[4*m+3]),a.weightsIndices.push(i[4*j]),a.weightsIndices.push(i[4*j+1]),a.weightsIndices.push(i[4*j+2]),a.weightsIndices.push(i[4*j+3]),a.weightsIndices.push(i[4*l]),a.weightsIndices.push(i[4*l+1]),a.weightsIndices.push(i[4*l+2]),a.weightsIndices.push(i[4*l+3]),a.weightsIndices.push(i[4*m]),a.weightsIndices.push(i[4*m+1]),a.weightsIndices.push(i[4*m+2]),a.weightsIndices.push(i[4*m+3])),b.color&&(a.colors.push(f[3*j]),a.colors.push(f[3*j+1]),a.colors.push(f[3*j+2]),a.colors.push(f[3*l]),a.colors.push(f[3*l+1]),a.colors.push(f[3*l+2]),a.colors.push(f[3*m]),a.colors.push(f[3*m+1]),a.colors.push(f[3*m+2])),b.material&&"AllSame"!==b.material.mappingType&&(a.materialIndex.push(d),a.materialIndex.push(d),a.materialIndex.push(d)),b.normal&&(a.normal.push(e[3*j]),a.normal.push(e[3*j+1]),a.normal.push(e[3*j+2]),a.normal.push(e[3*l]),a.normal.push(e[3*l+1]),a.normal.push(e[3*l+2]),a.normal.push(e[3*m]),a.normal.push(e[3*m+1]),a.normal.push(e[3*m+2])),b.uv&&b.uv.forEach(function(b,c){void 0===a.uvs[c]&&(a.uvs[c]=[]),a.uvs[c].push(g[c][2*j]),a.uvs[c].push(g[c][2*j+1]),a.uvs[c].push(g[c][2*l]),a.uvs[c].push(g[c][2*l+1]),a.uvs[c].push(g[c][2*m]),a.uvs[c].push(g[c][2*m+1])})}addMorphTargets(a,b,c,d){if(0===c.length)return;a.morphTargetsRelative=!0,a.morphAttributes.position=[];let f=this;c.forEach(function(c){c.rawTargets.forEach(function(c){let g=e.Objects.Geometry[c.geoID];void 0!==g&&f.genMorphGeometry(a,b,g,d,c.name)})})}genMorphGeometry(a,b,c,d,e){let f=void 0!==b.PolygonVertexIndex?b.PolygonVertexIndex.a:[],g=void 0!==c.Vertices?c.Vertices.a:[],h=void 0!==c.Indexes?c.Indexes.a:[],i=new Float32Array(3*a.attributes.position.count);for(let a=0;a<h.length;a++){let b=3*h[a];i[b]=g[3*a],i[b+1]=g[3*a+1],i[b+2]=g[3*a+2]}let j=new bM(this.genBuffers({vertexIndices:f,vertexPositions:i}).vertex,3);j.name=e||c.attrName,j.applyMatrix4(d),a.morphAttributes.position.push(j)}parseNormals(a){let b=a.MappingInformationType,c=a.ReferenceInformationType,d=a.Normals.a,e=[];return"IndexToDirect"===c&&("NormalIndex"in a?e=a.NormalIndex.a:"NormalsIndex"in a&&(e=a.NormalsIndex.a)),{dataSize:3,buffer:d,indices:e,mappingType:b,referenceType:c}}parseUVs(a){let b=a.MappingInformationType,c=a.ReferenceInformationType,d=a.UV.a,e=[];return"IndexToDirect"===c&&(e=a.UVIndex.a),{dataSize:2,buffer:d,indices:e,mappingType:b,referenceType:c}}parseVertexColors(a){let b=a.MappingInformationType,c=a.ReferenceInformationType,d=a.Colors.a,e=[];"IndexToDirect"===c&&(e=a.ColorIndex.a);for(let a=0,b=new bC;a<d.length;a+=4)b.fromArray(d,a).convertSRGBToLinear().toArray(d,a);return{dataSize:4,buffer:d,indices:e,mappingType:b,referenceType:c}}parseMaterialIndices(a){let b=a.MappingInformationType,c=a.ReferenceInformationType;if("NoMappingInformation"===b)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:c};let d=a.Materials.a,e=[];for(let a=0;a<d.length;++a)e.push(a);return{dataSize:1,buffer:d,indices:e,mappingType:b,referenceType:c}}parseNurbsGeometry(a){let b,c,d=parseInt(a.Order);if(isNaN(d))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",a.Order,a.id),new bU;let e=d-1,f=a.KnotVector.a,g=[],h=a.Points.a;for(let a=0,b=h.length;a<b;a+=4)g.push(new ar().fromArray(h,a));if("Closed"===a.Form)g.push(g[0]);else if("Periodic"===a.Form){b=e,c=f.length-1-b;for(let a=0;a<e;++a)g.push(g[a])}let i=new eV(e,f,g,b,c).getPoints(12*g.length);return new bU().setFromPoints(i)}}class eZ{parse(){let a=[],b=this.parseClips();if(void 0!==b)for(let c in b){let d=b[c],e=this.addClip(d);a.push(e)}return a}parseClips(){if(void 0===e.Objects.AnimationCurve)return;let a=this.parseAnimationCurveNodes();this.parseAnimationCurves(a);let b=this.parseAnimationLayers(a);return this.parseAnimStacks(b)}parseAnimationCurveNodes(){let a=e.Objects.AnimationCurveNode,b=new Map;for(let c in a){let d=a[c];if(null!==d.attrName.match(/S|R|T|DeformPercent/)){let a={id:d.id,attr:d.attrName,curves:{}};b.set(a.id,a)}}return b}parseAnimationCurves(a){let b=e.Objects.AnimationCurve;for(let c in b){let d={id:b[c].id,times:b[c].KeyTime.a.map(e3),values:b[c].KeyValueFloat.a},e=f.get(d.id);if(void 0!==e){let b=e.parents[0].ID,c=e.parents[0].relationship;c.match(/X/)?a.get(b).curves.x=d:c.match(/Y/)?a.get(b).curves.y=d:c.match(/Z/)?a.get(b).curves.z=d:c.match(/DeformPercent/)&&a.has(b)&&(a.get(b).curves.morph=d)}}}parseAnimationLayers(a){let b=e.Objects.AnimationLayer,c=new Map;for(let d in b){let b=[],h=f.get(parseInt(d));void 0!==h&&(h.children.forEach(function(c,d){if(a.has(c.ID)){let h=a.get(c.ID);if(void 0!==h.curves.x||void 0!==h.curves.y||void 0!==h.curves.z){if(void 0===b[d]){let a=f.get(c.ID).parents.filter(function(a){return void 0!==a.relationship})[0].ID;if(void 0!==a){let f=e.Objects.Model[a.toString()];if(void 0===f)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",c);let h={modelName:f.attrName?ep.sanitizeNodeName(f.attrName):"",ID:f.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};g.traverse(function(a){a.ID===f.id&&(h.transform=a.matrix,a.userData.transformData&&(h.eulerOrder=a.userData.transformData.eulerOrder))}),h.transform||(h.transform=new aX),"PreRotation"in f&&(h.preRotation=f.PreRotation.value),"PostRotation"in f&&(h.postRotation=f.PostRotation.value),b[d]=h}}b[d]&&(b[d][h.attr]=h)}else if(void 0!==h.curves.morph){if(void 0===b[d]){let a=f.get(c.ID).parents.filter(function(a){return void 0!==a.relationship})[0].ID,g=f.get(a).parents[0].ID,h=f.get(g).parents[0].ID,i=f.get(h).parents[0].ID,j=e.Objects.Model[i],k={modelName:j.attrName?ep.sanitizeNodeName(j.attrName):"",morphName:e.Objects.Deformer[a].attrName};b[d]=k}b[d][h.attr]=h}}}),c.set(parseInt(d),b))}return c}parseAnimStacks(a){let b=e.Objects.AnimationStack,c={};for(let d in b){let e=f.get(parseInt(d)).children;e.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");let g=a.get(e[0].ID);c[d]={name:b[d].attrName,layer:g}}return c}addClip(a){let b=[],c=this;return a.layer.forEach(function(a){b=b.concat(c.generateTracks(a))}),new dR(a.name,-1,b)}generateTracks(a){let b=[],c=new at,d=new at;if(a.transform&&a.transform.decompose(c,new as,d),c=c.toArray(),d=d.toArray(),void 0!==a.T&&Object.keys(a.T.curves).length>0){let d=this.generateVectorTrack(a.modelName,a.T.curves,c,"position");void 0!==d&&b.push(d)}if(void 0!==a.R&&Object.keys(a.R.curves).length>0){let c=this.generateRotationTrack(a.modelName,a.R.curves,a.preRotation,a.postRotation,a.eulerOrder);void 0!==c&&b.push(c)}if(void 0!==a.S&&Object.keys(a.S.curves).length>0){let c=this.generateVectorTrack(a.modelName,a.S.curves,d,"scale");void 0!==c&&b.push(c)}if(void 0!==a.DeformPercent){let c=this.generateMorphTrack(a);void 0!==c&&b.push(c)}return b}generateVectorTrack(a,b,c,d){let e=this.getTimesForAllAxes(b),f=this.getKeyframeTrackValues(e,b,c);return new dQ(a+"."+d,e,f)}generateRotationTrack(a,b,c,d,e){let f,g;if(void 0!==b.x&&void 0!==b.y&&void 0!==b.z){let a=this.interpolateRotations(b.x,b.y,b.z,e);f=a[0],g=a[1]}void 0!==c&&((c=c.map($.degToRad)).push(e),c=new a5().fromArray(c),c=new as().setFromEuler(c)),void 0!==d&&((d=d.map($.degToRad)).push(e),d=new a5().fromArray(d),d=new as().setFromEuler(d).invert());let h=new as,i=new a5,j=[];if(!g||!f)return new dO(a+".quaternion",[0],[0]);for(let a=0;a<g.length;a+=3)i.set(g[a],g[a+1],g[a+2],e),h.setFromEuler(i),void 0!==c&&h.premultiply(c),void 0!==d&&h.multiply(d),a>2&&0>new as().fromArray(j,(a-3)/3*4).dot(h)&&h.set(-h.x,-h.y,-h.z,-h.w),h.toArray(j,a/3*4);return new dO(a+".quaternion",f,j)}generateMorphTrack(a){let b=a.DeformPercent.curves.morph,c=b.values.map(function(a){return a/100}),d=g.getObjectByName(a.modelName).morphTargetDictionary[a.morphName];return new dM(a.modelName+".morphTargetInfluences["+d+"]",b.times,c)}getTimesForAllAxes(a){let b=[];if(void 0!==a.x&&(b=b.concat(a.x.times)),void 0!==a.y&&(b=b.concat(a.y.times)),void 0!==a.z&&(b=b.concat(a.z.times)),(b=b.sort(function(a,b){return a-b})).length>1){let a=1,c=b[0];for(let d=1;d<b.length;d++){let e=b[d];e!==c&&(b[a]=e,c=e,a++)}b=b.slice(0,a)}return b}getKeyframeTrackValues(a,b,c){let d=[],e=-1,f=-1,g=-1;return a.forEach(function(a){if(b.x&&(e=b.x.times.indexOf(a)),b.y&&(f=b.y.times.indexOf(a)),b.z&&(g=b.z.times.indexOf(a)),-1!==e){let a=b.x.values[e];d.push(a),c[0]=a}else d.push(c[0]);if(-1!==f){let a=b.y.values[f];d.push(a),c[1]=a}else d.push(c[1]);if(-1!==g){let a=b.z.values[g];d.push(a),c[2]=a}else d.push(c[2])}),d}interpolateRotations(a,b,c,d){let e=[],f=[];e.push(a.times[0]),f.push($.degToRad(a.values[0])),f.push($.degToRad(b.values[0])),f.push($.degToRad(c.values[0]));for(let g=1;g<a.values.length;g++){let h=[a.values[g-1],b.values[g-1],c.values[g-1]];if(isNaN(h[0])||isNaN(h[1])||isNaN(h[2]))continue;let i=h.map($.degToRad),j=[a.values[g],b.values[g],c.values[g]];if(isNaN(j[0])||isNaN(j[1])||isNaN(j[2]))continue;let k=j.map($.degToRad),l=[j[0]-h[0],j[1]-h[1],j[2]-h[2]],m=[Math.abs(l[0]),Math.abs(l[1]),Math.abs(l[2])];if(m[0]>=180||m[1]>=180||m[2]>=180){let b=Math.max(...m)/180,c=new a5(...i,d),h=new a5(...k,d),j=new as().setFromEuler(c),l=new as().setFromEuler(h);j.dot(l)&&l.set(-l.x,-l.y,-l.z,-l.w);let n=a.times[g-1],o=a.times[g]-n,p=new as,q=new a5;for(let a=0;a<1;a+=1/b)p.copy(j.clone().slerp(l.clone(),a)),e.push(n+a*o),q.setFromQuaternion(p,d),f.push(q.x),f.push(q.y),f.push(q.z)}else e.push(a.times[g]),f.push($.degToRad(a.values[g])),f.push($.degToRad(b.values[g])),f.push($.degToRad(c.values[g]))}return[e,f]}}class e${getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(a){this.nodeStack.push(a),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(a,b){this.currentProp=a,this.currentPropName=b}parse(a){this.currentIndent=0,this.allNodes=new e1,this.nodeStack=[],this.currentProp=[],this.currentPropName="";let b=this,c=a.split(/[\r\n]+/);return c.forEach(function(a,d){let e=a.match(/^[\s\t]*;/),f=a.match(/^[\s\t]*$/);if(e||f)return;let g=a.match("^\\t{"+b.currentIndent+"}(\\w+):(.*){",""),h=a.match("^\\t{"+b.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),i=a.match("^\\t{"+(b.currentIndent-1)+"}}");g?b.parseNodeBegin(a,g):h?b.parseNodeProperty(a,h,c[++d]):i?b.popStack():a.match(/^[^\s\t}]/)&&b.parseNodePropertyContinued(a)}),this.allNodes}parseNodeBegin(a,b){let c=b[1].trim().replace(/^"/,"").replace(/"$/,""),d=b[2].split(",").map(function(a){return a.trim().replace(/^"/,"").replace(/"$/,"")}),e={name:c},f=this.parseNodeAttr(d),g=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(c,e):c in g?("PoseNode"===c?g.PoseNode.push(e):void 0!==g[c].id&&(g[c]={},g[c][g[c].id]=g[c]),""!==f.id&&(g[c][f.id]=e)):"number"==typeof f.id?(g[c]={},g[c][f.id]=e):"Properties70"!==c&&("PoseNode"===c?g[c]=[e]:g[c]=e),"number"==typeof f.id&&(e.id=f.id),""!==f.name&&(e.attrName=f.name),""!==f.type&&(e.attrType=f.type),this.pushStack(e)}parseNodeAttr(a){let b=a[0];""!==a[0]&&isNaN(b=parseInt(a[0]))&&(b=a[0]);let c="",d="";return a.length>1&&(c=a[1].replace(/^(\w+)::/,""),d=a[2]),{id:b,name:c,type:d}}parseNodeProperty(a,b,c){let d=b[1].replace(/^"/,"").replace(/"$/,"").trim(),e=b[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===d&&","===e&&(e=c.replace(/"/g,"").replace(/,$/,"").trim());let f=this.getCurrentNode();if("Properties70"===f.name)return void this.parseNodeSpecialProperty(a,d,e);if("C"===d){let a=e.split(",").slice(1),b=parseInt(a[0]),c=parseInt(a[1]),g=e.split(",").slice(3);g=g.map(function(a){return a.trim().replace(/^"/,"")}),d="connections",function(a,b){for(let c=0,d=a.length,e=b.length;c<e;c++,d++)a[d]=b[c]}(e=[b,c],g),void 0===f[d]&&(f[d]=[])}"Node"===d&&(f.id=e),d in f&&Array.isArray(f[d])?f[d].push(e):"a"!==d?f[d]=e:f.a=e,this.setCurrentProp(f,d),"a"===d&&","!==e.slice(-1)&&(f.a=fa(e))}parseNodePropertyContinued(a){let b=this.getCurrentNode();b.a+=a,","!==a.slice(-1)&&(b.a=fa(b.a))}parseNodeSpecialProperty(a,b,c){let d=c.split('",').map(function(a){return a.trim().replace(/^\"/,"").replace(/\s/,"_")}),e=d[0],f=d[1],g=d[2],h=d[3],i=d[4];switch(f){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":i=parseFloat(i);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":i=fa(i)}this.getPrevNode()[e]={type:f,type2:g,flag:h,value:i},this.setCurrentProp(this.getPrevNode(),e)}}class e_{parse(a){let b=new e0(a);b.skip(23);let c=b.getUint32();if(c<6400)throw Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+c);let d=new e1;for(;!this.endOfContent(b);){let a=this.parseNode(b,c);null!==a&&d.add(a.name,a)}return d}endOfContent(a){return a.size()%16==0?(a.getOffset()+160+16&-16)>=a.size():a.getOffset()+160+16>=a.size()}parseNode(a,b){let c={},d=b>=7500?a.getUint64():a.getUint32(),e=b>=7500?a.getUint64():a.getUint32();b>=7500?a.getUint64():a.getUint32();let f=a.getUint8(),g=a.getString(f);if(0===d)return null;let h=[];for(let b=0;b<e;b++)h.push(this.parseProperty(a));let i=h.length>0?h[0]:"",j=h.length>1?h[1]:"",k=h.length>2?h[2]:"";for(c.singleProperty=1===e&&a.getOffset()===d;d>a.getOffset();){let d=this.parseNode(a,b);null!==d&&this.parseSubNode(g,c,d)}return c.propertyList=h,"number"==typeof i&&(c.id=i),""!==j&&(c.attrName=j),""!==k&&(c.attrType=k),""!==g&&(c.name=g),c}parseSubNode(a,b,c){if(!0===c.singleProperty){let a=c.propertyList[0];Array.isArray(a)?(b[c.name]=c,c.a=a):b[c.name]=a}else if("Connections"===a&&"C"===c.name){let a=[];c.propertyList.forEach(function(b,c){0!==c&&a.push(b)}),void 0===b.connections&&(b.connections=[]),b.connections.push(a)}else if("Properties70"===c.name)Object.keys(c).forEach(function(a){b[a]=c[a]});else if("Properties70"===a&&"P"===c.name){let a,d=c.propertyList[0],e=c.propertyList[1],f=c.propertyList[2],g=c.propertyList[3];0===d.indexOf("Lcl ")&&(d=d.replace("Lcl ","Lcl_")),0===e.indexOf("Lcl ")&&(e=e.replace("Lcl ","Lcl_")),a="Color"===e||"ColorRGB"===e||"Vector"===e||"Vector3D"===e||0===e.indexOf("Lcl_")?[c.propertyList[4],c.propertyList[5],c.propertyList[6]]:c.propertyList[4],b[d]={type:e,type2:f,flag:g,value:a}}else void 0===b[c.name]?"number"==typeof c.id?(b[c.name]={},b[c.name][c.id]=c):b[c.name]=c:"PoseNode"===c.name?(Array.isArray(b[c.name])||(b[c.name]=[b[c.name]]),b[c.name].push(c)):void 0===b[c.name][c.id]&&(b[c.name][c.id]=c)}parseProperty(a){let b,c=a.getString(1);switch(c){case"C":return a.getBoolean();case"D":return a.getFloat64();case"F":return a.getFloat32();case"I":return a.getInt32();case"L":return a.getInt64();case"R":return b=a.getUint32(),a.getArrayBuffer(b);case"S":return b=a.getUint32(),a.getString(b);case"Y":return a.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var d,e,f;let g=a.getUint32(),h=a.getUint32(),i=a.getUint32();if(0===h)switch(c){case"b":case"c":return a.getBooleanArray(g);case"d":return a.getFloat64Array(g);case"f":return a.getFloat32Array(g);case"i":return a.getInt32Array(g);case"l":return a.getInt64Array(g)}let j=new e0(eR((d=new Uint8Array(a.getArrayBuffer(i))).subarray((f=void 0,((15&d[0])!=8||d[0]>>4>7||(d[0]<<8|d[1])%31)&&eQ(6,"invalid zlib data"),(d[1]>>5&1)==+!f&&eQ(6,"invalid zlib data: "+(32&d[1]?"need":"unexpected")+" dictionary"),(d[1]>>3&4)+2),-4),{i:2},e&&e.out,e&&e.dictionary).buffer);switch(c){case"b":case"c":return j.getBooleanArray(g);case"d":return j.getFloat64Array(g);case"f":return j.getFloat32Array(g);case"i":return j.getInt32Array(g);case"l":return j.getInt64Array(g)}break;default:throw Error("THREE.FBXLoader: Unknown property type "+c)}}}class e0{constructor(a,b){this.dv=new DataView(a),this.offset=0,this.littleEndian=void 0===b||b,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(a){this.offset+=a}getBoolean(){return(1&this.getUint8())==1}getBooleanArray(a){let b=[];for(let c=0;c<a;c++)b.push(this.getBoolean());return b}getUint8(){let a=this.dv.getUint8(this.offset);return this.offset+=1,a}getInt16(){let a=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,a}getInt32(){let a=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,a}getInt32Array(a){let b=[];for(let c=0;c<a;c++)b.push(this.getInt32());return b}getUint32(){let a=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,a}getInt64(){let a,b;return(this.littleEndian?(a=this.getUint32(),b=this.getUint32()):(b=this.getUint32(),a=this.getUint32()),0x80000000&b)?(b=~b,0xffffffff==(a=~a)&&(b=b+1|0),-(0x100000000*b+(a=a+1|0))):0x100000000*b+a}getInt64Array(a){let b=[];for(let c=0;c<a;c++)b.push(this.getInt64());return b}getUint64(){let a,b;return this.littleEndian?(a=this.getUint32(),b=this.getUint32()):(b=this.getUint32(),a=this.getUint32()),0x100000000*b+a}getFloat32(){let a=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,a}getFloat32Array(a){let b=[];for(let c=0;c<a;c++)b.push(this.getFloat32());return b}getFloat64(){let a=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,a}getFloat64Array(a){let b=[];for(let c=0;c<a;c++)b.push(this.getFloat64());return b}getArrayBuffer(a){let b=this.dv.buffer.slice(this.offset,this.offset+a);return this.offset+=a,b}getString(a){let b=this.offset,c=new Uint8Array(this.dv.buffer,b,a);this.skip(a);let d=c.indexOf(0);return d>=0&&(c=new Uint8Array(this.dv.buffer,b,d)),this._textDecoder.decode(c)}}class e1{add(a,b){this[a]=b}}function e2(a){let b=a.match(/FBXVersion: (\d+)/);if(b)return parseInt(b[1]);throw Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function e3(a){return a/46186158e3}let e4=[];function e5(a,b,c,d){let e;switch(d.mappingType){case"ByPolygonVertex":e=a;break;case"ByPolygon":e=b;break;case"ByVertice":e=c;break;case"AllSame":e=d.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+d.mappingType)}"IndexToDirect"===d.referenceType&&(e=d.indices[e]);let f=e*d.dataSize,g=f+d.dataSize;var h=e4,i=d.buffer,j=f,k=g;for(let a=j,b=0;a<k;a++,b++)h[b]=i[a];return h}let e6=new a5,e7=new at;function e8(a){let b=new aX,c=new aX,d=new aX,e=new aX,f=new aX,g=new aX,h=new aX,i=new aX,j=new aX,k=new aX,l=new aX,m=new aX,n=a.inheritType?a.inheritType:0;if(a.translation&&b.setPosition(e7.fromArray(a.translation)),a.preRotation){let b=a.preRotation.map($.degToRad);b.push(a.eulerOrder||a5.DEFAULT_ORDER),c.makeRotationFromEuler(e6.fromArray(b))}if(a.rotation){let b=a.rotation.map($.degToRad);b.push(a.eulerOrder||a5.DEFAULT_ORDER),d.makeRotationFromEuler(e6.fromArray(b))}if(a.postRotation){let b=a.postRotation.map($.degToRad);b.push(a.eulerOrder||a5.DEFAULT_ORDER),e.makeRotationFromEuler(e6.fromArray(b)),e.invert()}a.scale&&f.scale(e7.fromArray(a.scale)),a.scalingOffset&&h.setPosition(e7.fromArray(a.scalingOffset)),a.scalingPivot&&g.setPosition(e7.fromArray(a.scalingPivot)),a.rotationOffset&&i.setPosition(e7.fromArray(a.rotationOffset)),a.rotationPivot&&j.setPosition(e7.fromArray(a.rotationPivot)),a.parentMatrixWorld&&(l.copy(a.parentMatrix),k.copy(a.parentMatrixWorld));let o=c.clone().multiply(d).multiply(e),p=new aX;p.extractRotation(k);let q=new aX;q.copyPosition(k);let r=q.clone().invert().multiply(k),s=p.clone().invert().multiply(r),t=new aX;if(0===n)t.copy(p).multiply(o).multiply(s).multiply(f);else if(1===n)t.copy(p).multiply(s).multiply(o).multiply(f);else{let a=new aX().scale(new at().setFromMatrixScale(l)).clone().invert(),b=s.clone().multiply(a);t.copy(p).multiply(o).multiply(b).multiply(f)}let u=j.clone().invert(),v=g.clone().invert(),w=b.clone().multiply(i).multiply(j).multiply(c).multiply(d).multiply(e).multiply(u).multiply(h).multiply(g).multiply(f).multiply(v),x=new aX().copyPosition(w),y=k.clone().multiply(x);return m.copyPosition(y),(w=m.clone().multiply(t)).premultiply(k.invert()),w}function e9(a){let b=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(a=a||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),b[0]):b[a]}function fa(a){return a.split(",").map(function(a){return parseFloat(a)})}function fb(a,b,c){return void 0===b&&(b=0),void 0===c&&(c=a.byteLength),new TextDecoder().decode(new Uint8Array(a,b,c))}THREE.FBXLoader=eW,AFRAME.registerComponent("fbx-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){let a=this.data;if(!a.src)return;this.remove();let b=new THREE.FBXLoader;a.crossorigin&&b.setCrossOrigin(a.crossorigin),b.load(a.src,this.load.bind(this))},load:function(a){this.model=a,this.el.setObject3D("mesh",a),this.el.emit("model-loaded",{format:"fbx",model:a})},remove:function(){this.model&&this.el.removeObject3D("mesh")}}),c(9173),c(5012),c(2086),c(2332),c(9187),c(2704),c(8435),c(7829);var fc=c(4546);class fd{static roundNumber(a,b){let c=Math.pow(10,b);return Math.round(a*c)/c}static sample(a){return a[Math.floor(Math.random()*a.length)]}static distanceToSquared(a,b){var c=a.x-b.x,d=a.y-b.y,e=a.z-b.z;return c*c+d*d+e*e}static isPointInPoly(a,b){for(var c=!1,d=-1,e=a.length,f=e-1;++d<e;f=d)(a[d].z<=b.z&&b.z<a[f].z||a[f].z<=b.z&&b.z<a[d].z)&&b.x<(a[f].x-a[d].x)*(b.z-a[d].z)/(a[f].z-a[d].z)+a[d].x&&(c=!c);return c}static isVectorInPolygon(a,b,c){var d=1e5,e=-1e5,f=[];return b.vertexIds.forEach(a=>{d=Math.min(c[a].y,d),e=Math.max(c[a].y,e),f.push(c[a])}),!!(a.y<e+.5&&a.y>d-.5&&this.isPointInPoly(f,a))}static triarea2(a,b,c){return(c.x-a.x)*(b.z-a.z)-(b.x-a.x)*(c.z-a.z)}static vequal(a,b){return 1e-5>this.distanceToSquared(a,b)}static mergeVertices(a,b=1e-4){b=Math.max(b,Number.EPSILON);for(var c={},d=a.getIndex(),e=a.getAttribute("position"),f=d?d.count:e.count,g=0,h=[],i=[],j=Math.log10(1/b),k=Math.pow(10,j),l=0;l<f;l++){var m=d?d.getX(l):l,n="";(n+=~~(e.getX(m)*k)+","+~~(e.getY(m)*k)+","+~~(e.getZ(m)*k)+",")in c?h.push(c[n]):(i.push(e.getX(m)),i.push(e.getY(m)),i.push(e.getZ(m)),c[n]=g,h.push(g),g++)}let o=new fc.THS(new Float32Array(i),e.itemSize,e.normalized),p=new fc.LoY;return p.setAttribute("position",o),p.setIndex(h),p}}class fe{constructor(a){this.content=[],this.scoreFunction=a}push(a){this.content.push(a),this.sinkDown(this.content.length-1)}pop(){let a=this.content[0],b=this.content.pop();return this.content.length>0&&(this.content[0]=b,this.bubbleUp(0)),a}remove(a){let b=this.content.indexOf(a),c=this.content.pop();b!==this.content.length-1&&(this.content[b]=c,this.scoreFunction(c)<this.scoreFunction(a)?this.sinkDown(b):this.bubbleUp(b))}size(){return this.content.length}rescoreElement(a){this.sinkDown(this.content.indexOf(a))}sinkDown(a){let b=this.content[a];for(;a>0;){let c=(a+1>>1)-1,d=this.content[c];if(!(this.scoreFunction(b)<this.scoreFunction(d)))break;this.content[c]=b,this.content[a]=d,a=c}}bubbleUp(a){let b=this.content.length,c=this.content[a],d=this.scoreFunction(c);for(;;){let e=a+1<<1,f=e-1,g,h=null;if(f<b&&(g=this.scoreFunction(this.content[f]))<d&&(h=f),e<b&&this.scoreFunction(this.content[e])<(null===h?d:g)&&(h=e),null===h)break;this.content[a]=this.content[h],this.content[h]=c,a=h}}}class ff{constructor(){this.portals=[]}push(a,b){void 0===b&&(b=a),this.portals.push({left:a,right:b})}stringPull(){let a=this.portals,b=[],c,d,e,f=0,g=0,h=0;c=a[0].left,d=a[0].left,e=a[0].right,b.push(c);for(let i=1;i<a.length;i++){let j=a[i].left,k=a[i].right;if(0>=fd.triarea2(c,e,k)){if(!(fd.vequal(c,e)||fd.triarea2(c,d,k)>0)){b.push(d),c=d,f=g,d=c,e=c,g=f,h=f,i=f;continue}e=k,h=i}if(fd.triarea2(c,d,j)>=0){if(!(fd.vequal(c,d)||0>fd.triarea2(c,e,j))){b.push(e),c=e,f=h,d=c,e=c,g=f,h=f,i=f;continue}d=j,g=i}}return 0!==b.length&&fd.vequal(b[b.length-1],a[a.length-1].left)||b.push(a[a.length-1].left),this.path=b,b}}class fg{constructor(){this.zones={}}static createZone(a,b=1e-4){return(class{static buildZone(a,b){let c=this._buildNavigationMesh(a,b),d={};c.vertices.forEach(a=>{a.x=fd.roundNumber(a.x,2),a.y=fd.roundNumber(a.y,2),a.z=fd.roundNumber(a.z,2)}),d.vertices=c.vertices;let e=this._buildPolygonGroups(c);return d.groups=Array(e.length),e.forEach((a,b)=>{let c=new Map;a.forEach((a,b)=>{c.set(a,b)});let e=Array(a.length);a.forEach((a,b)=>{let f=[];a.neighbours.forEach(a=>f.push(c.get(a)));let g=[];a.neighbours.forEach(b=>g.push(this._getSharedVerticesInOrder(a,b)));let h=new fc.Pq0(0,0,0);h.add(d.vertices[a.vertexIds[0]]),h.add(d.vertices[a.vertexIds[1]]),h.add(d.vertices[a.vertexIds[2]]),h.divideScalar(3),h.x=fd.roundNumber(h.x,2),h.y=fd.roundNumber(h.y,2),h.z=fd.roundNumber(h.z,2),e[b]={id:b,neighbours:f,vertexIds:a.vertexIds,centroid:h,portals:g}}),d.groups[b]=e}),d}static _buildNavigationMesh(a,b){return a=fd.mergeVertices(a,b),this._buildPolygonsFromGeometry(a)}static _spreadGroupId(a){let b=new Set([a]);for(;b.size>0;){let c=b;b=new Set,c.forEach(c=>{c.group=a.group,c.neighbours.forEach(a=>{void 0===a.group&&b.add(a)})})}}static _buildPolygonGroups(a){let b=[];return a.polygons.forEach(a=>{void 0!==a.group?b[a.group].push(a):(a.group=b.length,this._spreadGroupId(a),b.push([a]))}),b}static _buildPolygonNeighbours(a,b){let c=new Set,d=b[a.vertexIds[1]],e=b[a.vertexIds[2]];return b[a.vertexIds[0]].forEach(b=>{b!==a&&(d.includes(b)||e.includes(b))&&c.add(b)}),d.forEach(b=>{b!==a&&e.includes(b)&&c.add(b)}),c}static _buildPolygonsFromGeometry(a){let b=[],c=[],d=a.attributes.position,e=a.index,f=[];for(let a=0;a<d.count;a++)c.push((new fc.Pq0).fromBufferAttribute(d,a)),f[a]=[];for(let c=0;c<a.index.count;c+=3){let a=e.getX(c),d=e.getX(c+1),g=e.getX(c+2),h={vertexIds:[a,d,g],neighbours:null};b.push(h),f[a].push(h),f[d].push(h),f[g].push(h)}return b.forEach(a=>{a.neighbours=this._buildPolygonNeighbours(a,f)}),{polygons:b,vertices:c}}static _getSharedVerticesInOrder(a,b){let c=a.vertexIds,d=c[0],e=c[1],f=c[2],g=b.vertexIds,h=g.includes(d),i=g.includes(e),j=g.includes(f);return h&&i&&j?Array.from(c):h&&i?[d,e]:i&&j?[e,f]:h&&j?[f,d]:(console.warn("Error processing navigation mesh neighbors; neighbors with <2 shared vertices found."),[])}}).buildZone(a,b)}setZoneData(a,b){this.zones[a]=b}getRandomNode(a,b,c,d){if(!this.zones[a])return new fc.Pq0;c=c||null,d=d||0;let e=[];return this.zones[a].groups[b].forEach(a=>{c&&d?fd.distanceToSquared(c,a.centroid)<d*d&&e.push(a.centroid):e.push(a.centroid)}),fd.sample(e)||new fc.Pq0}getClosestNode(a,b,c,d=!1){let e=this.zones[b].vertices,f=null,g=1/0;return this.zones[b].groups[c].forEach(b=>{let c=fd.distanceToSquared(b.centroid,a);c<g&&(!d||fd.isVectorInPolygon(a,b,e))&&(f=b,g=c)}),f}findPath(a,b,c,d){let e=this.zones[c].groups[d],f=this.zones[c].vertices,g=this.getClosestNode(a,c,d,!0),h=this.getClosestNode(b,c,d,!0);if(!g||!h)return null;let i=(class{static init(a){for(let b=0;b<a.length;b++){let c=a[b];c.f=0,c.g=0,c.h=0,c.cost=1,c.visited=!1,c.closed=!1,c.parent=null}}static cleanUp(a){for(let b=0;b<a.length;b++){let c=a[b];delete c.f,delete c.g,delete c.h,delete c.cost,delete c.visited,delete c.closed,delete c.parent}}static heap(){return new fe(function(a){return a.f})}static search(a,b,c){this.init(a);let d=this.heap();for(d.push(b);d.size()>0;){let b=d.pop();if(b===c){let a=b,c=[];for(;a.parent;)c.push(a),a=a.parent;return this.cleanUp(c),c.reverse()}b.closed=!0;let e=this.neighbours(a,b);for(let a=0,f=e.length;a<f;a++){let f=e[a];if(f.closed)continue;let g=b.g+f.cost,h=f.visited;if(!h||g<f.g){if(f.visited=!0,f.parent=b,!f.centroid||!c.centroid)throw Error("Unexpected state");f.h=f.h||this.heuristic(f.centroid,c.centroid),f.g=g,f.f=f.g+f.h,h?d.rescoreElement(f):d.push(f)}}}return[]}static heuristic(a,b){return fd.distanceToSquared(a,b)}static neighbours(a,b){let c=[];for(let d=0;d<b.neighbours.length;d++)c.push(a[b.neighbours[d]]);return c}}).search(e,g,h),j=new ff;j.push(a);for(let a=0;a<i.length;a++){let b=i[a],c=i[a+1];if(c){let a=function(a,b){for(var c=0;c<a.neighbours.length;c++)if(a.neighbours[c]===b.id)return a.portals[c]}(b,c);j.push(f[a[0]],f[a[1]])}}j.push(b),j.stringPull();let k=j.path.map(a=>new fc.Pq0(a.x,a.y,a.z));return k.shift(),k}}fg.prototype.getGroup=function(){let a=new fc.Zcv;return function(b,c,d=!1){if(!this.zones[b])return null;let e=null,f=2500,g=this.zones[b];for(let b=0;b<g.groups.length;b++)for(let h of g.groups[b]){if(d&&(a.setFromCoplanarPoints(g.vertices[h.vertexIds[0]],g.vertices[h.vertexIds[1]],g.vertices[h.vertexIds[2]]),.01>Math.abs(a.distanceToPoint(c)))&&fd.isPointInPoly([g.vertices[h.vertexIds[0]],g.vertices[h.vertexIds[1]],g.vertices[h.vertexIds[2]]],c))return b;let i=fd.distanceToSquared(h.centroid,c);i<f&&(e=b,f=i)}return e}}(),fg.prototype.clampStep=function(){let a=new fc.Pq0,b=new fc.Zcv,c=new fc.lMl,d=new fc.Pq0,e,f,g=new fc.Pq0;return function(h,i,j,k,l,m){let n=this.zones[k].vertices,o=this.zones[k].groups[l],p=[j],q={};q[j.id]=0,e=void 0,g.set(0,0,0),f=1/0,b.setFromCoplanarPoints(n[j.vertexIds[0]],n[j.vertexIds[1]],n[j.vertexIds[2]]),b.projectPoint(i,a),d.copy(a);for(let b=p.pop();b;b=p.pop()){c.set(n[b.vertexIds[0]],n[b.vertexIds[1]],n[b.vertexIds[2]]),c.closestPointToPoint(d,a),a.distanceToSquared(d)<f&&(e=b,g.copy(a),f=a.distanceToSquared(d));let h=q[b.id];if(!(h>2))for(let a=0;a<b.neighbours.length;a++){let c=o[b.neighbours[a]];c.id in q||(p.push(c),q[c.id]=h+1)}}return m.copy(g),e}}(),fc.B69;let fh=new fg,fi="level";AFRAME.registerSystem("nav",{init:function(){this.navMesh=null,this.agents=new Set},setNavMeshGeometry:function(a){this.navMesh=new THREE.Mesh(a),fh.setZoneData(fi,fg.createZone(a)),Array.from(this.agents).forEach(a=>a.updateNavLocation())},getNavMesh:function(){return this.navMesh},addAgent:function(a){this.agents.add(a)},removeAgent:function(a){this.agents.delete(a)},getPath:function(a,b,c){return this.navMesh?fh.findPath(a,b,fi,c):null},getGroup:function(a){return this.navMesh?fh.getGroup(fi,a):null},getNode:function(a,b){return this.navMesh?fh.getClosestNode(a,fi,b,!0):null},clampStep:function(a,b,c,d,e){return this.navMesh?d?fh.clampStep(a,b,d,fi,c,e):(e.copy(b),this.getNode(b,c)):(e.copy(b),null)}}),c(5994),c(7450),c(2136)},750:()=>{let a={once:THREE.LoopOnce,repeat:THREE.LoopRepeat,pingpong:THREE.LoopPingPong};function b(a){return a.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}AFRAME.registerComponent("animation-mixer",{schema:{clip:{default:"*"},useRegExp:{default:!1},duration:{default:0},clampWhenFinished:{default:!1,type:"boolean"},crossFadeDuration:{default:0},loop:{default:"repeat",oneOf:Object.keys(a)},repetitions:{default:1/0,min:0},timeScale:{default:1},startAt:{default:0}},init:function(){this.model=null,this.mixer=null,this.activeActions=[];let a=this.el.getObject3D("mesh");a?this.load(a):this.el.addEventListener("model-loaded",a=>{this.load(a.detail.model)})},load:function(a){let b=this.el;this.model=a,this.mixer=new THREE.AnimationMixer(a),this.mixer.addEventListener("loop",a=>{b.emit("animation-loop",{action:a.action,loopDelta:a.loopDelta})}),this.mixer.addEventListener("finished",a=>{b.emit("animation-finished",{action:a.action,direction:a.direction})}),this.data.clip&&this.update({})},remove:function(){this.mixer&&this.mixer.stopAllAction()},update:function(b){if(!b)return;let c=this.data,d=AFRAME.utils.diff(c,b);if("clip"in d){this.stopAction(),c.clip&&this.playAction();return}this.activeActions.forEach(b=>{"duration"in d&&c.duration&&b.setDuration(c.duration),"clampWhenFinished"in d&&(b.clampWhenFinished=c.clampWhenFinished),("loop"in d||"repetitions"in d)&&b.setLoop(a[c.loop],c.repetitions),"timeScale"in d&&b.setEffectiveTimeScale(c.timeScale)})},stopAction:function(){let a=this.data;for(let b=0;b<this.activeActions.length;b++)a.crossFadeDuration?this.activeActions[b].fadeOut(a.crossFadeDuration):this.activeActions[b].stop();this.activeActions.length=0},playAction:function(){if(!this.mixer)return;let c=this.model,d=this.data,e=c.animations||(c.geometry||{}).animations||[];if(!e.length)return;let f=d.useRegExp?d.clip:RegExp("^"+d.clip.split(/\*+/).map(b).join(".*")+"$");for(let b,g=0;b=e[g];g++)if(b.name.match(f)){let e=this.mixer.clipAction(b,c);e.enabled=!0,e.clampWhenFinished=d.clampWhenFinished,d.duration&&e.setDuration(d.duration),1!==d.timeScale&&e.setEffectiveTimeScale(d.timeScale),e.startAt(this.mixer.time-d.startAt/1e3),e.setLoop(a[d.loop],d.repetitions).fadeIn(d.crossFadeDuration).play(),this.activeActions.push(e)}},tick:function(a,b){this.mixer&&!isNaN(b)&&this.mixer.update(b/1e3)}})},808:()=>{!function(a){var b,c,d="KeyboardEvent"in a;d||(a.KeyboardEvent=function(){throw TypeError("Illegal constructor")}),"DOM_KEY_LOCATION_STANDARD"in a.KeyboardEvent||(a.KeyboardEvent.DOM_KEY_LOCATION_STANDARD=0),"DOM_KEY_LOCATION_LEFT"in a.KeyboardEvent||(a.KeyboardEvent.DOM_KEY_LOCATION_LEFT=1),"DOM_KEY_LOCATION_RIGHT"in a.KeyboardEvent||(a.KeyboardEvent.DOM_KEY_LOCATION_RIGHT=2),"DOM_KEY_LOCATION_NUMPAD"in a.KeyboardEvent||(a.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD=3);var e=window.KeyboardEvent.DOM_KEY_LOCATION_STANDARD,f=window.KeyboardEvent.DOM_KEY_LOCATION_LEFT,g=window.KeyboardEvent.DOM_KEY_LOCATION_RIGHT,h=window.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD;function i(a,b){return -1!==String(a).indexOf(b)}var j=i(navigator.platform,"Win")?"win":i(navigator.platform,"Mac")?"mac":i(navigator.platform,"CrOS")?"cros":i(navigator.platform,"Linux")?"linux":i(navigator.userAgent,"iPad")||i(navigator.platform,"iPod")||i(navigator.platform,"iPhone")?"ios":"",k=i(navigator.userAgent,"Chrome/")?"chrome":i(navigator.vendor,"Apple")?"safari":i(navigator.userAgent,"MSIE")?"ie":i(navigator.userAgent,"Gecko/")?"moz":i(navigator.userAgent,"Opera/")?"opera":"",l=k+"-"+j;function m(a,b,c){(l===b||k===b||j===b)&&Object.keys(c).forEach(function(b){a[b]=c[b]})}var n={3:{code:"Cancel"},6:{code:"Help"},8:{code:"Backspace"},9:{code:"Tab"},12:{code:"Clear"},13:{code:"Enter"},16:{code:"Shift"},17:{code:"Control"},18:{code:"Alt"},19:{code:"Pause"},20:{code:"CapsLock"},21:{code:"KanaMode"},22:{code:"HangulMode"},23:{code:"JunjaMode"},24:{code:"FinalMode"},25:{code:"KanjiMode"},27:{code:"Escape"},28:{code:"Convert"},29:{code:"NonConvert"},30:{code:"Accept"},31:{code:"ModeChange"},32:{code:"Space"},33:{code:"PageUp"},34:{code:"PageDown"},35:{code:"End"},36:{code:"Home"},37:{code:"ArrowLeft"},38:{code:"ArrowUp"},39:{code:"ArrowRight"},40:{code:"ArrowDown"},41:{code:"Select"},42:{code:"Print"},43:{code:"Execute"},44:{code:"PrintScreen"},45:{code:"Insert"},46:{code:"Delete"},47:{code:"Help"},48:{code:"Digit0",keyCap:"0"},49:{code:"Digit1",keyCap:"1"},50:{code:"Digit2",keyCap:"2"},51:{code:"Digit3",keyCap:"3"},52:{code:"Digit4",keyCap:"4"},53:{code:"Digit5",keyCap:"5"},54:{code:"Digit6",keyCap:"6"},55:{code:"Digit7",keyCap:"7"},56:{code:"Digit8",keyCap:"8"},57:{code:"Digit9",keyCap:"9"},65:{code:"KeyA",keyCap:"a"},66:{code:"KeyB",keyCap:"b"},67:{code:"KeyC",keyCap:"c"},68:{code:"KeyD",keyCap:"d"},69:{code:"KeyE",keyCap:"e"},70:{code:"KeyF",keyCap:"f"},71:{code:"KeyG",keyCap:"g"},72:{code:"KeyH",keyCap:"h"},73:{code:"KeyI",keyCap:"i"},74:{code:"KeyJ",keyCap:"j"},75:{code:"KeyK",keyCap:"k"},76:{code:"KeyL",keyCap:"l"},77:{code:"KeyM",keyCap:"m"},78:{code:"KeyN",keyCap:"n"},79:{code:"KeyO",keyCap:"o"},80:{code:"KeyP",keyCap:"p"},81:{code:"KeyQ",keyCap:"q"},82:{code:"KeyR",keyCap:"r"},83:{code:"KeyS",keyCap:"s"},84:{code:"KeyT",keyCap:"t"},85:{code:"KeyU",keyCap:"u"},86:{code:"KeyV",keyCap:"v"},87:{code:"KeyW",keyCap:"w"},88:{code:"KeyX",keyCap:"x"},89:{code:"KeyY",keyCap:"y"},90:{code:"KeyZ",keyCap:"z"},91:{code:"OSLeft",location:f},92:{code:"OSRight",location:g},93:{code:"ContextMenu"},95:{code:"Standby"},96:{code:"Numpad0",keyCap:"0",location:h},97:{code:"Numpad1",keyCap:"1",location:h},98:{code:"Numpad2",keyCap:"2",location:h},99:{code:"Numpad3",keyCap:"3",location:h},100:{code:"Numpad4",keyCap:"4",location:h},101:{code:"Numpad5",keyCap:"5",location:h},102:{code:"Numpad6",keyCap:"6",location:h},103:{code:"Numpad7",keyCap:"7",location:h},104:{code:"Numpad8",keyCap:"8",location:h},105:{code:"Numpad9",keyCap:"9",location:h},106:{code:"NumpadMultiply",keyCap:"*",location:h},107:{code:"NumpadAdd",keyCap:"+",location:h},108:{code:"NumpadComma",keyCap:",",location:h},109:{code:"NumpadSubtract",keyCap:"-",location:h},110:{code:"NumpadDecimal",keyCap:".",location:h},111:{code:"NumpadDivide",keyCap:"/",location:h},112:{code:"F1"},113:{code:"F2"},114:{code:"F3"},115:{code:"F4"},116:{code:"F5"},117:{code:"F6"},118:{code:"F7"},119:{code:"F8"},120:{code:"F9"},121:{code:"F10"},122:{code:"F11"},123:{code:"F12"},124:{code:"F13"},125:{code:"F14"},126:{code:"F15"},127:{code:"F16"},128:{code:"F17"},129:{code:"F18"},130:{code:"F19"},131:{code:"F20"},132:{code:"F21"},133:{code:"F22"},134:{code:"F23"},135:{code:"F24"},144:{code:"NumLock",location:h},145:{code:"ScrollLock"},160:{code:"ShiftLeft",location:f},161:{code:"ShiftRight",location:g},162:{code:"ControlLeft",location:f},163:{code:"ControlRight",location:g},164:{code:"AltLeft",location:f},165:{code:"AltRight",location:g},166:{code:"BrowserBack"},167:{code:"BrowserForward"},168:{code:"BrowserRefresh"},169:{code:"BrowserStop"},170:{code:"BrowserSearch"},171:{code:"BrowserFavorites"},172:{code:"BrowserHome"},173:{code:"VolumeMute"},174:{code:"VolumeDown"},175:{code:"VolumeUp"},176:{code:"MediaTrackNext"},177:{code:"MediaTrackPrevious"},178:{code:"MediaStop"},179:{code:"MediaPlayPause"},180:{code:"LaunchMail"},181:{code:"MediaSelect"},182:{code:"LaunchApp1"},183:{code:"LaunchApp2"},186:{code:"Semicolon",keyCap:";"},187:{code:"Equal",keyCap:"="},188:{code:"Comma",keyCap:","},189:{code:"Minus",keyCap:"-"},190:{code:"Period",keyCap:"."},191:{code:"Slash",keyCap:"/"},192:{code:"Backquote",keyCap:"`"},219:{code:"BracketLeft",keyCap:"["},220:{code:"Backslash",keyCap:"\\"},221:{code:"BracketRight",keyCap:"]"},222:{code:"Quote",keyCap:"'"},226:{code:"IntlBackslash",keyCap:"\\"},229:{code:"Process"},246:{code:"Attn"},247:{code:"CrSel"},248:{code:"ExSel"},249:{code:"EraseEof"},250:{code:"Play"},251:{code:"ZoomToggle"},254:{code:"Clear"}};m(n,"moz",{59:{code:"Semicolon",keyCap:";"},61:{code:"Equal",keyCap:"="},107:{code:"Equal",keyCap:"="},109:{code:"Minus",keyCap:"-"},187:{code:"NumpadAdd",keyCap:"+",location:h},189:{code:"NumpadSubtract",keyCap:"-",location:h}}),m(n,"moz-mac",{12:{code:"NumLock",location:h},173:{code:"Minus",keyCap:"-"}}),m(n,"moz-win",{173:{code:"Minus",keyCap:"-"}}),m(n,"chrome-mac",{93:{code:"OSRight",location:g}}),m(n,"safari",{3:{code:"Enter"},25:{code:"Tab"}}),m(n,"ios",{10:{code:"Enter",location:e}}),m(n,"safari-mac",{91:{code:"OSLeft",location:f},93:{code:"OSRight",location:g},229:{code:"KeyQ",keyCap:"Q"}});var o={};"cros"===j&&(o["U+00A0"]={code:"ShiftLeft",location:f},o["U+00A1"]={code:"ShiftRight",location:g},o["U+00A2"]={code:"ControlLeft",location:f},o["U+00A3"]={code:"ControlRight",location:g},o["U+00A4"]={code:"AltLeft",location:f},o["U+00A5"]={code:"AltRight",location:g}),"chrome-mac"===l&&(o["U+0010"]={code:"ContextMenu"}),"safari-mac"===l&&(o["U+0010"]={code:"ContextMenu"}),"ios"===j&&(o["U+0010"]={code:"Function"},o["U+001C"]={code:"ArrowLeft"},o["U+001D"]={code:"ArrowRight"},o["U+001E"]={code:"ArrowUp"},o["U+001F"]={code:"ArrowDown"},o["U+0001"]={code:"Home"},o["U+0004"]={code:"End"},o["U+000B"]={code:"PageUp"},o["U+000C"]={code:"PageDown"});var p=[];p[f]={16:{code:"ShiftLeft",location:f},17:{code:"ControlLeft",location:f},18:{code:"AltLeft",location:f}},p[g]={16:{code:"ShiftRight",location:g},17:{code:"ControlRight",location:g},18:{code:"AltRight",location:g}},p[h]={13:{code:"NumpadEnter",location:h}},m(p[h],"moz",{109:{code:"NumpadSubtract",location:h},107:{code:"NumpadAdd",location:h}}),m(p[f],"moz-mac",{224:{code:"OSLeft",location:f}}),m(p[g],"moz-mac",{224:{code:"OSRight",location:g}}),m(p[g],"moz-win",{91:{code:"OSRight",location:g}}),m(p[g],"mac",{93:{code:"OSRight",location:g}}),m(p[h],"chrome-mac",{12:{code:"NumLock",location:h}}),m(p[h],"safari-mac",{12:{code:"NumLock",location:h},187:{code:"NumpadAdd",location:h},189:{code:"NumpadSubtract",location:h},190:{code:"NumpadDecimal",location:h},191:{code:"NumpadDivide",location:h}});var q={ShiftLeft:{key:"Shift"},ShiftRight:{key:"Shift"},ControlLeft:{key:"Control"},ControlRight:{key:"Control"},AltLeft:{key:"Alt"},AltRight:{key:"Alt"},OSLeft:{key:"OS"},OSRight:{key:"OS"},NumpadEnter:{key:"Enter"},Space:{key:" "},Digit0:{key:"0",shiftKey:")"},Digit1:{key:"1",shiftKey:"!"},Digit2:{key:"2",shiftKey:"@"},Digit3:{key:"3",shiftKey:"#"},Digit4:{key:"4",shiftKey:"$"},Digit5:{key:"5",shiftKey:"%"},Digit6:{key:"6",shiftKey:"^"},Digit7:{key:"7",shiftKey:"&"},Digit8:{key:"8",shiftKey:"*"},Digit9:{key:"9",shiftKey:"("},KeyA:{key:"a",shiftKey:"A"},KeyB:{key:"b",shiftKey:"B"},KeyC:{key:"c",shiftKey:"C"},KeyD:{key:"d",shiftKey:"D"},KeyE:{key:"e",shiftKey:"E"},KeyF:{key:"f",shiftKey:"F"},KeyG:{key:"g",shiftKey:"G"},KeyH:{key:"h",shiftKey:"H"},KeyI:{key:"i",shiftKey:"I"},KeyJ:{key:"j",shiftKey:"J"},KeyK:{key:"k",shiftKey:"K"},KeyL:{key:"l",shiftKey:"L"},KeyM:{key:"m",shiftKey:"M"},KeyN:{key:"n",shiftKey:"N"},KeyO:{key:"o",shiftKey:"O"},KeyP:{key:"p",shiftKey:"P"},KeyQ:{key:"q",shiftKey:"Q"},KeyR:{key:"r",shiftKey:"R"},KeyS:{key:"s",shiftKey:"S"},KeyT:{key:"t",shiftKey:"T"},KeyU:{key:"u",shiftKey:"U"},KeyV:{key:"v",shiftKey:"V"},KeyW:{key:"w",shiftKey:"W"},KeyX:{key:"x",shiftKey:"X"},KeyY:{key:"y",shiftKey:"Y"},KeyZ:{key:"z",shiftKey:"Z"},Numpad0:{key:"0"},Numpad1:{key:"1"},Numpad2:{key:"2"},Numpad3:{key:"3"},Numpad4:{key:"4"},Numpad5:{key:"5"},Numpad6:{key:"6"},Numpad7:{key:"7"},Numpad8:{key:"8"},Numpad9:{key:"9"},NumpadMultiply:{key:"*"},NumpadAdd:{key:"+"},NumpadComma:{key:","},NumpadSubtract:{key:"-"},NumpadDecimal:{key:"."},NumpadDivide:{key:"/"},Semicolon:{key:";",shiftKey:":"},Equal:{key:"=",shiftKey:"+"},Comma:{key:",",shiftKey:"<"},Minus:{key:"-",shiftKey:"_"},Period:{key:".",shiftKey:">"},Slash:{key:"/",shiftKey:"?"},Backquote:{key:"`",shiftKey:"~"},BracketLeft:{key:"[",shiftKey:"{"},Backslash:{key:"\\",shiftKey:"|"},BracketRight:{key:"]",shiftKey:"}"},Quote:{key:"'",shiftKey:'"'},IntlBackslash:{key:"\\",shiftKey:"|"}};m(q,"mac",{OSLeft:{key:"Meta"},OSRight:{key:"Meta"}});var r={Esc:"Escape",Nonconvert:"NonConvert",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Menu:"ContextMenu",MediaNextTrack:"MediaTrackNext",MediaPreviousTrack:"MediaTrackPrevious",SelectMedia:"MediaSelect",HalfWidth:"Hankaku",FullWidth:"Zenkaku",RomanCharacters:"Romaji",Crsel:"CrSel",Exsel:"ExSel",Zoom:"ZoomToggle"},s=(b="code",c={},Object.keys(n).forEach(function(a){var d=n[a];b in d&&(c[d[b]]=d)}),c);try{var t=d&&"location"in new KeyboardEvent("")}catch(a){}function u(a){var b,c="keyCode"in a?a.keyCode:"which"in a?a.which:0,d=function(){if(t||"keyLocation"in a){var b=t?a.location:a.keyLocation;if(b&&c in p[b])return p[b][c]}return"keyIdentifier"in a&&a.keyIdentifier in o?o[a.keyIdentifier]:c in n?n[c]:null}();if(!d)return null;var e=(b=q[d.code])?a.shiftKey&&"shiftKey"in b?b.shiftKey:b.key:d.code;return{code:d.code,key:e,location:d.location,keyCap:d.keyCap}}"KeyboardEvent"in a&&"defineProperty"in Object&&function(){function a(a,b,c){b in a||Object.defineProperty(a,b,c)}if(a(KeyboardEvent.prototype,"code",{get:function(){var a=u(this);return a?a.code:""}}),"key"in KeyboardEvent.prototype){var b=Object.getOwnPropertyDescriptor(KeyboardEvent.prototype,"key");Object.defineProperty(KeyboardEvent.prototype,"key",{get:function(){var a=b.get.call(this);return r.hasOwnProperty(a)?r[a]:a}})}a(KeyboardEvent.prototype,"key",{get:function(){var a=u(this);return a&&"key"in a?a.key:"Unidentified"}}),a(KeyboardEvent.prototype,"location",{get:function(){var a=u(this);return a&&"location"in a?a.location:e}}),a(KeyboardEvent.prototype,"locale",{get:function(){return""}})}(),"queryKeyCap"in a.KeyboardEvent||(a.KeyboardEvent.queryKeyCap=function(a,b){if(a=String(a),!s.hasOwnProperty(a))return"Undefined";if(b&&"en-us"!==String(b).toLowerCase())throw Error("Unsupported locale");var c=s[a];return c.keyCap||c.code||"Undefined"}),a.identifyKey=function(a){if(!("code"in a)){var b=u(a);a.code=b?b.code:"",a.key=b&&"key"in b?b.key:"Unidentified",a.location="location"in a?a.location:"keyLocation"in a?a.keyLocation:b&&"location"in b?b.location:e,a.locale=""}}}(window)},1139:()=>{AFRAME.registerComponent("trackpad-controls",{schema:{enabled:{default:!0},enableNegX:{default:!0},enablePosX:{default:!0},enableNegZ:{default:!0},enablePosZ:{default:!0},mode:{default:"touch",oneOf:["swipe","touch","press"]}},init:function(){this.dVelocity=new THREE.Vector3,this.zVel=0,this.xVel=0,this.bindMethods()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){let a=this.data,b=this.el.sceneEl;switch(b.addEventListener("axismove",this.onAxisMove),a.mode){case"swipe":case"touch":b.addEventListener("trackpadtouchstart",this.onTouchStart),b.addEventListener("trackpadtouchend",this.onTouchEnd);break;case"press":b.addEventListener("trackpaddown",this.onTouchStart),b.addEventListener("trackpadup",this.onTouchEnd)}},removeEventListeners:function(){let a=this.el.sceneEl;a.removeEventListener("axismove",this.onAxisMove),a.removeEventListener("trackpadtouchstart",this.onTouchStart),a.removeEventListener("trackpadtouchend",this.onTouchEnd),a.removeEventListener("trackpaddown",this.onTouchStart),a.removeEventListener("trackpadup",this.onTouchEnd)},isVelocityActive:function(){return this.data.enabled&&this.isMoving},getVelocityDelta:function(){return this.dVelocity.z=this.isMoving?-this.zVel:1,this.dVelocity.x=this.isMoving?this.xVel:1,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onAxisMove=this.onAxisMove.bind(this)},onTouchStart:function(a){switch(this.data.mode){case"swipe":this.canRecordAxis=!0,this.startingAxisData=[];break;case"touch":case"press":this.isMoving=!0}a.preventDefault()},onTouchEnd:function(a){"swipe"==this.data.mode&&(this.startingAxisData=[]),this.isMoving=!1,a.preventDefault()},onAxisMove:function(a){switch(this.data.mode){case"swipe":return this.handleSwipeAxis(a);case"touch":case"press":return this.handleTouchAxis(a)}},handleSwipeAxis:function(a){let b=this.data,c=a.detail.axis;if(0===this.startingAxisData.length&&this.canRecordAxis&&(this.canRecordAxis=!1,this.startingAxisData[0]=c[0],this.startingAxisData[1]=c[1]),this.startingAxisData.length>0){let a=0,d=0;b.enableNegX&&c[0]<this.startingAxisData[0]&&(a=-1),b.enablePosX&&c[0]>this.startingAxisData[0]&&(a=1),b.enablePosZ&&c[1]>this.startingAxisData[1]&&(d=-1),b.enableNegZ&&c[1]<this.startingAxisData[1]&&(d=1);let e=Math.abs(this.startingAxisData[1]-c[1]);Math.abs(this.startingAxisData[0]-c[0])>e?(this.zVel=0,this.xVel=a):(this.xVel=0,this.zVel=d),this.isMoving=!0}},handleTouchAxis:function(a){let b=this.data,c=a.detail.axis,d=0,e=0;b.enableNegX&&c[0]<0&&(d=-1),b.enablePosX&&c[0]>0&&(d=1),b.enablePosZ&&c[1]>0&&(e=-1),b.enableNegZ&&c[1]<0&&(e=1),Math.abs(c[0])>Math.abs(c[1])?(this.zVel=0,this.xVel=d):(this.xVel=0,this.zVel=e)}})},2086:()=>{function a(a,b,c,d){a&&(b=b||[],a.traverse(a=>{if(a.isMesh){var e;(!(e=a.material)?[]:Array.isArray(e)?e:e.materials?e.materials:[e]).forEach(a=>{(!a||"envMap"in a)&&(b.length&&-1===b.indexOf(a.name)||(a.envMap=c,a.reflectivity=d,a.needsUpdate=!0))})}}))}AFRAME.registerComponent("cube-env-map",{multiple:!0,schema:{path:{default:""},extension:{default:"jpg",oneOf:["jpg","png"]},enableBackground:{default:!1},reflectivity:{default:1,min:0,max:1},materials:{default:[]}},init:function(){let b=this.data;this.texture=new THREE.CubeTextureLoader().load([b.path+"posx."+b.extension,b.path+"negx."+b.extension,b.path+"posy."+b.extension,b.path+"negy."+b.extension,b.path+"posz."+b.extension,b.path+"negz."+b.extension]),this.texture.format=THREE.RGBAFormat,this.object3dsetHandler=()=>{let b=this.el.getObject3D("mesh"),c=this.data;a(b,c.materials,this.texture,c.reflectivity)},this.object3dsetHandler(),this.el.addEventListener("object3dset",this.object3dsetHandler)},update:function(b){let c=this.data,d=this.el.getObject3D("mesh"),e=[],f=[];if(c.materials.length&&(b.materials?(e=c.materials.filter(a=>!b.materials.includes(a)),f=b.materials.filter(a=>!c.materials.includes(a))):e=c.materials),e.length&&a(d,e,this.texture,c.reflectivity),f.length&&a(d,f,null,1),b.materials&&c.reflectivity!==b.reflectivity){let e=c.materials.filter(a=>b.materials.includes(a));e.length&&a(d,e,this.texture,c.reflectivity)}this.data.enableBackground&&!b.enableBackground?this.setBackground(this.texture):!this.data.enableBackground&&b.enableBackground&&this.setBackground(null)},remove:function(){this.el.removeEventListener("object3dset",this.object3dsetHandler);let b=this.el.getObject3D("mesh"),c=this.data;a(b,c.materials,null,1),c.enableBackground&&this.setBackground(null)},setBackground:function(a){this.el.sceneEl.object3D.background=a}})},2136:()=>{AFRAME.registerPrimitive("a-tube",{defaultComponents:{tube:{}},mappings:{path:"tube.path",segments:"tube.segments",radius:"tube.radius","radial-segments":"tube.radialSegments",closed:"tube.closed"}}),AFRAME.registerComponent("tube",{schema:{path:{default:[]},segments:{default:64},radius:{default:1},radialSegments:{default:8},closed:{default:!1}},init:function(){let a=this.el,b=this.data,c=a.components.material;if(!b.path.length)return void console.error("[a-tube] `path` property expected but not found.");let d=new THREE.CatmullRomCurve3(b.path.map(function(a){return a=a.split(" "),new THREE.Vector3(Number(a[0]),Number(a[1]),Number(a[2]))})),e=new THREE.TubeGeometry(d,b.segments,b.radius,b.radialSegments,b.closed);c||((c={}).material=new THREE.MeshPhongMaterial),this.mesh=new THREE.Mesh(e,c.material),this.el.setObject3D("mesh",this.mesh)},update:function(a){Object.keys(a).length&&(this.remove(),this.init())},remove:function(){this.mesh&&this.el.removeObject3D("mesh")}})},2332:()=>{AFRAME.registerComponent("grab",{init:function(){this.system=this.el.sceneEl.systems.physics,this.GRABBED_STATE="grabbed",this.grabbing=!1,this.hitEl=null,this.physics=this.el.sceneEl.systems.physics,this.constraint=null,this.onHit=this.onHit.bind(this),this.onGripOpen=this.onGripOpen.bind(this),this.onGripClose=this.onGripClose.bind(this)},play:function(){let a=this.el;a.addEventListener("hit",this.onHit),a.addEventListener("gripdown",this.onGripClose),a.addEventListener("gripup",this.onGripOpen),a.addEventListener("trackpaddown",this.onGripClose),a.addEventListener("trackpadup",this.onGripOpen),a.addEventListener("triggerdown",this.onGripClose),a.addEventListener("triggerup",this.onGripOpen)},pause:function(){let a=this.el;a.removeEventListener("hit",this.onHit),a.removeEventListener("gripdown",this.onGripClose),a.removeEventListener("gripup",this.onGripOpen),a.removeEventListener("trackpaddown",this.onGripClose),a.removeEventListener("trackpadup",this.onGripOpen),a.removeEventListener("triggerdown",this.onGripClose),a.removeEventListener("triggerup",this.onGripOpen)},onGripClose:function(){this.grabbing=!0},onGripOpen:function(){let a=this.hitEl;this.grabbing=!1,a&&(a.removeState(this.GRABBED_STATE),this.hitEl=void 0,this.system.removeConstraint(this.constraint),this.constraint=null)},onHit:function(a){let b=a.detail.el;b.is(this.GRABBED_STATE)||!this.grabbing||this.hitEl||(b.addState(this.GRABBED_STATE),this.hitEl=b,this.constraint=new CANNON.LockConstraint(this.el.body,b.body),this.system.addConstraint(this.constraint))}})},2645:()=>{AFRAME.registerComponent("checkpoint-controls",{schema:{enabled:{default:!0},mode:{default:"teleport",oneOf:["teleport","animate"]},animateSpeed:{default:3}},init:function(){this.active=!0,this.checkpoint=null,this.isNavMeshConstrained=!1,this.offset=new THREE.Vector3,this.position=new THREE.Vector3,this.targetPosition=new THREE.Vector3},play:function(){this.active=!0},pause:function(){this.active=!1},setCheckpoint:function(a){let b=this.el;if(this.active&&this.checkpoint!==a){if(this.checkpoint&&b.emit("navigation-end",{checkpoint:this.checkpoint}),this.checkpoint=a,this.sync(),.1>this.position.distanceTo(this.targetPosition)){this.checkpoint=null;return}b.emit("navigation-start",{checkpoint:a}),"teleport"===this.data.mode&&(this.el.setAttribute("position",this.targetPosition),this.checkpoint=null,b.emit("navigation-end",{checkpoint:a}),b.components["movement-controls"].updateNavLocation())}},isVelocityActive:function(){return!!(this.active&&this.checkpoint)},getVelocity:function(){if(!this.active)return;let a=this.data,b=this.offset,c=this.position,d=this.targetPosition,e=this.checkpoint;return(this.sync(),.1>c.distanceTo(d))?(this.checkpoint=null,this.el.emit("navigation-end",{checkpoint:e}),b.set(0,0,0)):(b.setLength(a.animateSpeed),b)},sync:function(){let a=this.offset,b=this.position,c=this.targetPosition;b.copy(this.el.getAttribute("position")),this.checkpoint.object3D.getWorldPosition(c),c.add(this.checkpoint.components.checkpoint.getOffset()),a.copy(c).sub(b)}})},2704:()=>{AFRAME.registerComponent("sphere-collider",{schema:{enabled:{default:!0},interval:{default:80},objects:{default:""},state:{default:"collided"},radius:{default:.05},watch:{default:!0}},init:function(){this.observer=null,this.els=[],this.collisions=[],this.prevCheckTime=void 0,this.eventDetail={},this.handleHit=this.handleHit.bind(this),this.handleHitEnd=this.handleHitEnd.bind(this)},play:function(){let a=this.el.sceneEl;this.data.watch&&(this.observer=new MutationObserver(this.update.bind(this,null)),this.observer.observe(a,{childList:!0,subtree:!0}))},pause:function(){this.observer&&(this.observer.disconnect(),this.observer=null)},update:function(){let a,b=this.data;a=b.objects?this.el.sceneEl.querySelectorAll(b.objects):this.el.sceneEl.children,this.els=Array.prototype.slice.call(a)},tick:function(){let a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector3,e=new THREE.Box3,f=[],g=new Map;return function(h){var i;let j;if(!this.data.enabled)return;let k=this.prevCheckTime;if(k&&h-k<this.data.interval)return;this.prevCheckTime=h;let l=this.el,m=this.data;l.getObject3D("mesh")&&(f.length=0,g.clear(),l.object3D.getWorldPosition(a),l.object3D.getWorldScale(c),j=m.radius*Math.max((i=c).x,i.y,i.z),this.els.forEach(function(c){let h,i,k,l;c.isEntity&&(i=c.getObject3D("mesh"))&&(e.setFromObject(i).getSize(d),h=Math.sqrt(2*(l=Math.max(d.x,d.y,d.z)/2)*l),e.getCenter(b),h&&(k=a.distanceTo(b))<h+j&&(f.push(c),g.set(c,k)))}),f.sort((a,b)=>g.get(a)>g.get(b)?1:-1).forEach(this.handleHit),this.collisions.filter(a=>!g.has(a)).forEach(this.handleHitEnd),function(a,b){a.length=0;for(let c=0;c<b.length;c++)a[c]=b[c]}(this.collisions,f))}}(),handleHit:function(a){a.emit("hit"),a.addState(this.data.state),this.eventDetail.el=a,this.el.emit("hit",this.eventDetail)},handleHitEnd:function(a){a.emit("hitend"),a.removeState(this.data.state),this.eventDetail.el=a,this.el.emit("hitend",this.eventDetail)}})},5012:()=>{AFRAME.registerComponent("checkpoint",{schema:{offset:{default:{x:0,y:0,z:0},type:"vec3"}},init:function(){this.active=!1,this.targetEl=null,this.fire=this.fire.bind(this),this.offset=new THREE.Vector3},update:function(){this.offset.copy(this.data.offset)},play:function(){this.el.addEventListener("click",this.fire)},pause:function(){this.el.removeEventListener("click",this.fire)},remove:function(){this.pause()},fire:function(){let a=this.el.sceneEl.querySelector("[checkpoint-controls]");if(!a)throw Error("No `checkpoint-controls` component found.");a.components["checkpoint-controls"].setCheckpoint(this.el)},getOffset:function(){return this.offset.copy(this.data.offset)}})},5994:()=>{AFRAME.registerPrimitive("a-grid",{defaultComponents:{geometry:{primitive:"plane",width:75,height:75},rotation:{x:-90,y:0,z:0},material:{src:"url(https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v1.16.3/assets/grid.png)",repeat:"75 75"}},mappings:{width:"geometry.width",height:"geometry.height",src:"material.src"}})},7232:()=>{AFRAME.registerComponent("touch-controls",{schema:{enabled:{default:!0},reverseEnabled:{default:!0}},init:function(){this.dVelocity=new THREE.Vector3,this.bindMethods(),this.direction=0},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.dVelocity.set(0,0,0)},remove:function(){this.pause()},addEventListeners:function(){let a=this.el.sceneEl,b=a.canvas;if(!b)return void a.addEventListener("render-target-loaded",this.addEventListeners.bind(this));b.addEventListener("touchstart",this.onTouchStart,{passive:!0}),b.addEventListener("touchend",this.onTouchEnd,{passive:!0});let c=a.getAttribute("vr-mode-ui");c&&c.cardboardModeEnabled&&a.addEventListener("enter-vr",this.onEnterVR)},removeEventListeners:function(){let a=this.el.sceneEl&&this.el.sceneEl.canvas;a&&(a.removeEventListener("touchstart",this.onTouchStart),a.removeEventListener("touchend",this.onTouchEnd),this.el.sceneEl.removeEventListener("enter-vr",this.onEnterVR))},isVelocityActive:function(){return this.data.enabled&&!!this.direction},getVelocityDelta:function(){return this.dVelocity.z=this.direction,this.dVelocity.clone()},bindMethods:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onEnterVR=this.onEnterVR.bind(this)},onTouchStart:function(a){this.direction=-1,this.data.reverseEnabled&&a.touches&&2===a.touches.length&&(this.direction=1),a.preventDefault()},onTouchEnd:function(a){this.direction=0,a.preventDefault()},onEnterVR:function(){let a=this.el.sceneEl.xrSession;a&&(a.addEventListener("selectstart",this.onTouchStart),a.addEventListener("selectend",this.onTouchEnd))}})},7450:()=>{AFRAME.registerPrimitive("a-ocean",{defaultComponents:{ocean:{},rotation:{x:-90,y:0,z:0}},mappings:{width:"ocean.width",depth:"ocean.depth",density:"ocean.density",amplitude:"ocean.amplitude",amplitudeVariance:"ocean.amplitudeVariance",speed:"ocean.speed",speedVariance:"ocean.speedVariance",color:"ocean.color",opacity:"ocean.opacity"}}),AFRAME.registerComponent("ocean",{schema:{width:{default:10,min:0},depth:{default:10,min:0},density:{default:10},amplitude:{default:.1},amplitudeVariance:{default:.3},speed:{default:1},speedVariance:{default:2},color:{default:"#7AD2F7",type:"color"},opacity:{default:.8}},play:function(){let a=this.el,b=this.data,c=a.components.material,d=new THREE.PlaneGeometry(b.width,b.depth,b.density,b.density);this.waves=[];let e=d.getAttribute("position");for(let a=0;a<e.count;a++)this.waves.push({z:e.getZ(a),ang:Math.random()*Math.PI*2,amp:b.amplitude+Math.random()*b.amplitudeVariance,speed:(b.speed+Math.random()*b.speedVariance)/1e3});c||((c={}).material=new THREE.MeshPhongMaterial({color:b.color,transparent:b.opacity<1,opacity:b.opacity,flatShading:!0})),this.mesh=new THREE.Mesh(d,c.material),a.setObject3D("mesh",this.mesh)},remove:function(){this.el.removeObject3D("mesh")},tick:function(a,b){if(!b)return;let c=this.mesh.geometry.getAttribute("position");for(let a=0;a<c.count;a++){let d=this.waves[a],e=d.z+Math.sin(d.ang)*d.amp;c.setZ(a,e),d.ang+=d.speed*b}c.needsUpdate=!0}})},7829:()=>{AFRAME.registerComponent("nav-agent",{schema:{destination:{type:"vec3"},active:{default:!1},speed:{default:2}},init:function(){this.system=this.el.sceneEl.systems.nav,this.system.addAgent(this),this.group=null,this.path=[],this.raycaster=new THREE.Raycaster},remove:function(){this.system.removeAgent(this)},update:function(){this.path.length=0},updateNavLocation:function(){this.group=null,this.path=[]},tick:function(){let a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e){let f,g=this.el,h=this.data,i=this.raycaster,j=h.speed*e/1e3;if(!h.active)return;if(!this.path.length){let b=this.el.object3D.position;this.group=this.group||this.system.getGroup(b),this.path=this.system.getPath(b,a.copy(h.destination),this.group)||[],g.emit("navigation-start")}if(!this.path.length){console.warn("[nav] Unable to find path to %o.",h.destination),this.el.setAttribute("nav-agent",{active:!1}),g.emit("navigation-end");return}let k=g.object3D.position,l=this.path[0];if(b.subVectors(l,k),b.length()<j){if(this.path.shift(),!this.path.length){this.el.setAttribute("nav-agent",{active:!1}),g.emit("navigation-end");return}c.copy(k),f=this.path[0]}else c.copy(b.setLength(j)).add(k),f=l;f.y=k.y,g.object3D.lookAt(f),i.ray.origin.copy(c),i.ray.origin.y+=1.5,i.ray.direction={x:0,y:-1,z:0};let m=i.intersectObject(this.system.getNavMesh());m.length?(b.subVectors(m[0].point,k),k.add(b.setLength(j))):k.copy(c)}}()})},7872:()=>{let a="-controls";AFRAME.registerComponent("movement-controls",{dependencies:["rotation"],schema:{enabled:{default:!0},controls:{default:["gamepad","trackpad","keyboard","touch"]},speed:{default:.3,min:0},fly:{default:!1},constrainToNavMesh:{default:!1},camera:{default:"[movement-controls] [camera]",type:"selector"}},init:function(){let a=this.el;this.data.camera||(this.data.camera=a.querySelector("[camera]")),this.velocityCtrl=null,this.velocity=new THREE.Vector3,this.heading=new THREE.Quaternion,this.eventDetail={},this.navGroup=null,this.navNode=null,a.sceneEl.hasLoaded?this.injectControls():a.sceneEl.addEventListener("loaded",this.injectControls.bind(this))},update:function(b){let c=this.el,d=this.data,e=c.sceneEl.systems.nav;if(c.sceneEl.hasLoaded&&this.injectControls(),e&&d.constrainToNavMesh!==b.constrainToNavMesh&&(d.constrainToNavMesh?e.addAgent(this):e.removeAgent(this)),d.enabled!==b.enabled)for(let b=0;b<d.controls.length;b++){let c=d.controls[b]+a;this.el.setAttribute(c,{enabled:this.data.enabled})}},injectControls:function(){let b=this.data;for(let c=0;c<b.controls.length;c++){let d=b.controls[c]+a;this.el.setAttribute(d,{enabled:this.data.enabled})}},updateNavLocation:function(){this.navGroup=null,this.navNode=null},tick:function(){let a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e){if(!e)return;let f=this.el,g=this.data;if(!g.enabled)return;this.updateVelocityCtrl();let h=this.velocityCtrl,i=this.velocity;if(h)if(e/1e3>.2?i.set(0,0,0):this.updateVelocity(e),g.constrainToNavMesh&&!1!==h.isNavMeshConstrained){if(1e-5>i.lengthSq())return;a.copy(f.object3D.position),b.copy(i).multiplyScalar(e/1e3).add(a);let d=f.sceneEl.systems.nav;this.navGroup=null===this.navGroup?d.getGroup(a):this.navGroup,this.navNode=this.navNode||d.getNode(a,this.navGroup),this.navNode=d.clampStep(a,b,this.navGroup,this.navNode,c),f.object3D.position.copy(c)}else f.hasAttribute("velocity")?f.setAttribute("velocity",i):(f.object3D.position.x+=i.x*e/1e3,f.object3D.position.y+=i.y*e/1e3,f.object3D.position.z+=i.z*e/1e3)}}(),updateVelocityCtrl:function(){let b=this.data;if(b.enabled){for(let c=0,d=b.controls.length;c<d;c++){let d=this.el.components[b.controls[c]+a];if(d&&d.isVelocityActive()){this.velocityCtrl=d;return}}this.velocityCtrl=null}},updateVelocity:function(){let a=new THREE.Vector2,b=new THREE.Quaternion;return function(c){let d,e=this.el,f=this.velocityCtrl,g=this.velocity,h=this.data;if(f)if(f.getVelocityDelta)d=f.getVelocityDelta(c);else if(f.getVelocity)return void g.copy(f.getVelocity());else if(f.getPositionDelta)return void g.copy(f.getPositionDelta(c).multiplyScalar(1e3/c));else throw Error("Incompatible movement controls: ",f);if(e.hasAttribute("velocity")&&!h.constrainToNavMesh&&g.copy(this.el.getAttribute("velocity")),d&&h.enabled){let c=h.camera;b.copy(c.object3D.quaternion),b.premultiply(e.object3D.quaternion),d.applyQuaternion(b);let f=d.length();h.fly?(g.copy(d),g.multiplyScalar(16.66667*this.data.speed)):(a.set(d.x,d.z),a.setLength(f*this.data.speed*16.66667),g.x=a.x,g.y=0,g.z=a.y),(0!==g.x||0!==g.y||0!==g.z)&&(this.eventDetail.velocity=g,this.el.emit("moved",this.eventDetail))}}}()})},8435:()=>{AFRAME.registerComponent("nav-mesh",{schema:{nodeName:{type:"string"}},init:function(){this.system=this.el.sceneEl.systems.nav,this.hasLoadedNavMesh=!1,this.nodeName=this.data.nodeName,this.el.addEventListener("object3dset",this.loadNavMesh.bind(this))},play:function(){this.hasLoadedNavMesh||this.loadNavMesh()},loadNavMesh:function(){let a;var b=this;let c=this.el.getObject3D("mesh");if(this.el.sceneEl.object3D,!c||(c.traverse(c=>{c.isMesh&&(!b.nodeName||c.name===b.nodeName)&&(a=c)}),!a))return;let d=a.geometry.clone();a.updateWorldMatrix(!0,!1),d.applyMatrix4(a.matrixWorld),this.system.setNavMeshGeometry(d),this.hasLoadedNavMesh=!0}})},9173:()=>{AFRAME.registerComponent("object-model",{schema:{src:{type:"asset"},crossorigin:{default:""}},init:function(){this.model=null},update:function(){let a,b=this.data;b.src&&(this.remove(),a=new THREE.ObjectLoader,b.crossorigin&&a.setCrossOrigin(b.crossorigin),a.load(b.src,a=>{a.traverse(a=>{a instanceof THREE.SkinnedMesh&&a.material&&(a.material.skinning=!!(a.geometry&&a.geometry.bones||[]).length)}),this.load(a)}))},load:function(a){this.model=a,this.el.setObject3D("mesh",a),this.el.emit("model-loaded",{format:"json",model:a})},remove:function(){this.model&&this.el.removeObject3D("mesh")}})},9187:()=>{AFRAME.registerComponent("normal-material",{init:function(){this.material=new THREE.MeshNormalMaterial({flatShading:!0}),this.applyMaterial=this.applyMaterial.bind(this),this.el.addEventListener("object3dset",this.applyMaterial),this.applyMaterial()},remove:function(){this.el.removeEventListener("object3dset",this.applyMaterial)},applyMaterial:function(){this.el.object3D.traverse(a=>{a.isMesh&&(a.material=this.material)})}})}};